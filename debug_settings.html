<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Debug Test</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Settings Debug Test</h2>
        
        <form id="generalSettingsForm">
            <div class="mb-3">
                <label for="siteName" class="form-label">Site Name</label>
                <input type="text" class="form-control" id="siteName" name="site_name" value="Test Store">
            </div>
            <div class="mb-3">
                <label for="siteTagline" class="form-label">Site Tagline</label>
                <input type="text" class="form-control" id="siteTagline" name="site_tagline" value="Test Tagline">
            </div>
            <button type="button" class="btn btn-primary" id="saveGeneralSettingsBtn">
                <i class="fas fa-save me-1"></i> Save General Settings
            </button>
        </form>
        
        <div class="mt-3">
            <button onclick="testAlert()" class="btn btn-info">Test Alert</button>
            <button onclick="testButtonFunction()" class="btn btn-warning">Test Button Function</button>
        </div>
        
        <div id="debug-output" class="mt-3 p-3 bg-light border rounded">
            <h5>Debug Output:</h5>
            <div id="output"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Debug: Test the exact code from settings
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Popup Alert System
            function showAlert(message, type = 'success', duration = 4000) {
                console.log('showAlert called:', message, type);
                
                const alertTypes = {
                    'success': { icon: 'fas fa-check-circle', class: 'alert-success' },
                    'error': { icon: 'fas fa-exclamation-circle', class: 'alert-danger' },
                    'warning': { icon: 'fas fa-exclamation-triangle', class: 'alert-warning' },
                    'info': { icon: 'fas fa-info-circle', class: 'alert-info' }
                };

                const alertConfig = alertTypes[type] || alertTypes['success'];
                
                const alertHtml = `
                    <div class="alert ${alertConfig.class} alert-dismissible" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                        <i class="${alertConfig.icon} me-2"></i>
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;

                const alertElement = document.createElement('div');
                alertElement.innerHTML = alertHtml;
                const alert = alertElement.firstElementChild;
                
                document.body.appendChild(alert);

                // Auto-dismiss after specified duration
                setTimeout(() => {
                    if (alert && alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, duration);

                return alert;
            }

            // Helper function to get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue || 'test-csrf-token';
            }

            // Test save button functionality
            const saveButtons = [
                { id: 'saveGeneralSettingsBtn', message: 'General settings saved successfully!', formId: 'generalSettingsForm', endpoint: '/dashboard/settings/' }
            ];

            saveButtons.forEach(button => {
                const element = document.getElementById(button.id);
                console.log('Found button element:', element);
                
                if (element) {
                    element.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Button clicked!');
                        
                        // Add loading state
                        const originalText = this.innerHTML;
                        this.disabled = true;
                        this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Saving...';
                        
                        // Get form data
                        const formElement = document.getElementById(button.formId);
                        if (!formElement) {
                            this.disabled = false;
                            this.innerHTML = originalText;
                            showAlert('Form not found!', 'error');
                            return;
                        }
                        
                        const formData = new FormData(formElement);
                        console.log('Form data:', Array.from(formData.entries()));
                        
                        // Simulate save (since we're testing)
                        setTimeout(() => {
                            this.disabled = false;
                            this.innerHTML = originalText;
                            showAlert(button.message, 'success');
                            console.log('Save completed successfully');
                        }, 1500);
                    });
                } else {
                    console.error('Button not found:', button.id);
                }
            });
            
            console.log('Event listeners attached');
        });
        
        function testAlert() {
            console.log('Testing alert...');
            const alertHtml = `
                <div class="alert alert-info alert-dismissible" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                    <i class="fas fa-info-circle me-2"></i>
                    Test alert message!
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            const div = document.createElement('div');
            div.innerHTML = alertHtml;
            document.body.appendChild(div.firstElementChild);
        }
        
        function testButtonFunction() {
            console.log('Testing button function...');
            const button = document.getElementById('saveGeneralSettingsBtn');
            if (button) {
                console.log('Button found, triggering click');
                button.click();
            } else {
                console.error('Button not found!');
            }
        }
        
        // Add some debug output
        document.addEventListener('DOMContentLoaded', function() {
            const output = document.getElementById('output');
            output.innerHTML += '<p>✅ DOM Content Loaded</p>';
            
            const button = document.getElementById('saveGeneralSettingsBtn');
            if (button) {
                output.innerHTML += '<p>✅ Save button found</p>';
            } else {
                output.innerHTML += '<p>❌ Save button NOT found</p>';
            }
            
            const form = document.getElementById('generalSettingsForm');
            if (form) {
                output.innerHTML += '<p>✅ Form found</p>';
            } else {
                output.innerHTML += '<p>❌ Form NOT found</p>';
            }
        });
    </script>
</body>
</html>