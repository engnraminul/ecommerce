<!DOCTYPE html>
<html>
<head>
    <title>Test Variant Loading</title>
    <script>
        async function testVariantLoading() {
            const productId = 31; // Test with the product we know has variants
            const testArea = document.getElementById('testArea');
            
            try {
                testArea.innerHTML = 'Loading product data...';
                
                // Test 1: Get product details
                const productResponse = await fetch(`/mb-admin/api/products/${productId}/`);
                console.log('Product response status:', productResponse.status);
                
                if (!productResponse.ok) {
                    throw new Error(`Product API failed: ${productResponse.status}`);
                }
                
                const productData = await productResponse.json();
                console.log('Product data:', productData);
                
                let html = `<h3>Product: ${productData.name}</h3>`;
                
                // Test 2: Check variants in product response
                if (productData.variants && productData.variants.length > 0) {
                    html += `<h4>Variants from product API (${productData.variants.length}):</h4><ul>`;
                    productData.variants.forEach(variant => {
                        html += `<li>${variant.name} (ID: ${variant.id}, Stock: ${variant.stock_quantity})</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p>No variants found in product response</p>';
                }
                
                // Test 3: Get variants from dedicated endpoint
                html += '<h4>Testing dedicated variants endpoint:</h4>';
                try {
                    const variantsResponse = await fetch(`/mb-admin/api/products/${productId}/variants/`);
                    console.log('Variants response status:', variantsResponse.status);
                    
                    if (variantsResponse.ok) {
                        const variantsData = await variantsResponse.json();
                        console.log('Variants data:', variantsData);
                        
                        html += `<ul>`;
                        variantsData.forEach(variant => {
                            html += `<li>${variant.name} (ID: ${variant.id}, Stock: ${variant.stock_quantity})</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += `<p>Variants endpoint failed: ${variantsResponse.status}</p>`;
                    }
                } catch (e) {
                    html += `<p>Variants endpoint error: ${e.message}</p>`;
                }
                
                testArea.innerHTML = html;
                
            } catch (error) {
                console.error('Test error:', error);
                testArea.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        // Simulate the actual JavaScript from orders.html
        async function simulateVariantLoading() {
            const productId = 31;
            const testArea2 = document.getElementById('testArea2');
            
            try {
                testArea2.innerHTML = 'Testing variant loading like orders.html...';
                
                // This is the same code as in orders.html
                const productResponse = await fetch(`/mb-admin/api/products/${productId}/`);
                if (!productResponse.ok) throw new Error('Failed to fetch product details');
                
                const productData = await productResponse.json();
                
                let html = '<h4>Simulating orders.html variant loading:</h4>';
                
                // Check if product has variants (same logic as orders.html)
                if (productData.variants && productData.variants.length > 0) {
                    html += `<p>✅ Product has ${productData.variants.length} variants</p>`;
                    html += '<select id="simulatedVariantSelect">';
                    html += '<option value="">No variant</option>';
                    
                    productData.variants.forEach(variant => {
                        html += `<option value="${variant.id}">${variant.name || variant.display_name || 'Variant ' + variant.id}</option>`;
                    });
                    
                    html += '</select>';
                } else {
                    html += '<p>❌ No variants found or variants array is empty</p>';
                }
                
                testArea2.innerHTML = html;
                
            } catch (error) {
                console.error('Simulation error:', error);
                testArea2.innerHTML = `<p style="color: red;">Simulation Error: ${error.message}</p>`;
            }
        }
    </script>
</head>
<body>
    <h1>Variant Loading Test</h1>
    
    <button onclick="testVariantLoading()">Test Variant Loading</button>
    <div id="testArea">Click the button to test variant loading</div>
    
    <hr>
    
    <button onclick="simulateVariantLoading()">Simulate orders.html Logic</button>
    <div id="testArea2">Click the button to simulate orders.html variant loading</div>
    
    <script>
        // Auto-run tests
        window.onload = function() {
            console.log('Auto-running tests...');
            testVariantLoading();
            setTimeout(() => simulateVariantLoading(), 1000);
        };
    </script>
</body>
</html>