{% for review in reviews %}
<div class="review-item">
    <div class="review-header">
        <div class="reviewer-info">
            <div class="reviewer-details">
                <strong class="reviewer-name">
                    {% if review.user %}
                        {{ review.user.get_full_name|default:review.user.username }}
                    {% else %}
                        {{ review.guest_name|default:"Anonymous" }}
                    {% endif %}
                    <span class="review-date">({{ review.created_at|date:"M d, Y" }})</span>
                    {% if review.is_verified_purchase %}
                        <span class="verified-badge">
                            <i class="fas fa-check-circle"></i>
                            Verified Purchase
                        </span>
                    {% endif %}
                </strong>
                <div class="review-rating">
                    {% for i in "12345" %}
                        <i class="fas fa-star {% if i|add:0 <= review.rating %}filled{% endif %}"></i>
                    {% endfor %}
                    <span class="rating-number">({{ review.rating }}/5)</span>
                </div>
            </div>
        </div>
    </div>
    
    <p class="review-text">{{ review.comment|linebreaks }}</p>
    
    <!-- Review Images -->
    {% if review.images.exists %}
    <div class="review-images">
        {% for image in review.images.all %}
        <div class="review-image-item">
            <img src="{{ image.image.url }}" 
                 alt="Review image" 
                 class="review-image"
                 onclick="openReviewImageModal('{{ image.image.url }}', '{{ image.caption|default:"Review image"|escapejs }}')"
                 loading="lazy">
            {% if image.caption %}
            <small class="image-caption">{{ image.caption }}</small>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Review Actions -->
    <div class="review-actions">
        <button class="review-action-btn helpful-btn" data-review-id="{{ review.id }}">
            <i class="far fa-thumbs-up"></i>
            Helpful
        </button>
        <button class="review-action-btn report-btn" data-review-id="{{ review.id }}">
            <i class="far fa-flag"></i>
            Report
        </button>
    </div>
</div>
{% endfor %}

{% if has_next %}
    <input type="hidden" id="has-more-reviews" value="true">
{% endif %}
<input type="hidden" id="total-reviews" value="{{ total_reviews }}">
