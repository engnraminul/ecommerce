{% extends 'dashboard/base.html' %}

{% block title %}Settings - MB Admin{% endblock %}

{% block page_title %}Store Settings{% endblock %}

{% block extra_css %}
<style>
    .popup-alert {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        animation: slideInRight 0.5s ease-out;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    @keyframes slideInRight {
        from { 
            transform: translateX(100%); 
            opacity: 0; 
        }
        to { 
            transform: translateX(0); 
            opacity: 1; 
        }
    }
    
    @keyframes slideOutRight {
        from { 
            transform: translateX(0); 
            opacity: 1; 
        }
        to { 
            transform: translateX(100%); 
            opacity: 0; 
        }
    }
    
    .popup-alert.hiding {
        animation: slideOutRight 0.3s ease-in forwards;
    }
    
    .media-item {
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .media-item:hover {
        border-color: #930000;
        transform: scale(1.02);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .media-item.selected {
        border-color: #930000;
        background-color: rgba(147, 0, 0, 0.1);
    }
    
    .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .preview-image {
        width: 100%;
        height: 120px;
        object-fit: cover;
    }
    
    .file-name {
        font-size: 0.85em;
        padding: 8px;
        background: rgba(0,0,0,0.05);
        text-align: center;
    }
    
    .manual-path-container {
        background: rgba(248, 249, 250, 1);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Settings Navigation</h6>
            </div>
            <div class="card-body p-0">
                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <button class="nav-link text-start active" id="general-tab" data-bs-toggle="pill" data-bs-target="#general" type="button" role="tab" aria-selected="true">
                        <i class="fas fa-cog fa-fw me-2"></i> General
                    </button>
                    <button class="nav-link text-start" id="email-tab" data-bs-toggle="pill" data-bs-target="#email" type="button" role="tab" aria-selected="false">
                        <i class="fas fa-envelope fa-fw me-2"></i> Email
                    </button>
                    <button class="nav-link text-start" id="appearance-tab" data-bs-toggle="pill" data-bs-target="#appearance" type="button" role="tab" aria-selected="false">
                        <i class="fas fa-palette fa-fw me-2"></i> Appearance
                    </button>
                    <button class="nav-link text-start" id="checkout-tab" data-bs-toggle="pill" data-bs-target="#checkout" type="button" role="tab" aria-selected="false">
                        <i class="fas fa-shopping-cart fa-fw me-2"></i> Checkout Customize
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-9">
        <div class="card">
            <div class="card-body">
                <div class="tab-content" id="v-pills-tabContent">
                    <!-- General Settings -->
                    <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                        <h5 class="mb-4">General Settings</h5>
                        <form id="generalSettingsForm">
                            {% csrf_token %}
                            
                            <!-- Site Identity Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-store me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Site Identity</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-tag me-2" style="color: var(--primary-color, #930000);"></i>Site Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteName" class="form-label fw-medium">Site Name</label>
                                                <input type="text" class="form-control" id="siteName" name="site_name" value="{{ site_settings.site_name|default:'My Brand Store' }}" placeholder="My Brand Store">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="siteTagline" class="form-label fw-medium">Site Tagline</label>
                                                <input type="text" class="form-control" id="siteTagline" name="site_tagline" value="{{ site_settings.site_tagline|default:'Your one-stop shop for quality products' }}" placeholder="Your one-stop shop for quality products">
                                            </div>
                                        </div>
                                        
                                        <!-- Logo and Favicon Upload -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteLogo" class="form-label fw-medium">Site Logo Path</label>
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-image"></i>
                                                    </span>
                                                    <input type="text" class="form-control" id="siteLogo" name="site_logo" value="{{ site_settings.site_logo|default:'' }}" placeholder="media/logos/site-logo.png">
                                                    <button type="button" class="btn btn-outline-secondary" onclick="openMediaLibrary('siteLogo')">
                                                        <i class="fas fa-folder-open me-1"></i> Browse
                                                    </button>
                                                </div>
                                                <!-- Logo Preview -->
                                                <div class="logo-preview" id="siteLogoPreview">
                                                    {% if site_settings.site_logo %}
                                                        <img src="{{ site_settings.site_logo }}" alt="Site Logo" style="max-height: 60px; border: 1px solid #dee2e6; border-radius: 4px;">
                                                    {% else %}
                                                        <div class="text-muted small">No logo selected</div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="siteFavicon" class="form-label fw-medium">Site Favicon Path</label>
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text">
                                                        <i class="fas fa-star"></i>
                                                    </span>
                                                    <input type="text" class="form-control" id="siteFavicon" name="site_favicon" value="{{ site_settings.site_favicon|default:'' }}" placeholder="media/icons/favicon.ico">
                                                    <button type="button" class="btn btn-outline-secondary" onclick="openMediaLibrary('siteFavicon')">
                                                        <i class="fas fa-folder-open me-1"></i> Browse
                                                    </button>
                                                </div>
                                                <!-- Favicon Preview -->
                                                <div class="favicon-preview" id="siteFaviconPreview">
                                                    {% if site_settings.site_favicon %}
                                                        <img src="{{ site_settings.site_favicon }}" alt="Site Favicon" style="max-height: 32px; border: 1px solid #dee2e6; border-radius: 4px;">
                                                    {% else %}
                                                        <div class="text-muted small">No favicon selected</div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Information Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-address-book me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Contact Information</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-phone me-2" style="color: var(--primary-color, #930000);"></i>Contact Details</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="contactPhone" class="form-label fw-medium">Phone Number</label>
                                                <input type="tel" class="form-control" id="contactPhone" name="contact_phone" value="{{ site_settings.contact_phone|default:'+1 123-456-7890' }}" placeholder="+1 123-456-7890">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="contactEmail" class="form-label fw-medium">Email Address</label>
                                                <input type="email" class="form-control" id="contactEmail" name="contact_email" value="{{ site_settings.contact_email|default:'contact@mybrandstore.com' }}" placeholder="contact@mybrandstore.com">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactAddress" class="form-label fw-medium">Business Address</label>
                                            <textarea class="form-control" id="contactAddress" name="contact_address" rows="3" placeholder="123 Main Street, City, State 12345, Country">{{ site_settings.contact_address|default:'123 Main Street, City, State 12345, Country' }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Footer Information Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-window-minimize me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Footer Information</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-info-circle me-2" style="color: var(--primary-color, #930000);"></i>Footer Content</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Footer Logo -->
                                        <div class="mb-3">
                                            <label for="footerLogo" class="form-label fw-medium">Footer Logo Path</label>
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">
                                                    <i class="fas fa-image"></i>
                                                </span>
                                                <input type="text" class="form-control" id="footerLogo" name="footer_logo" value="{{ site_settings.footer_logo|default:'' }}" placeholder="media/logos/footer-logo.png">
                                                <button type="button" class="btn btn-outline-secondary" onclick="openMediaLibrary('footerLogo')">
                                                    <i class="fas fa-folder-open me-1"></i> Browse
                                                </button>
                                            </div>
                                            <!-- Footer Logo Preview -->
                                            <div class="footer-logo-preview" id="footerLogoPreview">
                                                {% if site_settings.footer_logo %}
                                                    <img src="{{ site_settings.footer_logo }}" alt="Footer Logo" style="max-height: 50px; border: 1px solid #dee2e6; border-radius: 4px;">
                                                {% else %}
                                                    <div class="text-muted small">No footer logo selected</div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="footerShortText" class="form-label fw-medium">Footer Short Description</label>
                                            <textarea class="form-control" id="footerShortText" name="footer_short_text" rows="3" placeholder="Brief description about your store that appears in the footer">{{ site_settings.footer_short_text|default:'Brief description about your store that appears in the footer' }}</textarea>
                                        </div>
                                        
                                        <!-- Social Media Links -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="facebookLink" class="form-label fw-medium">
                                                    <i class="fab fa-facebook-f me-1" style="color: #1877f2;"></i>Facebook Page URL
                                                </label>
                                                <input type="url" class="form-control" id="facebookLink" name="facebook_link" value="{{ site_settings.facebook_link|default:'' }}" placeholder="https://facebook.com/yourpage">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="youtubeLink" class="form-label fw-medium">
                                                    <i class="fab fa-youtube me-1" style="color: #ff0000;"></i>YouTube Channel URL
                                                </label>
                                                <input type="url" class="form-control" id="youtubeLink" name="youtube_link" value="{{ site_settings.youtube_link|default:'' }}" placeholder="https://youtube.com/yourchannel">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Links Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-link me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Quick Links Configuration</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-list me-2" style="color: var(--primary-color, #930000);"></i>Quick Links Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="quickLinksTitle" class="form-label fw-medium">Quick Links Section Title</label>
                                                <input type="text" class="form-control" id="quickLinksTitle" name="quick_links_title" value="{{ site_settings.quick_links_title|default:'Quick Links' }}" placeholder="Quick Links">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="customerServiceTitle" class="form-label fw-medium">Customer Service Section Title</label>
                                                <input type="text" class="form-control" id="customerServiceTitle" name="customer_service_title" value="{{ site_settings.customer_service_title|default:'Customer Service' }}" placeholder="Customer Service">
                                            </div>
                                        </div>
                                        
                                        <!-- Quick Links Text and URL Fields -->
                                        <div class="mb-4">
                                            <h6 class="text-muted mb-3">Quick Links Configuration</h6>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label for="homeText" class="form-label fw-medium">Home Link Text</label>
                                                    <input type="text" class="form-control" id="homeText" name="home_text" value="{{ site_settings.home_text|default:'Home' }}" placeholder="Home">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="homeUrl" class="form-label fw-medium">Home Link URL</label>
                                                    <input type="text" class="form-control" id="homeUrl" name="home_url" value="{{ site_settings.home_url|default:'/' }}" placeholder="/">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="productsText" class="form-label fw-medium">Products Link Text</label>
                                                    <input type="text" class="form-control" id="productsText" name="products_text" value="{{ site_settings.products_text|default:'Products' }}" placeholder="Products">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="productsUrl" class="form-label fw-medium">Products Link URL</label>
                                                    <input type="text" class="form-control" id="productsUrl" name="products_url" value="{{ site_settings.products_url|default:'/products' }}" placeholder="/products">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="categoriesText" class="form-label fw-medium">Categories Link Text</label>
                                                    <input type="text" class="form-control" id="categoriesText" name="categories_text" value="{{ site_settings.categories_text|default:'Categories' }}" placeholder="Categories">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="categoriesUrl" class="form-label fw-medium">Categories Link URL</label>
                                                    <input type="text" class="form-control" id="categoriesUrl" name="categories_url" value="{{ site_settings.categories_url|default:'/categories' }}" placeholder="/categories">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="aboutText" class="form-label fw-medium">About Us Link Text</label>
                                                    <input type="text" class="form-control" id="aboutText" name="about_text" value="{{ site_settings.about_text|default:'About Us' }}" placeholder="About Us">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="aboutUrl" class="form-label fw-medium">About Us Link URL</label>
                                                    <input type="text" class="form-control" id="aboutUrl" name="about_url" value="{{ site_settings.about_url|default:'/about' }}" placeholder="/about">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="contactText" class="form-label fw-medium">Contact Link Text</label>
                                                    <input type="text" class="form-control" id="contactText" name="contact_text" value="{{ site_settings.contact_text|default:'Contact' }}" placeholder="Contact">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="contactUrl" class="form-label fw-medium">Contact Link URL</label>
                                                    <input type="text" class="form-control" id="contactUrl" name="contact_url" value="{{ site_settings.contact_url|default:'/contact' }}" placeholder="/contact">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Customer Service Links -->
                                        <div class="mb-3">
                                            <h6 class="text-muted mb-3">Customer Service Links Configuration</h6>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label for="trackOrderText" class="form-label fw-medium">Track Order Link Text</label>
                                                    <input type="text" class="form-control" id="trackOrderText" name="track_order_text" value="{{ site_settings.track_order_text|default:'Track Order' }}" placeholder="Track Order">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="trackOrderUrl" class="form-label fw-medium">Track Order Link URL</label>
                                                    <input type="text" class="form-control" id="trackOrderUrl" name="track_order_url" value="{{ site_settings.track_order_url|default:'/track-order' }}" placeholder="/track-order">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnPolicyText" class="form-label fw-medium">Return Policy Link Text</label>
                                                    <input type="text" class="form-control" id="returnPolicyText" name="return_policy_text" value="{{ site_settings.return_policy_text|default:'Return Policy' }}" placeholder="Return Policy">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnPolicyUrl" class="form-label fw-medium">Return Policy Link URL</label>
                                                    <input type="text" class="form-control" id="returnPolicyUrl" name="return_policy_url" value="{{ site_settings.return_policy_url|default:'/return-policy' }}" placeholder="/return-policy">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="shippingInfoText" class="form-label fw-medium">Shipping Info Link Text</label>
                                                    <input type="text" class="form-control" id="shippingInfoText" name="shipping_info_text" value="{{ site_settings.shipping_info_text|default:'Shipping Info' }}" placeholder="Shipping Info">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="shippingInfoUrl" class="form-label fw-medium">Shipping Info Link URL</label>
                                                    <input type="text" class="form-control" id="shippingInfoUrl" name="shipping_info_url" value="{{ site_settings.shipping_info_url|default:'/shipping-info' }}" placeholder="/shipping-info">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="fraudCheckerText" class="form-label fw-medium">Fraud Checker Link Text</label>
                                                    <input type="text" class="form-control" id="fraudCheckerText" name="fraud_checker_text" value="{{ site_settings.fraud_checker_text|default:'Fraud Checker' }}" placeholder="Fraud Checker">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="fraudCheckerUrl" class="form-label fw-medium">Fraud Checker Link URL</label>
                                                    <input type="text" class="form-control" id="fraudCheckerUrl" name="fraud_checker_url" value="{{ site_settings.fraud_checker_url|default:'/fraud-checker' }}" placeholder="/fraud-checker">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="faqText" class="form-label fw-medium">FAQ Link Text</label>
                                                    <input type="text" class="form-control" id="faqText" name="faq_text" value="{{ site_settings.faq_text|default:'FAQ' }}" placeholder="FAQ">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="faqUrl" class="form-label fw-medium">FAQ Link URL</label>
                                                    <input type="text" class="form-control" id="faqUrl" name="faq_url" value="{{ site_settings.faq_url|default:'/faq' }}" placeholder="/faq">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Footer Copyright Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-copyright me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Footer Copyright</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-file-alt me-2" style="color: var(--primary-color, #930000);"></i>Copyright Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="copyrightText" class="form-label fw-medium">Copyright Text</label>
                                            <input type="text" class="form-control" id="copyrightText" name="copyright_text" value="{{ site_settings.copyright_text|default:'© 2024 My Brand Store. All rights reserved.' }}" placeholder="© 2024 My Brand Store. All rights reserved.">
                                            <div class="form-text">Use {year} to automatically display current year</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Home Page - Why Shop With Us Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-home me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Home Page - Why Shop With Us</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-star me-2" style="color: var(--primary-color, #930000);"></i>Features Grid (4 Items)</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="whyShopSectionTitle" class="form-label fw-medium">Section Title</label>
                                            <input type="text" class="form-control" id="whyShopSectionTitle" name="why_shop_section_title" value="{{ site_settings.why_shop_section_title|default:'Why Shop With Us?' }}" placeholder="Why Shop With Us?">
                                        </div>
                                        
                                        <!-- Feature 1 -->
                                        <div class="card mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-star me-2 text-warning"></i>Feature 1</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="feature1Title" class="form-label fw-medium">Title</label>
                                                        <input type="text" class="form-control" id="feature1Title" name="feature1_title" value="{{ site_settings.feature1_title|default:'Fast Delivery' }}" placeholder="Fast Delivery">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="feature1Subtitle" class="form-label fw-medium">Subtitle</label>
                                                        <input type="text" class="form-control" id="feature1Subtitle" name="feature1_subtitle" value="{{ site_settings.feature1_subtitle|default:'Quick & reliable shipping' }}" placeholder="Quick & reliable shipping">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Feature 2 -->
                                        <div class="card mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-star me-2 text-warning"></i>Feature 2</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="feature2Title" class="form-label fw-medium">Title</label>
                                                        <input type="text" class="form-control" id="feature2Title" name="feature2_title" value="{{ site_settings.feature2_title|default:'Quality Products' }}" placeholder="Quality Products">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="feature2Subtitle" class="form-label fw-medium">Subtitle</label>
                                                        <input type="text" class="form-control" id="feature2Subtitle" name="feature2_subtitle" value="{{ site_settings.feature2_subtitle|default:'Premium quality guaranteed' }}" placeholder="Premium quality guaranteed">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Feature 3 -->
                                        <div class="card mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-star me-2 text-warning"></i>Feature 3</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="feature3Title" class="form-label fw-medium">Title</label>
                                                        <input type="text" class="form-control" id="feature3Title" name="feature3_title" value="{{ site_settings.feature3_title|default:'24/7 Support' }}" placeholder="24/7 Support">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="feature3Subtitle" class="form-label fw-medium">Subtitle</label>
                                                        <input type="text" class="form-control" id="feature3Subtitle" name="feature3_subtitle" value="{{ site_settings.feature3_subtitle|default:'Round the clock assistance' }}" placeholder="Round the clock assistance">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Feature 4 -->
                                        <div class="card mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-star me-2 text-warning"></i>Feature 4</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="feature4Title" class="form-label fw-medium">Title</label>
                                                        <input type="text" class="form-control" id="feature4Title" name="feature4_title" value="{{ site_settings.feature4_title|default:'Secure Payment' }}" placeholder="Secure Payment">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="feature4Subtitle" class="form-label fw-medium">Subtitle</label>
                                                        <input type="text" class="form-control" id="feature4Subtitle" name="feature4_subtitle" value="{{ site_settings.feature4_subtitle|default:'Safe & secure transactions' }}" placeholder="Safe & secure transactions">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary" id="saveGeneralSettingsBtn">
                                <i class="fas fa-save me-1"></i> Save General Settings
                            </button>
                        </form>
                    </div>
                    
                    <!-- Email Settings -->
                    <div class="tab-pane fade" id="email" role="tabpanel" aria-labelledby="email-tab">
                        <h5 class="mb-4">Email Settings</h5>
                        <form id="emailSettingsForm">
                            <div class="mb-4">
                                <h6 class="mb-3">SMTP Configuration</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="smtpHost" class="form-label">SMTP Host</label>
                                        <input type="text" class="form-control" id="smtpHost" name="smtp_host" value="smtp.example.com">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="smtpPort" class="form-label">SMTP Port</label>
                                        <input type="number" class="form-control" id="smtpPort" name="smtp_port" value="587">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="smtpUsername" class="form-label">SMTP Username</label>
                                        <input type="text" class="form-control" id="smtpUsername" name="smtp_username" value="user@example.com">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="smtpPassword" class="form-label">SMTP Password</label>
                                        <input type="password" class="form-control" id="smtpPassword" name="smtp_password" value="password">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="smtpSsl" name="smtp_ssl" checked>
                                        <label class="form-check-label" for="smtpSsl">
                                            Use SSL/TLS
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-outline-primary" id="testEmailBtn">
                                        <i class="fas fa-paper-plane me-1"></i> Send Test Email
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="mb-3">Email Templates</h6>
                                <div class="list-group">
                                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-bs-toggle="modal" data-bs-target="#emailTemplateModal" data-template="order_confirmation">
                                        Order Confirmation
                                        <i class="fas fa-angle-right"></i>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-bs-toggle="modal" data-bs-target="#emailTemplateModal" data-template="shipping_confirmation">
                                        Shipping Confirmation
                                        <i class="fas fa-angle-right"></i>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-bs-toggle="modal" data-bs-target="#emailTemplateModal" data-template="account_creation">
                                        Account Creation
                                        <i class="fas fa-angle-right"></i>
                                    </button>
                                    <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-bs-toggle="modal" data-bs-target="#emailTemplateModal" data-template="password_reset">
                                        Password Reset
                                        <i class="fas fa-angle-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary" id="saveEmailSettingsBtn">
                                <i class="fas fa-save me-1"></i> Save Email Settings
                            </button>
                        </form>
                    </div>
                    
                    <!-- Appearance Settings -->
                    <div class="tab-pane fade" id="appearance" role="tabpanel" aria-labelledby="appearance-tab">
                        <h5 class="mb-4">Appearance Settings</h5>
                        <form id="appearanceSettingsForm">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label">Store Logo</label>
                                    <div class="card p-3 mb-3">
                                        <div class="text-center">
                                            <svg width="200" height="100" class="img-fluid mb-3" style="max-height: 100px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                                                <rect width="200" height="100" fill="#f8f9fa"/>
                                                <text x="100" y="55" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif" font-size="14">Store Logo</text>
                                            </svg>
                                            <div>
                                                <button type="button" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-upload me-1"></i> Upload New Logo
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger ms-2">
                                                    <i class="fas fa-trash-alt me-1"></i> Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Favicon</label>
                                    <div class="card p-3 mb-3">
                                        <div class="text-center">
                                            <svg width="32" height="32" class="img-fluid mb-3" style="max-height: 32px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                                                <rect width="32" height="32" fill="#f8f9fa"/>
                                                <text x="16" y="20" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif" font-size="10">Icon</text>
                                            </svg>
                                            <div>
                                                <button type="button" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-upload me-1"></i> Upload Favicon
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger ms-2">
                                                    <i class="fas fa-trash-alt me-1"></i> Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="mb-3">Theme Colors</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="primaryColor" class="form-label">Primary Color</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <input type="color" class="form-control form-control-color p-0" id="appearancePrimaryColorPicker" value="#0d6efd">
                                            </span>
                                            <input type="text" class="form-control" id="primaryColor" name="primary_color" value="#0d6efd">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="secondaryColor" class="form-label">Secondary Color</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <input type="color" class="form-control form-control-color p-0" id="secondaryColorPicker" value="#6c757d">
                                            </span>
                                            <input type="text" class="form-control" id="secondaryColor" name="secondary_color" value="#6c757d">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="accentColor" class="form-label">Accent Color</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <input type="color" class="form-control form-control-color p-0" id="accentColorPicker" value="#fd7e14">
                                            </span>
                                            <input type="text" class="form-control" id="accentColor" name="accent_color" value="#fd7e14">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="backgroundColor" class="form-label">Background Color</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <input type="color" class="form-control form-control-color p-0" id="appearanceBackgroundColorPicker" value="#f8f9fa">
                                            </span>
                                            <input type="text" class="form-control" id="backgroundColor" name="background_color" value="#f8f9fa">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="mb-3">Homepage Layout</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body p-2">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="homepage_layout" id="layoutDefault" value="default" checked>
                                                    <label class="form-check-label" for="layoutDefault">
                                                        Default Layout
                                                    </label>
                                                </div>
                                                <svg width="250" height="150" class="img-fluid mt-2" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                                                    <rect width="250" height="150" fill="#f8f9fa"/>
                                                    <text x="125" y="80" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif" font-size="14">Default Layout</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body p-2">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="homepage_layout" id="layoutAlternative" value="alternative">
                                                    <label class="form-check-label" for="layoutAlternative">
                                                        Alternative Layout
                                                    </label>
                                                </div>
                                                <svg width="250" height="150" class="img-fluid mt-2" style="background-color: #e9ecef; border: 1px solid #dee2e6; border-radius: 4px;">
                                                    <rect width="250" height="150" fill="#e9ecef"/>
                                                    <text x="125" y="80" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif" font-size="14">Alternative Layout</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary" id="saveAppearanceSettingsBtn">
                                <i class="fas fa-save me-1"></i> Save Appearance Settings
                            </button>
                        </form>
                    </div>
                    
                    <!-- Checkout Customization -->
                    <div class="tab-pane fade" id="checkout" role="tabpanel" aria-labelledby="checkout-tab">
                        <h5 class="mb-4">Checkout Page Customization</h5>
                        <form id="checkoutCustomizationForm">
                            {% csrf_token %}
                            <!-- Page Header Section -->
                            <div class="mb-4">
                                <h6 class="mb-3">Page Header</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="page_title" class="form-label">Page Title</label>
                                        <input type="text" class="form-control" id="page_title" name="page_title">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="page_subtitle" class="form-label">Page Subtitle</label>
                                        <input type="text" class="form-control" id="page_subtitle" name="page_subtitle">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Customer Information Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-user me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Customer Information Fields</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-heading me-2" style="color: var(--primary-color, #930000);"></i>Section Header</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="customer_section_title" class="form-label fw-medium">Section Title</label>
                                            <input type="text" class="form-control" id="customer_section_title" name="customer_section_title" placeholder="Customer Information">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Full Name Fields -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-signature me-2" style="color: var(--primary-color, #930000);"></i>Full Name Field</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="full_name_label" class="form-label fw-medium">Field Label</label>
                                                <input type="text" class="form-control" id="full_name_label" name="full_name_label" placeholder="Full Name">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="full_name_placeholder" class="form-label fw-medium">Placeholder Text</label>
                                                <input type="text" class="form-control" id="full_name_placeholder" name="full_name_placeholder" placeholder="Enter your full name">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="full_name_default" class="form-label fw-medium">Default Value</label>
                                                <input type="text" class="form-control" id="full_name_default" name="full_name_default" placeholder="Optional default value">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Email Fields -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-envelope me-2" style="color: var(--primary-color, #930000);"></i>Email Field</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="email_label" class="form-label fw-medium">Field Label</label>
                                                <input type="text" class="form-control" id="email_label" name="email_label" placeholder="Email Address *">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="email_placeholder" class="form-label fw-medium">Placeholder Text</label>
                                                <input type="text" class="form-control" id="email_placeholder" name="email_placeholder" placeholder="Enter your email address">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="email_default" class="form-label fw-medium">Default Value</label>
                                                <input type="email" class="form-control" id="email_default" name="email_default" placeholder="Optional default email">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Phone Fields -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-phone me-2" style="color: var(--primary-color, #930000);"></i>Phone Field</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="phone_label" class="form-label fw-medium">Field Label</label>
                                                <input type="text" class="form-control" id="phone_label" name="phone_label" placeholder="Phone Number *">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="phone_placeholder" class="form-label fw-medium">Placeholder Text</label>
                                                <input type="text" class="form-control" id="phone_placeholder" name="phone_placeholder" placeholder="Enter your phone number">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="phone_default" class="form-label fw-medium">Default Value</label>
                                                <input type="tel" class="form-control" id="phone_default" name="phone_default" placeholder="Optional default phone">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Shipping Address Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-map-marker-alt me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Shipping Address Configuration</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-home me-2" style="color: var(--primary-color, #930000);"></i>Address Field Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="shipping_section_title" class="form-label fw-medium">Section Title</label>
                                                <input type="text" class="form-control" id="shipping_section_title" name="shipping_section_title" placeholder="Shipping Address">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="address_label" class="form-label fw-medium">Address Label</label>
                                                <input type="text" class="form-control" id="address_label" name="address_label" placeholder="Street Address">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="address_placeholder" class="form-label fw-medium">Address Placeholder</label>
                                                <input type="text" class="form-control" id="address_placeholder" name="address_placeholder" placeholder="Enter your complete address">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="address_default" class="form-label fw-medium">Default Address Value</label>
                                            <textarea class="form-control" id="address_default" name="address_default" rows="2" placeholder="Optional default address text"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Instructions Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-clipboard-list me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Order Instructions Configuration</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-pencil-alt me-2" style="color: var(--primary-color, #930000);"></i>Instructions Field Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="instructions_section_title" class="form-label fw-medium">Section Title</label>
                                                <input type="text" class="form-control" id="instructions_section_title" name="instructions_section_title" placeholder="Order Instructions">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="instructions_label" class="form-label fw-medium">Field Label</label>
                                                <input type="text" class="form-control" id="instructions_label" name="instructions_label" placeholder="Special Instructions (Optional)">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="instructions_placeholder" class="form-label fw-medium">Placeholder Text</label>
                                                <input type="text" class="form-control" id="instructions_placeholder" name="instructions_placeholder" placeholder="Any special delivery instructions...">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="instructions_help_text" class="form-label fw-medium">Help Text</label>
                                                <input type="text" class="form-control" id="instructions_help_text" name="instructions_help_text" placeholder="Maximum 500 characters">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping Method Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-truck me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Shipping Method Configuration</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-map-marker-alt me-2" style="color: var(--primary-color, #930000);"></i>Delivery Location Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="shipping_method_section_title" class="form-label fw-medium">Section Title</label>
                                                <input type="text" class="form-control" id="shipping_method_section_title" name="shipping_method_section_title" placeholder="Shipping Method">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="delivery_location_label" class="form-label fw-medium">Location Field Label</label>
                                                <input type="text" class="form-control" id="delivery_location_label" name="delivery_location_label" placeholder="Delivery Location *">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="dhaka_location_label" class="form-label fw-medium">
                                                    <i class="fas fa-city me-1 text-success"></i>Dhaka Location Label
                                                </label>
                                                <input type="text" class="form-control" id="dhaka_location_label" name="dhaka_location_label" placeholder="Dhaka City">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="outside_location_label" class="form-label fw-medium">
                                                    <i class="fas fa-globe me-1 text-info"></i>Outside Dhaka Label
                                                </label>
                                                <input type="text" class="form-control" id="outside_location_label" name="outside_location_label" placeholder="Outside Dhaka">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Methods Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-credit-card me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Payment Methods Configuration</h6>
                                </div>
                                
                                <!-- Payment Method Labels -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-tags me-2" style="color: var(--primary-color, #930000);"></i>Payment Method Labels</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <label for="payment_section_title" class="form-label fw-medium">Section Title</label>
                                                <input type="text" class="form-control" id="payment_section_title" name="payment_section_title" placeholder="Payment Method">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="cod_label" class="form-label fw-medium">COD Label</label>
                                                <input type="text" class="form-control" id="cod_label" name="cod_label" placeholder="Cash on Delivery">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="bkash_label" class="form-label fw-medium">
                                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0U5MUU2MyIvPgo8dGV4dCB4PSIxMiIgeT0iMTUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5iS2FzaDwvdGV4dD4KICA8L3N2Zz4=" alt="bKash" class="me-1" style="width: 16px; height: 16px;">
                                                    bKash Label
                                                </label>
                                                <input type="text" class="form-control" id="bkash_label" name="bkash_label" placeholder="bKash">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="nagad_label" class="form-label fw-medium">
                                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI2ZmNzkwMCIvPgo8dGV4dCB4PSIxMiIgeT0iMTUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI5IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5hZ2FkPC90ZXh0Pgo8L3N2Zz4=" alt="Nagad" class="me-1" style="width: 16px; height: 16px;">
                                                    Nagad Label
                                                </label>
                                                <input type="text" class="form-control" id="nagad_label" name="nagad_label" placeholder="Nagad">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Merchant Account Numbers -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-building me-2" style="color: var(--primary-color, #930000);"></i>Merchant Account Numbers</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="bkash_merchant_number" class="form-label fw-medium">
                                                    <i class="fas fa-phone me-1" style="color: #E91E63;"></i>bKash Merchant Number
                                                </label>
                                                <input type="text" class="form-control" id="bkash_merchant_number" name="bkash_merchant_number" placeholder="01XXXXXXXXX">
                                                <div class="form-text">Enter your bKash merchant mobile number</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nagad_merchant_number" class="form-label fw-medium">
                                                    <i class="fas fa-phone me-1" style="color: #ff7900;"></i>Nagad Merchant Number
                                                </label>
                                                <input type="text" class="form-control" id="nagad_merchant_number" name="nagad_merchant_number" placeholder="01XXXXXXXXX">
                                                <div class="form-text">Enter your Nagad merchant mobile number</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Payment Instructions -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-info-circle me-2" style="color: var(--primary-color, #930000);"></i>Payment Instructions</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- bKash Instructions -->
                                        <div class="mb-4">
                                            <label for="bkash_instructions" class="form-label fw-medium">
                                                <i class="fas fa-mobile-alt me-1" style="color: #E91E63;"></i>bKash Payment Instructions
                                            </label>
                                            <textarea class="form-control" id="bkash_instructions" name="bkash_instructions" rows="6" placeholder="Enter step-by-step instructions for bKash payment (one instruction per line)"></textarea>
                                            <div class="form-text">
                                                <small>Enter each instruction on a new line. Instructions will be displayed as a numbered list. Available variables: <code>{merchant_number}</code>, <code>{amount}</code></small>
                                            </div>
                                        </div>
                                        
                                        <!-- Nagad Instructions -->
                                        <div class="mb-4">
                                            <label for="nagad_instructions" class="form-label fw-medium">
                                                <i class="fas fa-mobile-alt me-1" style="color: #ff7900;"></i>Nagad Payment Instructions
                                            </label>
                                            <textarea class="form-control" id="nagad_instructions" name="nagad_instructions" rows="6" placeholder="Enter step-by-step instructions for Nagad payment (one instruction per line)"></textarea>
                                            <div class="form-text">
                                                <small>Enter each instruction on a new line. Instructions will be displayed as a numbered list. Available variables: <code>{merchant_number}</code>, <code>{amount}</code></small>
                                            </div>
                                        </div>
                                        
                                        <!-- COD Instructions -->
                                        <div class="mb-3">
                                            <label for="cod_instructions" class="form-label fw-medium">
                                                <i class="fas fa-money-bill-wave me-1" style="color: #28a745;"></i>Cash on Delivery Instructions
                                            </label>
                                            <textarea class="form-control" id="cod_instructions" name="cod_instructions" rows="6" placeholder="Enter step-by-step instructions for cash on delivery (one instruction per line)"></textarea>
                                            <div class="form-text">Enter each instruction on a new line. Instructions will be displayed as a numbered list to customers. Available variables: <code>{amount}</code></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Transaction Field Labels -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-receipt me-2" style="color: var(--primary-color, #930000);"></i>Transaction Field Configuration</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- bKash Transaction Fields -->
                                        <div class="row mb-4">
                                            <div class="col-12">
                                                <h6 class="text-muted mb-3">
                                                    <i class="fas fa-mobile-alt me-1" style="color: #E91E63;"></i>bKash Transaction Fields
                                                </h6>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="bkash_transaction_label" class="form-label fw-medium">Transaction ID Label</label>
                                                <input type="text" class="form-control" id="bkash_transaction_label" name="bkash_transaction_label" placeholder="bKash Transaction ID *">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="bkash_transaction_placeholder" class="form-label fw-medium">Transaction ID Placeholder</label>
                                                <input type="text" class="form-control" id="bkash_transaction_placeholder" name="bkash_transaction_placeholder" placeholder="Enter transaction ID after payment">
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <label for="bkash_sender_label" class="form-label fw-medium">Sender Number Label</label>
                                                <input type="text" class="form-control" id="bkash_sender_label" name="bkash_sender_label" placeholder="Sender Mobile Number *">
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <label for="bkash_sender_placeholder" class="form-label fw-medium">Sender Number Placeholder</label>
                                                <input type="text" class="form-control" id="bkash_sender_placeholder" name="bkash_sender_placeholder" placeholder="01XXXXXXXXX">
                                            </div>
                                        </div>
                                        
                                        <!-- Nagad Transaction Fields -->
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <h6 class="text-muted mb-3">
                                                    <i class="fas fa-mobile-alt me-1" style="color: #ff7900;"></i>Nagad Transaction Fields
                                                </h6>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nagad_transaction_label" class="form-label fw-medium">Transaction ID Label</label>
                                                <input type="text" class="form-control" id="nagad_transaction_label" name="nagad_transaction_label" placeholder="Nagad Transaction ID *">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nagad_transaction_placeholder" class="form-label fw-medium">Transaction ID Placeholder</label>
                                                <input type="text" class="form-control" id="nagad_transaction_placeholder" name="nagad_transaction_placeholder" placeholder="Enter transaction ID after payment">
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <label for="nagad_sender_label" class="form-label fw-medium">Sender Number Label</label>
                                                <input type="text" class="form-control" id="nagad_sender_label" name="nagad_sender_label" placeholder="Sender Mobile Number *">
                                            </div>
                                            <div class="col-md-6 mt-3">
                                                <label for="nagad_sender_placeholder" class="form-label fw-medium">Sender Number Placeholder</label>
                                                <input type="text" class="form-control" id="nagad_sender_placeholder" name="nagad_sender_placeholder" placeholder="01XXXXXXXXX">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Summary Section -->
                            <div class="mb-4">
                                <h6 class="mb-3">Order Summary</h6>
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label for="order_summary_title" class="form-label">Summary Title</label>
                                        <input type="text" class="form-control" id="order_summary_title" name="order_summary_title">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="subtotal_label" class="form-label">Subtotal Label</label>
                                        <input type="text" class="form-control" id="subtotal_label" name="subtotal_label">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="shipping_label" class="form-label">Shipping Label</label>
                                        <input type="text" class="form-control" id="shipping_label" name="shipping_label">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="total_label" class="form-label">Total Label</label>
                                        <input type="text" class="form-control" id="total_label" name="total_label">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="place_order_button_text" class="form-label">Place Order Button Text</label>
                                        <input type="text" class="form-control" id="place_order_button_text" name="place_order_button_text">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="checkoutPrimaryColor" class="form-label">Primary Color</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <input type="color" class="form-control form-control-color p-0" id="checkoutPrimaryColorPicker" value="#930000">
                                            </span>
                                            <input type="text" class="form-control" id="checkoutPrimaryColor" name="primary_color" value="#930000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trust & Security Section -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-shield-alt me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Trust & Security Elements</h6>
                                </div>
                                
                                <!-- Display Options -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-toggle-on me-2" style="color: var(--primary-color, #930000);"></i>Display Options</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="show_security_badges" name="show_security_badges" checked>
                                                    <label class="form-check-label fw-medium" for="show_security_badges">
                                                        <i class="fas fa-lock me-1 text-success"></i>Show Security Badges
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="show_trust_badges" name="show_trust_badges" checked>
                                                    <label class="form-check-label fw-medium" for="show_trust_badges">
                                                        <i class="fas fa-certificate me-1 text-warning"></i>Show Trust Badges
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="show_breadcrumb" name="show_breadcrumb" checked>
                                                    <label class="form-check-label fw-medium" for="show_breadcrumb">
                                                        <i class="fas fa-sitemap me-1 text-info"></i>Show Breadcrumb
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="show_order_summary" name="show_order_summary" checked>
                                                    <label class="form-check-label fw-medium" for="show_order_summary">
                                                        <i class="fas fa-list me-1 text-primary"></i>Show Order Summary
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Security & Trust Text -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-shield-alt me-2" style="color: var(--primary-color, #930000);"></i>Security Badge Text</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="trust_section_title" class="form-label fw-medium">Trust Section Title</label>
                                                <input type="text" class="form-control" id="trust_section_title" name="trust_section_title" placeholder="Why shop with us?">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="security_ssl_text" class="form-label fw-medium">SSL Security Text</label>
                                                <input type="text" class="form-control" id="security_ssl_text" name="security_ssl_text" placeholder="SSL Secured">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="security_safe_text" class="form-label fw-medium">Safe Checkout Text</label>
                                                <input type="text" class="form-control" id="security_safe_text" name="security_safe_text" placeholder="Safe Checkout">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Trust Features -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-star me-2" style="color: var(--primary-color, #930000);"></i>Trust Features</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="fast_shipping_title" class="form-label fw-medium">
                                                    <i class="fas fa-shipping-fast me-1 text-success"></i>Fast Shipping Title
                                                </label>
                                                <input type="text" class="form-control" id="fast_shipping_title" name="fast_shipping_title" placeholder="Fast Shipping">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="fast_shipping_description" class="form-label fw-medium">Fast Shipping Description</label>
                                                <input type="text" class="form-control" id="fast_shipping_description" name="fast_shipping_description" placeholder="Free shipping on orders over $50">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="easy_returns_title" class="form-label fw-medium">
                                                    <i class="fas fa-undo-alt me-1 text-warning"></i>Easy Returns Title
                                                </label>
                                                <input type="text" class="form-control" id="easy_returns_title" name="easy_returns_title" placeholder="Easy Returns">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="easy_returns_description" class="form-label fw-medium">Easy Returns Description</label>
                                                <input type="text" class="form-control" id="easy_returns_description" name="easy_returns_description" placeholder="30-day return policy">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="support_title" class="form-label fw-medium">
                                                    <i class="fas fa-headset me-1 text-info"></i>Support Title
                                                </label>
                                                <input type="text" class="form-control" id="support_title" name="support_title" placeholder="24/7 Support">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="support_description" class="form-label fw-medium">Support Description</label>
                                                <input type="text" class="form-control" id="support_description" name="support_description" placeholder="Customer service available">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Breadcrumb Configuration -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-sitemap me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Breadcrumb Configuration</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-link me-2" style="color: var(--primary-color, #930000);"></i>Breadcrumb Labels</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="breadcrumb_home" class="form-label fw-medium">
                                                    <i class="fas fa-home me-1 text-success"></i>Home Label
                                                </label>
                                                <input type="text" class="form-control" id="breadcrumb_home" name="breadcrumb_home" placeholder="Home">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="breadcrumb_cart" class="form-label fw-medium">
                                                    <i class="fas fa-shopping-cart me-1 text-warning"></i>Cart Label
                                                </label>
                                                <input type="text" class="form-control" id="breadcrumb_cart" name="breadcrumb_cart" placeholder="Cart">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="breadcrumb_checkout" class="form-label fw-medium">
                                                    <i class="fas fa-credit-card me-1 text-info"></i>Checkout Label
                                                </label>
                                                <input type="text" class="form-control" id="breadcrumb_checkout" name="breadcrumb_checkout" placeholder="Checkout">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Customization -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-palette me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Theme Customization</h6>
                                </div>
                                
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-paint-brush me-2" style="color: var(--primary-color, #930000);"></i>Color Scheme</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="checkoutCustomPrimaryColor" class="form-label fw-medium">Primary Color</label>
                                                <div class="input-group">
                                                    <span class="input-group-text p-1">
                                                        <input type="color" class="form-control form-control-color border-0 p-0" id="checkoutCustomPrimaryColorPicker" value="#930000" style="width: 30px; height: 30px;">
                                                    </span>
                                                    <input type="text" class="form-control" id="checkoutCustomPrimaryColor" name="primary_color" value="#930000" placeholder="#930000">
                                                </div>
                                                <div class="form-text">Main brand color for buttons and highlights</div>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="button_color" class="form-label fw-medium">Button Color</label>
                                                <div class="input-group">
                                                    <span class="input-group-text p-1">
                                                        <input type="color" class="form-control form-control-color border-0 p-0" id="buttonColorPicker" value="#930000" style="width: 30px; height: 30px;">
                                                    </span>
                                                    <input type="text" class="form-control" id="button_color" name="button_color" value="#930000" placeholder="#930000">
                                                </div>
                                                <div class="form-text">Color for action buttons</div>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="checkoutBackgroundColor" class="form-label fw-medium">Background Color</label>
                                                <div class="input-group">
                                                    <span class="input-group-text p-1">
                                                        <input type="color" class="form-control form-control-color border-0 p-0" id="checkoutBackgroundColorPicker" value="#f8fafc" style="width: 30px; height: 30px;">
                                                    </span>
                                                    <input type="text" class="form-control" id="checkoutBackgroundColor" name="background_color" value="#f8fafc" placeholder="#f8fafc">
                                                </div>
                                                <div class="form-text">Background color for sections</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Loading & Success Messages -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-comment-dots me-2" style="color: var(--primary-color, #930000); font-size: 1.25rem;"></i>
                                    <h6 class="mb-0">Messages & Notifications</h6>
                                </div>
                                
                                <!-- Loading Messages -->
                                <div class="card border-0 shadow-sm mb-3">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-spinner me-2" style="color: var(--primary-color, #930000);"></i>Loading Messages</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="loading_cart_message" class="form-label fw-medium">Loading Cart Message</label>
                                                <input type="text" class="form-control" id="loading_cart_message" name="loading_cart_message" placeholder="Loading order items...">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="loading_shipping_message" class="form-label fw-medium">Loading Shipping Message</label>
                                                <input type="text" class="form-control" id="loading_shipping_message" name="loading_shipping_message" placeholder="Loading shipping options...">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="processing_order_message" class="form-label fw-medium">Processing Order Message</label>
                                                <input type="text" class="form-control" id="processing_order_message" name="processing_order_message" placeholder="Processing...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Success/Error Messages -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header border-0" style="background-color: var(--secondary-color, #334155); color: white;">
                                        <h6 class="mb-0"><i class="fas fa-exclamation-circle me-2" style="color: var(--primary-color, #930000);"></i>Status Messages</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="order_success_message" class="form-label fw-medium">
                                                    <i class="fas fa-check-circle me-1 text-success"></i>Success Message
                                                </label>
                                                <input type="text" class="form-control" id="order_success_message" name="order_success_message" placeholder="Order placed successfully!">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="order_error_message" class="form-label fw-medium">
                                                    <i class="fas fa-times-circle me-1 text-danger"></i>Error Message
                                                </label>
                                                <input type="text" class="form-control" id="order_error_message" name="order_error_message" placeholder="Error processing order. Please try again.">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="validation_error_message" class="form-label fw-medium">
                                                    <i class="fas fa-exclamation-triangle me-1 text-warning"></i>Validation Error
                                                </label>
                                                <input type="text" class="form-control" id="validation_error_message" name="validation_error_message" placeholder="Please check your information and try again.">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-primary" id="saveCheckoutCustomizationBtn">
                                    <i class="fas fa-save me-1"></i> Save Checkout Settings
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="resetCheckoutToDefaultsBtn">
                                    <i class="fas fa-undo me-1"></i> Reset to Defaults
                                </button>
                                <button type="button" class="btn btn-outline-info" id="previewCheckoutBtn">
                                    <i class="fas fa-eye me-1"></i> Preview Checkout
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Template Modal -->
<div class="modal fade" id="emailTemplateModal" tabindex="-1" aria-labelledby="emailTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="emailTemplateModalLabel">Edit Email Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="emailSubject" class="form-label">Email Subject</label>
                    <input type="text" class="form-control" id="emailSubject" name="email_subject" value="Your order has been confirmed">
                </div>
                <div class="mb-3">
                    <label for="emailTemplate" class="form-label">Email Template</label>
                    <textarea class="form-control" id="emailTemplate" name="email_template" rows="10">
<!DOCTYPE html>
<html>
<head>
    <title>Order Confirmation</title>
</head>
<body>
    <h1>Thank you for your order!</h1>
    <p>Dear {customer_name},</p>
    <p>Your order #{order_number} has been confirmed and is now being processed.</p>
    <p>Order Details:</p>
    <p>{order_details}</p>
    <p>Best regards,<br>{store_name} Team</p>
</body>
</html>
                    </textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Available Variables:</label>
                    <div class="p-2 bg-light rounded border">
                        <code>{customer_name}</code>, <code>{order_number}</code>, <code>{order_details}</code>, <code>{store_name}</code>, <code>{total_amount}</code>, <code>{shipping_address}</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary me-auto" id="testEmailTemplateBtn">
                    <i class="fas fa-paper-plane me-1"></i> Send Test Email
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveEmailTemplateBtn">Save Template</button>
            </div>
        </div>
    </div>
</div>

<!-- Media Library Modal -->
<div class="modal fade" id="mediaLibraryModal" tabindex="-1" aria-labelledby="mediaLibraryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #930000, #d32f2f);">
                <h5 class="modal-title text-white" id="mediaLibraryModalLabel">
                    <i class="fas fa-images me-2"></i>Media Library
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Manual Path Entry -->
                <div class="manual-path-container">
                    <h6 class="fw-bold mb-3"><i class="fas fa-edit me-2 text-primary"></i>Enter Path Manually</h6>
                    <div class="input-group">
                        <span class="input-group-text">/media/</span>
                        <input type="text" class="form-control" id="manualPath" placeholder="images/logo.png">
                        <button class="btn btn-outline-primary" type="button" onclick="useManualPath()">
                            <i class="fas fa-check me-1"></i>Use Path
                        </button>
                    </div>
                    <small class="text-muted mt-2 d-block">
                        <i class="fas fa-info-circle me-1"></i>
                        Enter the file path relative to the media folder (e.g., images/logo.png)
                    </small>
                </div>

                <!-- Media Grid -->
                <h6 class="fw-bold mb-3"><i class="fas fa-folder me-2 text-warning"></i>Browse Files</h6>
                <div class="media-grid" id="mediaGrid">
                    <!-- Sample media items -->
                    <div class="media-item" onclick="selectMedia('/media/images/logo.png', this)">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3ELogo%3C/text%3E%3C/svg%3E" alt="Logo" class="preview-image">
                        <div class="file-name">logo.png</div>
                    </div>
                    <div class="media-item" onclick="selectMedia('/media/images/favicon.ico', this)">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EFavicon%3C/text%3E%3C/svg%3E" alt="Favicon" class="preview-image">
                        <div class="file-name">favicon.ico</div>
                    </div>
                    <div class="media-item" onclick="selectMedia('/media/images/hero-banner.jpg', this)">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EBanner%3C/text%3E%3C/svg%3E" alt="Banner" class="preview-image">
                        <div class="file-name">hero-banner.jpg</div>
                    </div>
                    <div class="media-item" onclick="selectMedia('/media/images/footer-logo.png', this)">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EFooter%3C/text%3E%3C/svg%3E" alt="Footer Logo" class="preview-image">
                        <div class="file-name">footer-logo.png</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="confirmSelection()" disabled id="confirmBtn">
                    <i class="fas fa-check me-1"></i>Select File
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<style>
/* Custom styles for professional checkout settings design */
.card {
    transition: box-shadow 0.15s ease-in-out;
}

.card:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1) !important;
}

.card-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.form-label {
    color: #495057;
    margin-bottom: 0.5rem;
}

.form-label.fw-medium {
    font-weight: 500;
}

.form-control:focus {
    border-color: var(--bs-primary, #930000);
    box-shadow: 0 0 0 0.2rem rgba(147, 0, 0, 0.25);
}

.form-control-color {
    border-radius: 0.375rem;
}

.input-group-text {
    background-color: #f8f9fa;
    border-color: #dee2e6;
}

.text-primary {
    color: var(--bs-primary, #930000) !important;
}

.nav-pills .nav-link {
    color: #6c757d;
    border-radius: 0.5rem;
    margin-bottom: 0.25rem;
    transition: all 0.15s ease-in-out;
}

.nav-pills .nav-link:hover {
    background-color: rgba(147, 0, 0, 0.1);
    color: var(--bs-primary, #930000);
}

.nav-pills .nav-link.active {
    background-color: var(--bs-primary, #930000);
    color: white;
}

.form-check-input:checked {
    background-color: var(--bs-primary, #930000);
    border-color: var(--bs-primary, #930000);
}

.form-check-input:focus {
    border-color: var(--bs-primary, #930000);
    box-shadow: 0 0 0 0.25rem rgba(147, 0, 0, 0.25);
}

.btn-primary {
    background-color: var(--bs-primary, #930000);
    border-color: var(--bs-primary, #930000);
}

.btn-primary:hover {
    background-color: #7a0000;
    border-color: #7a0000;
}

.btn-outline-primary {
    color: var(--bs-primary, #930000);
    border-color: var(--bs-primary, #930000);
}

.btn-outline-primary:hover {
    background-color: var(--bs-primary, #930000);
    border-color: var(--bs-primary, #930000);
}

.shadow-sm {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
}

.border-0 {
    border: 0 !important;
}

.bg-light {
    background-color: #f8f9fa !important;
}

/* Icon styling */
.fa-mobile-alt, .fa-phone {
    font-size: 0.875rem;
}

/* Color picker improvements */
.form-control-color {
    width: 100%;
    height: 100%;
    cursor: pointer;
}

/* Form text styling */
.form-text {
    font-size: 0.875rem;
    color: #6c757d;
}

/* Responsive improvements */
@media (max-width: 768px) {
    .col-md-3, .col-md-4, .col-md-6 {
        margin-bottom: 1rem;
    }
}

/* Animation for alerts */
.alert {
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Textarea styling */
textarea.form-control {
    resize: vertical;
    min-height: 100px;
}

/* Button group spacing */
.d-flex.gap-2 > * {
    margin-right: 0.5rem;
}

.d-flex.gap-2 > *:last-child {
    margin-right: 0;
}

/* Custom scrollbar for long forms */
.card-body {
    max-height: none;
}

/* Enhanced form section styling */
.mb-4:last-child {
    margin-bottom: 2rem !important;
}

/* Settings navigation styling */
.nav-pills {
    --bs-nav-pills-border-radius: 0.5rem;
    --bs-nav-pills-link-active-bg: var(--bs-primary, #930000);
}

/* Card hover effects */
.card-header:hover {
    background-color: #e9ecef !important;
}

/* Icon colors for different payment methods */
.text-bkash {
    color: #E91E63;
}

.text-nagad {
    color: #ff7900;
}

.text-cod {
    color: #28a745;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Popup Alert System
    function showAlert(message, type = 'success', duration = 4000) {
        const alertTypes = {
            'success': { icon: 'fas fa-check-circle', class: 'alert-success' },
            'error': { icon: 'fas fa-exclamation-circle', class: 'alert-danger' },
            'warning': { icon: 'fas fa-exclamation-triangle', class: 'alert-warning' },
            'info': { icon: 'fas fa-info-circle', class: 'alert-info' }
        };

        const alertConfig = alertTypes[type] || alertTypes['success'];
        
        const alertHtml = `
            <div class="alert ${alertConfig.class} alert-dismissible popup-alert" role="alert">
                <i class="${alertConfig.icon} me-2"></i>
                ${message}
                <button type="button" class="btn-close" aria-label="Close"></button>
            </div>
        `;

        const alertElement = document.createElement('div');
        alertElement.innerHTML = alertHtml;
        const alert = alertElement.firstElementChild;
        
        document.body.appendChild(alert);

        // Auto-dismiss after specified duration
        const timeoutId = setTimeout(() => {
            dismissAlert(alert);
        }, duration);

        // Manual dismiss functionality
        const closeBtn = alert.querySelector('.btn-close');
        if (closeBtn) {
            closeBtn.onclick = () => {
                clearTimeout(timeoutId);
                dismissAlert(alert);
            };
        }

        return alert;
    }

    function dismissAlert(alert) {
        if (alert && alert.parentNode) {
            alert.classList.add('hiding');
            setTimeout(() => {
                if (alert && alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 300);
        }
    }

    // Link color pickers to their text inputs
    function setupColorPickers() {
        const colorPairs = [
            { picker: 'appearancePrimaryColorPicker', input: 'primaryColor' },
            { picker: 'secondaryColorPicker', input: 'secondaryColor' },
            { picker: 'accentColorPicker', input: 'accentColor' },
            { picker: 'appearanceBackgroundColorPicker', input: 'backgroundColor' }
        ];
        
        colorPairs.forEach(pair => {
            const picker = document.getElementById(pair.picker);
            const input = document.getElementById(pair.input);
            
            if (picker && input) {
                picker.addEventListener('input', function() {
                    input.value = this.value;
                });
                
                input.addEventListener('input', function() {
                    if (this.value.startsWith('#') && (this.value.length === 4 || this.value.length === 7)) {
                        picker.value = this.value;
                    }
                });
            }
        });
    }
    
    // Initialize Settings
    function initSettings() {
        setupColorPickers();
        
        // Add event listeners for saving settings with popup alerts
        const saveButtons = [
            { id: 'saveGeneralSettingsBtn', message: 'General settings saved successfully!', formId: 'generalSettingsForm', endpoint: '/mb-admin/settings/' },
            { id: 'saveEmailSettingsBtn', message: 'Email settings saved successfully!', formId: 'emailSettingsForm', endpoint: '/mb-admin/settings/' },
            { id: 'saveAppearanceSettingsBtn', message: 'Appearance settings saved successfully!', formId: 'appearanceSettingsForm', endpoint: '/mb-admin/settings/' },
            { id: 'saveCheckoutCustomizationBtn', message: 'Checkout settings saved successfully!', formId: 'checkoutCustomizationForm', endpoint: '/mb-admin/settings/' }
        ];

        saveButtons.forEach(button => {
            const element = document.getElementById(button.id);
            if (element) {
                element.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Add loading state
                    const originalText = this.innerHTML;
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Saving...';
                    
                    // Get form data
                    const formElement = document.getElementById(button.formId);
                    if (!formElement) {
                        this.disabled = false;
                        this.innerHTML = originalText;
                        showAlert('Form not found!', 'error');
                        return;
                    }
                    
                    const formData = new FormData(formElement);
                    
                    // Submit form data via AJAX
                    fetch(button.endpoint, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken')
                        }
                    })
                    .then(response => {
                        console.log('Response status:', response.status);
                        console.log('Response headers:', response.headers.get('content-type'));
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) {
                            return response.json();
                        } else {
                            throw new Error('Response is not JSON');
                        }
                    })
                    .then(data => {
                        // Reset button
                        this.disabled = false;
                        this.innerHTML = originalText;
                        
                        if (data.success) {
                            // Show success alert
                            showAlert(button.message, 'success');
                            
                            // Optionally refresh the page to show updated values
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        } else {
                            showAlert(data.message || 'Error saving settings', 'error');
                        }
                    })
                    .catch(error => {
                        // Reset button
                        this.disabled = false;
                        this.innerHTML = originalText;
                        
                        console.error('Error saving settings:', error);
                        showAlert('Error saving settings. Please try again.', 'error');
                    });
                });
            }
        });
        
        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Media Library Modal System
        let currentTargetInput = null;
        let selectedMediaPath = null;

        window.openMediaLibrary = function(inputId) {
            currentTargetInput = inputId;
            selectedMediaPath = null;
            
            // Clear previous selections
            document.querySelectorAll('.media-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Clear manual path
            const manualPathInput = document.getElementById('manualPath');
            if (manualPathInput) {
                manualPathInput.value = '';
            }
            
            // Disable confirm button
            const confirmBtn = document.getElementById('confirmBtn');
            if (confirmBtn) {
                confirmBtn.disabled = true;
            }
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('mediaLibraryModal'));
            modal.show();
        };

        window.selectMedia = function(path, element) {
            // Remove previous selections
            document.querySelectorAll('.media-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Select current item
            element.classList.add('selected');
            selectedMediaPath = path;
            
            // Enable confirm button
            const confirmBtn = document.getElementById('confirmBtn');
            if (confirmBtn) {
                confirmBtn.disabled = false;
            }
        };

        window.useManualPath = function() {
            const manualPath = document.getElementById('manualPath').value.trim();
            if (manualPath) {
                selectedMediaPath = '/media/' + manualPath.replace(/^\/+/, '');
                
                // Clear grid selections
                document.querySelectorAll('.media-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Enable confirm button
                const confirmBtn = document.getElementById('confirmBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                }
            }
        };

        window.confirmSelection = function() {
            if (selectedMediaPath && currentTargetInput) {
                // Set the input value
                document.getElementById(currentTargetInput).value = selectedMediaPath;
                
                // Update preview
                updateImagePreview(currentTargetInput, selectedMediaPath);
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('mediaLibraryModal'));
                modal.hide();
                
                // Show success alert
                showAlert('Image path selected successfully!', 'success');
            }
        };

        function updateImagePreview(inputId, imagePath) {
            const previewId = inputId + 'Preview';
            const previewContainer = document.getElementById(previewId);
            
            if (previewContainer && imagePath) {
                const fullPath = imagePath.startsWith('/') ? imagePath : '/' + imagePath;
                previewContainer.innerHTML = `
                    <div class="d-flex align-items-center p-2 bg-light rounded mt-2">
                        <img src="${fullPath}" alt="Preview" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;" 
                             onerror="this.style.display='none'">
                        <div class="ms-2 flex-grow-1">
                            <small class="text-muted">${fullPath}</small>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearImagePath('${inputId}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
        }

        window.clearImagePath = function(inputId) {
            document.getElementById(inputId).value = '';
            const previewId = inputId + 'Preview';
            const previewContainer = document.getElementById(previewId);
            if (previewContainer) {
                previewContainer.innerHTML = '<div class="text-muted small">No image selected</div>';
            }
        };

        // Auto-update preview when input changes
        const imageInputs = ['siteLogo', 'siteFavicon', 'footerLogo'];
        imageInputs.forEach(inputId => {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value) {
                        updateImagePreview(inputId, value);
                    } else {
                        clearImagePath(inputId);
                    }
                });
            }
        });
        
        // Test email functionality
        const testEmailBtn = document.getElementById('testEmailBtn');
        if (testEmailBtn) {
            testEmailBtn.addEventListener('click', function() {
                const originalText = this.innerHTML;
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Sending...';
                
                setTimeout(() => {
                    this.disabled = false;
                    this.innerHTML = originalText;
                    showAlert('Test email sent successfully!', 'info');
                }, 2000);
            });
        }
        
        // Other button handlers
        const resetCheckoutBtn = document.getElementById('resetCheckoutToDefaultsBtn');
        if (resetCheckoutBtn) {
            resetCheckoutBtn.addEventListener('click', function() {
                resetCheckoutToDefaults();
            });
        }
        
        const previewCheckoutBtn = document.getElementById('previewCheckoutBtn');
        if (previewCheckoutBtn) {
            previewCheckoutBtn.addEventListener('click', function() {
                previewCheckout();
            });
        }
        
        // Set up Email Template Modal
        setupEmailTemplateModal();
        
        // Load checkout customization on page load
        loadCheckoutCustomization();
    }
    
    // Email Template Modal Setup
    function setupEmailTemplateModal() {
        const emailTemplateModal = document.getElementById('emailTemplateModal');
        
        emailTemplateModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const templateType = button.getAttribute('data-template');
            
            // Load template data based on templateType
            loadEmailTemplate(templateType);
        });
        
        document.getElementById('saveEmailTemplateBtn').addEventListener('click', function() {
            saveEmailTemplate();
        });
        
        document.getElementById('testEmailTemplateBtn').addEventListener('click', function() {
            sendTestTemplateEmail();
        });
    }
    
    // Initialize settings when DOM is loaded
    initSettings();
    
    // Call initSettings immediately for testing
    console.log('Settings page loaded');
});  // Close DOMContentLoaded

// Media Library Functions
    function openMediaLibrary(inputId) {
        // Simple media library simulation - you can replace this with your actual media library
        const mediaFiles = [
            'media/logos/site-logo.png',
            'media/logos/footer-logo.png', 
            'media/icons/favicon.ico',
            'media/images/banner.jpg',
            'media/images/product-placeholder.png'
        ];
        
        let modalHtml = `
            <div class="modal fade" id="mediaLibraryModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-images me-2"></i>Media Library
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="media-grid">
                                        ${mediaFiles.map(file => `
                                            <div class="media-item" onclick="selectMedia('${file}', '${inputId}')">
                                                <div class="media-thumbnail">
                                                    <img src="/${file}" alt="${file}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 4px;">
                                                </div>
                                                <div class="media-name">${file.split('/').pop()}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="media-details">
                                        <h6>Manual Path Entry</h6>
                                        <div class="mb-3">
                                            <label for="manualPath" class="form-label">Enter Image Path:</label>
                                            <input type="text" class="form-control" id="manualPath" placeholder="media/images/your-image.jpg">
                                        </div>
                                        <button type="button" class="btn btn-primary btn-sm" onclick="selectManualPath('${inputId}')">
                                            <i class="fas fa-check me-1"></i>Use This Path
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
            <style>
                .media-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                    gap: 15px;
                    max-height: 400px;
                    overflow-y: auto;
                }
                .media-item {
                    cursor: pointer;
                    border: 2px solid transparent;
                    border-radius: 8px;
                    padding: 8px;
                    transition: all 0.3s ease;
                }
                .media-item:hover {
                    border-color: var(--primary-color, #930000);
                    background-color: #f8f9fa;
                }
                .media-name {
                    font-size: 12px;
                    text-align: center;
                    margin-top: 5px;
                    word-break: break-word;
                }
                .media-details {
                    background-color: #f8f9fa;
                    padding: 15px;
                    border-radius: 8px;
                }
            </style>
        `;
        
        // Remove existing modal if present
        const existingModal = document.getElementById('mediaLibraryModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // Add modal to DOM
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('mediaLibraryModal'));
        modal.show();
    }
    
    function selectMedia(filePath, inputId) {
        document.getElementById(inputId).value = filePath;
        updateImagePreview(inputId, filePath);
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('mediaLibraryModal'));
        modal.hide();
        
        showAlert('Image selected successfully!', 'success');
    }
    
    function selectManualPath(inputId) {
        const manualPath = document.getElementById('manualPath').value.trim();
        if (manualPath) {
            document.getElementById(inputId).value = manualPath;
            updateImagePreview(inputId, manualPath);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('mediaLibraryModal'));
            modal.hide();
            
            showAlert('Manual path set successfully!', 'success');
        } else {
            showAlert('Please enter a valid path', 'error');
        }
    }
    
    function updateImagePreview(inputId, filePath) {
        let previewId = '';
        switch(inputId) {
            case 'siteLogo':
                previewId = 'siteLogoPreview';
                break;
            case 'siteFavicon':
                previewId = 'siteFaviconPreview';
                break;
            case 'footerLogo':
                previewId = 'footerLogoPreview';
                break;
        }
        
        if (previewId) {
            const previewElement = document.getElementById(previewId);
            if (previewElement) {
                const maxHeight = inputId === 'siteFavicon' ? '32px' : inputId === 'footerLogo' ? '50px' : '60px';
                previewElement.innerHTML = `<img src="/${filePath}" alt="Preview" style="max-height: ${maxHeight}; border: 1px solid #dee2e6; border-radius: 4px;">`;
            }
        }
    }

    // Enhanced Alert Function with Popup
    function showAlert(message, type = 'info') {
        // Remove existing alerts
        const existingAlerts = document.querySelectorAll('.custom-alert');
        existingAlerts.forEach(alert => alert.remove());
        
        // Create alert element
        const alertDiv = document.createElement('div');
        alertDiv.className = `custom-alert alert-${type}`;
        
        const alertIcons = {
            'success': 'fas fa-check-circle',
            'error': 'fas fa-exclamation-circle',
            'warning': 'fas fa-exclamation-triangle',
            'info': 'fas fa-info-circle'
        };
        
        const alertColors = {
            'success': '#28a745',
            'error': '#dc3545',
            'warning': '#ffc107',
            'info': '#17a2b8'
        };
        
        alertDiv.innerHTML = `
            <div class="alert-content">
                <i class="${alertIcons[type] || alertIcons.info}" style="color: ${alertColors[type] || alertColors.info};"></i>
                <span class="alert-message">${message}</span>
                <button type="button" class="alert-close" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        // Add styles
        alertDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid ${alertColors[type] || alertColors.info};
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1060;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
        `;
        
        // Add animation styles
        if (!document.getElementById('alert-animations')) {
            const styleSheet = document.createElement('style');
            styleSheet.id = 'alert-animations';
            styleSheet.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .alert-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                .alert-message {
                    flex: 1;
                    font-weight: 500;
                }
                .alert-close {
                    background: none;
                    border: none;
                    font-size: 14px;
                    cursor: pointer;
                    color: #6c757d;
                    padding: 0;
                    margin-left: 10px;
                }
                .alert-close:hover {
                    color: #495057;
                }
            `;
            document.head.appendChild(styleSheet);
        }
        
        // Add to DOM
        document.body.appendChild(alertDiv);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentElement) {
                alertDiv.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => alertDiv.remove(), 300);
            }
        }, 5000);
    }

    // Mock functions for API interactions
    function saveSettings(settingType) {
        const form = document.getElementById(`${settingType}SettingsForm`);
        const formData = new FormData(form);
        
        // Convert FormData to object
        const settings = {};
        for (const [key, value] of formData.entries()) {
            settings[key] = value;
        }
        
        // Mock API call
        console.log(`Saving ${settingType} settings:`, settings);
        
        // Show success message
        showAlert(`${settingType.charAt(0).toUpperCase() + settingType.slice(1)} settings saved successfully!`, 'success');
    }
    
    function loadEmailTemplate(templateType) {
        // Mock loading template data
        let subject = '';
        let template = '';
        
        switch (templateType) {
            case 'order_confirmation':
                subject = 'Your order has been confirmed';
                template = `<!DOCTYPE html>
<html>
<head>
    <title>Order Confirmation</title>
</head>
<body>
    <h1>Thank you for your order!</h1>
    <p>Dear {customer_name},</p>
    <p>Your order #{order_number} has been confirmed and is now being processed.</p>
    <p>Order Details:</p>
    <p>{order_details}</p>
    <p>Best regards,<br>{store_name} Team</p>
</body>
</html>`;
                break;
            case 'shipping_confirmation':
                subject = 'Your order has been shipped';
                template = `<!DOCTYPE html>
<html>
<head>
    <title>Shipping Confirmation</title>
</head>
<body>
    <h1>Your order has been shipped!</h1>
    <p>Dear {customer_name},</p>
    <p>Your order #{order_number} has been shipped and is on its way to you.</p>
    <p>Shipping Details:</p>
    <p>Tracking Number: {tracking_number}</p>
    <p>Best regards,<br>{store_name} Team</p>
</body>
</html>`;
                break;
            case 'account_creation':
                subject = 'Welcome to {store_name}';
                template = `<!DOCTYPE html>
<html>
<head>
    <title>Welcome to Our Store</title>
</head>
<body>
    <h1>Welcome to {store_name}!</h1>
    <p>Dear {customer_name},</p>
    <p>Thank you for creating an account with us. Your account has been successfully created.</p>
    <p>Best regards,<br>{store_name} Team</p>
</body>
</html>`;
                break;
            case 'password_reset':
                subject = 'Password Reset Request';
                template = `<!DOCTYPE html>
<html>
<head>
    <title>Password Reset</title>
</head>
<body>
    <h1>Password Reset Request</h1>
    <p>Dear {customer_name},</p>
    <p>We received a request to reset your password. Please click the link below to reset your password:</p>
    <p><a href="{reset_link}">Reset Password</a></p>
    <p>If you did not request this, please ignore this email.</p>
    <p>Best regards,<br>{store_name} Team</p>
</body>
</html>`;
                break;
        }
        
        // Update modal title
        document.getElementById('emailTemplateModalLabel').textContent = `Edit ${templateType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())} Template`;
        
        // Set form values
        document.getElementById('emailSubject').value = subject;
        document.getElementById('emailTemplate').value = template;
    }
    
    function saveEmailTemplate() {
        const subject = document.getElementById('emailSubject').value;
        const template = document.getElementById('emailTemplate').value;
        
        // Mock API call
        console.log('Saving email template:', { subject, template });
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('emailTemplateModal'));
        modal.hide();
        
        // Show success message
        showAlert('Email template saved successfully!', 'success');
    }
    
    function sendTestEmail() {
        // Mock API call
        console.log('Sending test email with SMTP configuration...');
        
        // Show success message
        showAlert('Test email sent successfully! Please check your inbox.', 'success');
    }
    
    function sendTestTemplateEmail() {
        // Mock API call
        console.log('Sending test email with current template...');
        
        // Show success message
        showAlert('Test email sent successfully! Please check your inbox.', 'success');
    }
    
    // Helper function to show alert messages
    function showAlert(message, type) {
        // Create alert element
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        // Insert at the top of the content area
        const tabContent = document.querySelector('.tab-content');
        tabContent.insertBefore(alertDiv, tabContent.firstChild);
        
        // Auto dismiss after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                const bsAlert = bootstrap.Alert.getOrCreateInstance(alertDiv);
                bsAlert.close();
            }
        }, 5000);
    }
    
    // ===== CHECKOUT CUSTOMIZATION FUNCTIONS =====
    
    function loadCheckoutCustomization() {
        console.log('Loading checkout customization settings...');
        
        fetch('/mb-admin/api/checkout-customization/active_settings/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.settings) {
                populateCheckoutForm(data.settings);
                console.log('Checkout customization loaded successfully');
            } else {
                console.log('No checkout customization found, using defaults');
            }
        })
        .catch(error => {
            console.error('Error loading checkout customization:', error);
            showAlert('Failed to load checkout customization settings', 'danger');
        });
    }
    
    function populateCheckoutForm(settings) {
        // Populate all form fields with settings data
        Object.keys(settings).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                if (element.type === 'checkbox') {
                    element.checked = settings[key];
                } else if (element.type === 'color') {
                    element.value = settings[key] || '#930000';
                } else {
                    element.value = settings[key] || '';
                }
            }
        });
        
        // Update color picker for primary color
        const primaryColorPicker = document.getElementById('checkoutCustomPrimaryColorPicker');
        const primaryColorInput = document.getElementById('checkoutCustomPrimaryColor');
        if (primaryColorPicker && primaryColorInput && settings.primary_color) {
            primaryColorPicker.value = settings.primary_color;
            primaryColorInput.value = settings.primary_color;
        }
    }
    
    function saveCheckoutCustomization() {
        console.log('Saving checkout customization...');
        
        const form = document.getElementById('checkoutCustomizationForm');
        const formData = new FormData(form);
        
        // Convert FormData to object
        const settings = {};
        for (const [key, value] of formData.entries()) {
            settings[key] = value;
        }
        
        // Handle checkboxes (they won't appear in FormData if unchecked)
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            settings[checkbox.name] = checkbox.checked;
        });
        
        // Make API call to save settings
        fetch('/mb-admin/api/checkout-customization/bulk_update/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            },
            body: JSON.stringify(settings)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('Checkout customization saved successfully!', 'success');
                console.log('Checkout customization saved:', data);
            } else {
                showAlert(`Failed to save: ${data.error || 'Unknown error'}`, 'danger');
                console.error('Save error:', data);
            }
        })
        .catch(error => {
            console.error('Error saving checkout customization:', error);
            showAlert('Error saving checkout customization', 'danger');
        });
    }
    
    function resetCheckoutToDefaults() {
        if (!confirm('Are you sure you want to reset all checkout customization settings to defaults? This action cannot be undone.')) {
            return;
        }
        
        console.log('Resetting checkout customization to defaults...');
        
        fetch('/mb-admin/api/checkout-customization/reset_to_defaults/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('Checkout customization reset to defaults successfully!', 'success');
                populateCheckoutForm(data.settings);
                console.log('Reset successful:', data);
            } else {
                showAlert(`Failed to reset: ${data.error || 'Unknown error'}`, 'danger');
                console.error('Reset error:', data);
            }
        })
        .catch(error => {
            console.error('Error resetting checkout customization:', error);
            showAlert('Error resetting checkout customization', 'danger');
        });
    }
    
    function previewCheckout() {
        // Open checkout page in new tab/window for preview
        window.open('/checkout/', '_blank');
    }
    
    // Helper functions for authentication and CSRF
    function getAuthToken() {
        // Return auth token if using token authentication
        // For session-based auth, this might not be needed
        return '';
    }
    
    function getCsrfToken() {
        // Get CSRF token from cookie or meta tag
        const token = document.querySelector('[name=csrfmiddlewaretoken]');
        if (token) {
            return token.value;
        }
        
        // Try to get from cookie
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'csrftoken') {
                return value;
            }
        }
        
        return '';
    }
    
    // Setup color picker synchronization for checkout customization
    const colorPickers = [
        { picker: 'checkoutPrimaryColorPicker', input: 'checkoutPrimaryColor' },
        { picker: 'buttonColorPicker', input: 'button_color' },
        { picker: 'checkoutBackgroundColorPicker', input: 'checkoutBackgroundColor' },
        { picker: 'checkoutCustomPrimaryColorPicker', input: 'checkoutCustomPrimaryColor' }
    ];
    
    colorPickers.forEach(pair => {
        const picker = document.getElementById(pair.picker);
        const input = document.getElementById(pair.input);
        
        if (picker && input) {
            picker.addEventListener('input', function() {
                input.value = this.value;
            });
            
            input.addEventListener('input', function() {
                if (this.value.startsWith('#') && (this.value.length === 4 || this.value.length === 7)) {
                    picker.value = this.value;
                }
            });
        }
    });
</script>
{% endblock %}