{% extends 'dashboard/base.html' %}

{% block title %}My Profile - MB Admin{% endblock %}

{% block page_title %}My Profile{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <div class="mb-4">
                    <div class="position-relative d-inline-block">
                        <img src="https://via.placeholder.com/150" alt="Admin Avatar" class="rounded-circle img-thumbnail" style="width: 150px; height: 150px; object-fit: cover;">
                        <button class="btn btn-sm btn-primary position-absolute bottom-0 end-0" data-bs-toggle="modal" data-bs-target="#uploadAvatarModal">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                </div>
                <h5 class="mb-1">Administrator</h5>
                <p class="text-muted mb-3">Super Admin</p>
                <div class="d-flex justify-content-center mb-3">
                    <span class="badge bg-success me-2">
                        <i class="fas fa-check-circle me-1"></i> Active
                    </span>
                    <span class="badge bg-info">
                        <i class="fas fa-shield-alt me-1"></i> 2FA Enabled
                    </span>
                </div>
                <div class="mb-3">
                    <p class="text-muted mb-1">Last Login</p>
                    <p class="mb-0">October 12, 2023 14:25:36</p>
                </div>
                <div class="mb-3">
                    <p class="text-muted mb-1">Account Created</p>
                    <p class="mb-0">January 15, 2023</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Personal Information</h5>
            </div>
            <div class="card-body">
                <form id="personalInfoForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" name="first_name" value="Admin">
                        </div>
                        <div class="col-md-6">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" name="last_name" value="User">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" value="admin" readonly>
                            <small class="text-muted">Username cannot be changed</small>
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email" name="email" value="admin@example.com">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="bio" class="form-label">Bio</label>
                        <textarea class="form-control" id="bio" name="bio" rows="3">Store administrator managing all operations.</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="position" class="form-label">Position</label>
                        <input type="text" class="form-control" id="position" name="position" value="Store Manager">
                    </div>
                    <button type="button" class="btn btn-primary" id="savePersonalInfoBtn">
                        <i class="fas fa-save me-1"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Security Settings</h5>
            </div>
            <div class="card-body">
                <form id="securitySettingsForm">
                    <h6 class="mb-3">Change Password</h6>
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" name="current_password">
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="new_password">
                        </div>
                        <div class="col-md-6">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirm_password">
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar bg-danger" role="progressbar" id="passwordStrength" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted" id="passwordStrengthText">Password strength</small>
                    </div>
                    <button type="button" class="btn btn-primary mb-4" id="changePasswordBtn">
                        <i class="fas fa-key me-1"></i> Change Password
                    </button>
                    
                    <h6 class="mb-3">Two-Factor Authentication</h6>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="enable2fa" checked>
                            <label class="form-check-label" for="enable2fa">
                                Enable Two-Factor Authentication
                            </label>
                        </div>
                        <p class="text-muted small mt-2">Two-factor authentication adds an extra layer of security to your account by requiring more than just a password to sign in.</p>
                    </div>
                    <div class="mb-4" id="twoFactorOptions">
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-mobile-alt fa-2x text-primary"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">Authenticator App</h6>
                                        <p class="mb-0 small">Use an authenticator app like Google Authenticator or Authy</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#setupAuthenticatorModal">
                                            Setup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-sms fa-2x text-primary"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">SMS Authentication</h6>
                                        <p class="mb-0 small">Receive a code via SMS to your registered phone number</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#setupSmsModal">
                                            Setup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h6 class="mb-3">Login Sessions</h6>
                    <div class="table-responsive">
                        <table class="table table-hover table-sm border">
                            <thead>
                                <tr>
                                    <th>Device</th>
                                    <th>Location</th>
                                    <th>IP Address</th>
                                    <th>Last Active</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <i class="fas fa-desktop me-1"></i> Windows 10 - Chrome
                                        <span class="badge bg-success ms-1">Current</span>
                                    </td>
                                    <td>Los Angeles, US</td>
                                    <td>192.168.1.105</td>
                                    <td>Just now</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-danger" disabled>
                                            <i class="fas fa-sign-out-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><i class="fas fa-mobile-alt me-1"></i> iPhone - Safari</td>
                                    <td>Los Angeles, US</td>
                                    <td>192.168.1.106</td>
                                    <td>Yesterday</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-danger" data-session-id="2">
                                            <i class="fas fa-sign-out-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-danger" id="terminateAllSessionsBtn">
                        <i class="fas fa-ban me-1"></i> Terminate All Other Sessions
                    </button>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Notification Preferences</h5>
            </div>
            <div class="card-body">
                <form id="notificationSettingsForm">
                    <div class="mb-3">
                        <label class="form-label">Email Notifications</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="orderNotifications" checked>
                            <label class="form-check-label" for="orderNotifications">
                                New orders
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="productNotifications" checked>
                            <label class="form-check-label" for="productNotifications">
                                Low stock products
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="customerNotifications" checked>
                            <label class="form-check-label" for="customerNotifications">
                                New customer registrations
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="reviewNotifications">
                            <label class="form-check-label" for="reviewNotifications">
                                New product reviews
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="securityNotifications" checked>
                            <label class="form-check-label" for="securityNotifications">
                                Security alerts
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">In-App Notifications</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="inAppOrders" checked>
                            <label class="form-check-label" for="inAppOrders">
                                New orders
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="inAppMessages" checked>
                            <label class="form-check-label" for="inAppMessages">
                                New messages
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="inAppReviews">
                            <label class="form-check-label" for="inAppReviews">
                                New reviews
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="inAppSystem" checked>
                            <label class="form-check-label" for="inAppSystem">
                                System notifications
                            </label>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary" id="saveNotificationSettingsBtn">
                        <i class="fas fa-save me-1"></i> Save Preferences
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Upload Avatar Modal -->
<div class="modal fade" id="uploadAvatarModal" tabindex="-1" aria-labelledby="uploadAvatarModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadAvatarModalLabel">Upload Profile Picture</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="avatarUploadForm">
                    <div class="mb-3">
                        <label for="avatarFile" class="form-label">Select Image</label>
                        <input class="form-control" type="file" id="avatarFile" accept="image/*">
                    </div>
                    <div class="mb-3 text-center d-none" id="avatarPreviewContainer">
                        <img id="avatarPreview" src="" alt="Avatar Preview" class="img-fluid rounded-circle border" style="width: 150px; height: 150px; object-fit: cover;">
                    </div>
                    <div class="mb-3">
                        <div class="alert alert-info small">
                            <i class="fas fa-info-circle me-1"></i> Recommended size: 300x300 pixels. Maximum file size: 2MB.
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveAvatarBtn">Upload</button>
            </div>
        </div>
    </div>
</div>

<!-- Setup Authenticator Modal -->
<div class="modal fade" id="setupAuthenticatorModal" tabindex="-1" aria-labelledby="setupAuthenticatorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="setupAuthenticatorModalLabel">Setup Authenticator App</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <h6>Step 1: Scan this QR Code</h6>
                    <p class="text-muted small">Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)</p>
                    <div class="text-center mb-3">
                        <img src="https://via.placeholder.com/200x200?text=QR+Code" alt="2FA QR Code" class="img-fluid border">
                    </div>
                    <div class="alert alert-info small">
                        <strong>Can't scan the QR code?</strong><br>
                        Use this code instead: <code>ABCD EFGH IJKL MNOP</code>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Step 2: Enter Verification Code</h6>
                    <p class="text-muted small">Enter the 6-digit code shown in your authenticator app</p>
                    <input type="text" class="form-control" id="authCode" placeholder="000000" maxlength="6">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="verifyAuthCodeBtn">Verify & Activate</button>
            </div>
        </div>
    </div>
</div>

<!-- Setup SMS Modal -->
<div class="modal fade" id="setupSmsModal" tabindex="-1" aria-labelledby="setupSmsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="setupSmsModalLabel">Setup SMS Authentication</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <h6>Step 1: Add your phone number</h6>
                    <div class="input-group mb-3">
                        <span class="input-group-text">+1</span>
                        <input type="tel" class="form-control" id="phoneNumber" placeholder="(555) 123-4567">
                        <button class="btn btn-outline-primary" type="button" id="sendCodeBtn">Send Code</button>
                    </div>
                </div>
                
                <div class="mb-3 d-none" id="smsVerificationSection">
                    <h6>Step 2: Enter Verification Code</h6>
                    <p class="text-muted small">Enter the 6-digit code sent to your phone</p>
                    <input type="text" class="form-control" id="smsCode" placeholder="000000" maxlength="6">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary d-none" id="verifySmsCodeBtn">Verify & Activate</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Personal Info Form
    document.getElementById('savePersonalInfoBtn').addEventListener('click', function() {
        const form = document.getElementById('personalInfoForm');
        
        // Mock API call
        console.log('Saving personal info:', new FormData(form));
        
        // Show success alert
        showAlert('Personal information updated successfully!', 'success');
    });
    
    // Password Strength Meter
    const passwordInput = document.getElementById('newPassword');
    const strengthBar = document.getElementById('passwordStrength');
    const strengthText = document.getElementById('passwordStrengthText');
    
    passwordInput.addEventListener('input', function() {
        const value = passwordInput.value;
        let strength = 0;
        let feedback = '';
        
        if (value.length > 0) {
            // Length check
            if (value.length >= 8) strength += 20;
            
            // Lowercase check
            if (/[a-z]/.test(value)) strength += 20;
            
            // Uppercase check
            if (/[A-Z]/.test(value)) strength += 20;
            
            // Number check
            if (/\d/.test(value)) strength += 20;
            
            // Special character check
            if (/[^A-Za-z0-9]/.test(value)) strength += 20;
        }
        
        // Update UI
        strengthBar.style.width = strength + '%';
        
        // Set color and text
        if (strength === 0) {
            strengthBar.className = 'progress-bar';
            strengthText.textContent = 'Password strength';
        } else if (strength <= 40) {
            strengthBar.className = 'progress-bar bg-danger';
            strengthText.textContent = 'Weak password';
        } else if (strength <= 60) {
            strengthBar.className = 'progress-bar bg-warning';
            strengthText.textContent = 'Moderate password';
        } else if (strength <= 80) {
            strengthBar.className = 'progress-bar bg-info';
            strengthText.textContent = 'Strong password';
        } else {
            strengthBar.className = 'progress-bar bg-success';
            strengthText.textContent = 'Very strong password';
        }
    });
    
    // Change Password
    document.getElementById('changePasswordBtn').addEventListener('click', function() {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Simple validation
        if (!currentPassword) {
            showAlert('Please enter your current password', 'danger');
            return;
        }
        
        if (!newPassword) {
            showAlert('Please enter a new password', 'danger');
            return;
        }
        
        if (newPassword !== confirmPassword) {
            showAlert('New passwords do not match', 'danger');
            return;
        }
        
        // Password strength check
        const strength = parseInt(strengthBar.style.width);
        if (strength < 60) {
            showAlert('Please use a stronger password', 'warning');
            return;
        }
        
        // Mock API call
        console.log('Changing password:', {
            current_password: currentPassword,
            new_password: newPassword
        });
        
        // Reset form
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
        strengthBar.style.width = '0%';
        strengthBar.className = 'progress-bar';
        strengthText.textContent = 'Password strength';
        
        // Show success alert
        showAlert('Password changed successfully!', 'success');
    });
    
    // Two-Factor Authentication Toggle
    document.getElementById('enable2fa').addEventListener('change', function() {
        const twoFactorOptions = document.getElementById('twoFactorOptions');
        
        if (this.checked) {
            twoFactorOptions.classList.remove('d-none');
        } else {
            twoFactorOptions.classList.add('d-none');
        }
    });
    
    // Terminate Sessions
    document.querySelector('table').addEventListener('click', function(e) {
        if (e.target.closest('.btn-outline-danger') && !e.target.closest('.btn-outline-danger').disabled) {
            const button = e.target.closest('.btn-outline-danger');
            const sessionId = button.getAttribute('data-session-id');
            
            // Mock API call
            console.log('Terminating session:', sessionId);
            
            // Remove row
            button.closest('tr').remove();
            
            // Show success alert
            showAlert('Session terminated successfully!', 'success');
        }
    });
    
    document.getElementById('terminateAllSessionsBtn').addEventListener('click', function() {
        // Mock API call
        console.log('Terminating all other sessions');
        
        // Remove all rows except current
        const tbody = document.querySelector('table tbody');
        const currentSession = tbody.querySelector('tr:first-child');
        
        tbody.innerHTML = '';
        tbody.appendChild(currentSession);
        
        // Show success alert
        showAlert('All other sessions terminated successfully!', 'success');
    });
    
    // Save Notification Preferences
    document.getElementById('saveNotificationSettingsBtn').addEventListener('click', function() {
        const form = document.getElementById('notificationSettingsForm');
        
        // Mock API call
        const preferences = {
            email_notifications: {
                orders: document.getElementById('orderNotifications').checked,
                products: document.getElementById('productNotifications').checked,
                customers: document.getElementById('customerNotifications').checked,
                reviews: document.getElementById('reviewNotifications').checked,
                security: document.getElementById('securityNotifications').checked
            },
            in_app_notifications: {
                orders: document.getElementById('inAppOrders').checked,
                messages: document.getElementById('inAppMessages').checked,
                reviews: document.getElementById('inAppReviews').checked,
                system: document.getElementById('inAppSystem').checked
            }
        };
        
        console.log('Saving notification preferences:', preferences);
        
        // Show success alert
        showAlert('Notification preferences saved successfully!', 'success');
    });
    
    // Avatar Upload Preview
    document.getElementById('avatarFile').addEventListener('change', function() {
        const file = this.files[0];
        const previewContainer = document.getElementById('avatarPreviewContainer');
        const preview = document.getElementById('avatarPreview');
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                previewContainer.classList.remove('d-none');
            }
            
            reader.readAsDataURL(file);
        } else {
            preview.src = '';
            previewContainer.classList.add('d-none');
        }
    });
    
    // Save Avatar
    document.getElementById('saveAvatarBtn').addEventListener('click', function() {
        const fileInput = document.getElementById('avatarFile');
        
        if (fileInput.files.length === 0) {
            showAlert('Please select an image to upload', 'danger');
            return;
        }
        
        // Mock API call
        console.log('Uploading avatar:', fileInput.files[0].name);
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('uploadAvatarModal'));
        modal.hide();
        
        // Reset form
        document.getElementById('avatarUploadForm').reset();
        document.getElementById('avatarPreviewContainer').classList.add('d-none');
        
        // Show success alert
        showAlert('Profile picture updated successfully!', 'success');
    });
    
    // SMS Verification
    document.getElementById('sendCodeBtn').addEventListener('click', function() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        
        if (!phoneNumber) {
            showAlert('Please enter a phone number', 'danger');
            return;
        }
        
        // Mock API call
        console.log('Sending verification code to:', phoneNumber);
        
        // Show verification section
        document.getElementById('smsVerificationSection').classList.remove('d-none');
        document.getElementById('verifySmsCodeBtn').classList.remove('d-none');
        document.getElementById('sendCodeBtn').textContent = 'Resend Code';
        
        // Show success alert
        showAlert('Verification code sent to your phone!', 'success');
    });
    
    // Verify SMS Code
    document.getElementById('verifySmsCodeBtn').addEventListener('click', function() {
        const code = document.getElementById('smsCode').value;
        
        if (!code || code.length !== 6) {
            showAlert('Please enter a valid 6-digit code', 'danger');
            return;
        }
        
        // Mock API call
        console.log('Verifying SMS code:', code);
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('setupSmsModal'));
        modal.hide();
        
        // Show success alert
        showAlert('SMS verification set up successfully!', 'success');
    });
    
    // Verify Authenticator Code
    document.getElementById('verifyAuthCodeBtn').addEventListener('click', function() {
        const code = document.getElementById('authCode').value;
        
        if (!code || code.length !== 6) {
            showAlert('Please enter a valid 6-digit code', 'danger');
            return;
        }
        
        // Mock API call
        console.log('Verifying authenticator code:', code);
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('setupAuthenticatorModal'));
        modal.hide();
        
        // Show success alert
        showAlert('Authenticator app set up successfully!', 'success');
    });
    
    // Helper function to show alerts
    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        // Insert at the top of content
        const content = document.querySelector('.content-wrapper');
        content.insertBefore(alertDiv, content.firstChild);
        
        // Auto dismiss after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                const bsAlert = bootstrap.Alert.getOrCreateInstance(alertDiv);
                bsAlert.close();
            }
        }, 5000);
    }
});
</script>
{% endblock %}