{% extends 'dashboard/base.html' %}

{% block title %}Staff Account Management - MB Admin{% endblock %}

{% block page_title %}Staff Account Management{% endblock %}

{% block extra_css %}
<style>
    .permission-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transition: all 0.3s ease;
    }
    
    .permission-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .permission-item {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        padding: 8px 12px;
        margin: 3px;
        transition: all 0.2s ease;
    }
    
    .permission-item:hover {
        background: rgba(255,255,255,0.2);
    }
    
    .permission-item.selected {
        background: var(--success-color);
        border-color: var(--success-color);
    }
    
    .staff-card {
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }
    
    .staff-card:hover {
        transform: translateX(5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
    
    .status-active {
        background-color: var(--success-color);
        box-shadow: 0 0 0 2px rgba(5, 150, 105, 0.3);
    }
    
    .status-inactive {
        background-color: var(--danger-color);
        box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.3);
    }
    
    .activity-timeline {
        position: relative;
        padding-left: 30px;
    }
    
    .activity-timeline::before {
        content: '';
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 20px;
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -25px;
        top: 20px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--primary-color);
        border: 3px solid white;
        box-shadow: 0 0 0 2px var(--primary-color);
    }
    
    .search-box {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border-radius: 15px;
        padding: 20px;
        color: white;
        margin-bottom: 25px;
    }
    
    .search-box .form-control {
        background: rgba(255,255,255,0.9);
        border: none;
        border-radius: 25px;
        padding: 12px 20px;
    }
    
    .search-box .btn {
        border-radius: 25px;
        padding: 12px 25px;
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.3);
        color: white;
    }
    
    .search-box .btn:hover {
        background: rgba(255,255,255,0.3);
        transform: translateY(-2px);
    }
    
    .statistics-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
    }
    
    .stat-icon {
        font-size: 3rem;
        opacity: 0.7;
    }
    
    .filter-tabs {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 25px;
        overflow: hidden;
    }
    
    .filter-tab {
        padding: 15px 25px;
        background: transparent;
        border: none;
        color: var(--secondary-color);
        transition: all 0.3s ease;
        position: relative;
    }
    
    .filter-tab.active {
        background: var(--primary-color);
        color: white;
    }
    
    .filter-tab:hover:not(.active) {
        background: rgba(147, 0, 0, 0.1);
        color: var(--primary-color);
    }
</style>
{% endblock %}

{% block content %}
<!-- Statistics Overview -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="statistics-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-1">12</h3>
                    <p class="mb-0">Total Staff</p>
                </div>
                <i class="fas fa-users stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="statistics-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-1">8</h3>
                    <p class="mb-0">Active Users</p>
                </div>
                <i class="fas fa-user-check stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="statistics-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-1">5</h3>
                    <p class="mb-0">Roles</p>
                </div>
                <i class="fas fa-user-tag stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="statistics-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-1">3</h3>
                    <p class="mb-0">Online Now</p>
                </div>
                <i class="fas fa-circle stat-icon text-success"></i>
            </div>
        </div>
    </div>
</div>

<!-- Search and Filter Section -->
<div class="search-box">
    <div class="row align-items-center">
        <div class="col-md-8">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search staff by name, email, or role..." id="staffSearch">
                <button class="btn btn-outline-light" type="button" id="searchBtn">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </div>
        <div class="col-md-4 text-end">
            <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#createStaffModal">
                <i class="fas fa-plus-circle me-2"></i>Create New Staff
            </button>
        </div>
    </div>
</div>

<!-- Filter Tabs -->
<div class="filter-tabs">
    <div class="btn-group w-100" role="group">
        <button type="button" class="filter-tab active" data-filter="all">
            <i class="fas fa-users me-2"></i>All Staff (12)
        </button>
        <button type="button" class="filter-tab" data-filter="active">
            <i class="fas fa-user-check me-2"></i>Active (8)
        </button>
        <button type="button" class="filter-tab" data-filter="inactive">
            <i class="fas fa-user-times me-2"></i>Inactive (4)
        </button>
        <button type="button" class="filter-tab" data-filter="online">
            <i class="fas fa-circle text-success me-2"></i>Online (3)
        </button>
    </div>
</div>

<!-- Staff List -->
<div class="row" id="staffContainer">
    <!-- Staff Member 1 -->
    <div class="col-lg-6 col-xl-4 mb-4 staff-item" data-status="active">
        <div class="card staff-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <span class="status-indicator status-active"></span>
                    <h6 class="mb-0">John Smith</h6>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" data-action="edit" data-id="1"><i class="fas fa-edit me-2"></i>Edit</a></li>
                        <li><a class="dropdown-item" href="#" data-action="permissions" data-id="1"><i class="fas fa-shield-alt me-2"></i>Permissions</a></li>
                        <li><a class="dropdown-item" href="#" data-action="activity" data-id="1"><i class="fas fa-history me-2"></i>Activity Log</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" data-action="delete" data-id="1"><i class="fas fa-trash me-2"></i>Delete</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <small class="text-muted">Email:</small>
                    <p class="mb-1">john.smith@company.com</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Role:</small>
                    <span class="badge bg-primary">Store Manager</span>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Last Login:</small>
                    <p class="mb-1">2 hours ago</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Access Level:</small>
                    <div class="d-flex flex-wrap gap-1 mt-1">
                        <span class="badge bg-success">Dashboard</span>
                        <span class="badge bg-success">Products</span>
                        <span class="badge bg-success">Orders</span>
                        <span class="badge bg-secondary">+5 more</span>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-primary btn-sm me-2" data-action="edit" data-id="1">
                    <i class="fas fa-edit me-1"></i>Edit
                </button>
                <button class="btn btn-outline-info btn-sm" data-action="permissions" data-id="1">
                    <i class="fas fa-shield-alt me-1"></i>Permissions
                </button>
            </div>
        </div>
    </div>

    <!-- Staff Member 2 -->
    <div class="col-lg-6 col-xl-4 mb-4 staff-item" data-status="active">
        <div class="card staff-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <span class="status-indicator status-active"></span>
                    <h6 class="mb-0">Sarah Johnson</h6>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" data-action="edit" data-id="2"><i class="fas fa-edit me-2"></i>Edit</a></li>
                        <li><a class="dropdown-item" href="#" data-action="permissions" data-id="2"><i class="fas fa-shield-alt me-2"></i>Permissions</a></li>
                        <li><a class="dropdown-item" href="#" data-action="activity" data-id="2"><i class="fas fa-history me-2"></i>Activity Log</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" data-action="delete" data-id="2"><i class="fas fa-trash me-2"></i>Delete</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <small class="text-muted">Email:</small>
                    <p class="mb-1">sarah.johnson@company.com</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Role:</small>
                    <span class="badge bg-info">Content Manager</span>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Last Login:</small>
                    <p class="mb-1">Yesterday</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Access Level:</small>
                    <div class="d-flex flex-wrap gap-1 mt-1">
                        <span class="badge bg-success">Products</span>
                        <span class="badge bg-success">Categories</span>
                        <span class="badge bg-success">Media</span>
                        <span class="badge bg-secondary">+2 more</span>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-primary btn-sm me-2" data-action="edit" data-id="2">
                    <i class="fas fa-edit me-1"></i>Edit
                </button>
                <button class="btn btn-outline-info btn-sm" data-action="permissions" data-id="2">
                    <i class="fas fa-shield-alt me-1"></i>Permissions
                </button>
            </div>
        </div>
    </div>

    <!-- Staff Member 3 -->
    <div class="col-lg-6 col-xl-4 mb-4 staff-item" data-status="inactive">
        <div class="card staff-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <span class="status-indicator status-inactive"></span>
                    <h6 class="mb-0">Mike Wilson</h6>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" data-action="edit" data-id="3"><i class="fas fa-edit me-2"></i>Edit</a></li>
                        <li><a class="dropdown-item" href="#" data-action="permissions" data-id="3"><i class="fas fa-shield-alt me-2"></i>Permissions</a></li>
                        <li><a class="dropdown-item" href="#" data-action="activity" data-id="3"><i class="fas fa-history me-2"></i>Activity Log</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" data-action="delete" data-id="3"><i class="fas fa-trash me-2"></i>Delete</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <small class="text-muted">Email:</small>
                    <p class="mb-1">mike.wilson@company.com</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Role:</small>
                    <span class="badge bg-warning">Customer Support</span>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Last Login:</small>
                    <p class="mb-1">5 days ago</p>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Access Level:</small>
                    <div class="d-flex flex-wrap gap-1 mt-1">
                        <span class="badge bg-success">Orders</span>
                        <span class="badge bg-success">Users</span>
                        <span class="badge bg-success">Contacts</span>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-primary btn-sm me-2" data-action="edit" data-id="3">
                    <i class="fas fa-edit me-1"></i>Edit
                </button>
                <button class="btn btn-outline-info btn-sm" data-action="permissions" data-id="3">
                    <i class="fas fa-shield-alt me-1"></i>Permissions
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Load More Button -->
<div class="text-center mt-4">
    <button class="btn btn-outline-primary" id="loadMoreBtn">
        <i class="fas fa-plus-circle me-2"></i>Load More Staff
    </button>
</div>

<!-- Create Staff Modal -->
<div class="modal fade" id="createStaffModal" tabindex="-1" aria-labelledby="createStaffModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h5 class="modal-title" id="createStaffModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Create New Staff Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createStaffForm">
                    <div class="row">
                        <!-- Basic Information -->
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3"><i class="fas fa-user me-2"></i>Basic Information</h6>
                            <div class="mb-3">
                                <label for="staffFirstName" class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="staffFirstName" name="first_name" required>
                            </div>
                            <div class="mb-3">
                                <label for="staffLastName" class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="staffLastName" name="last_name" required>
                            </div>
                            <div class="mb-3">
                                <label for="staffEmail" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="staffEmail" name="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="staffPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="staffPhone" name="phone">
                            </div>
                            <div class="mb-3">
                                <label for="staffDepartment" class="form-label">Department</label>
                                <select class="form-select" id="staffDepartment" name="department">
                                    <option value="">Select Department</option>
                                    <option value="management">Management</option>
                                    <option value="sales">Sales</option>
                                    <option value="support">Customer Support</option>
                                    <option value="content">Content Management</option>
                                    <option value="inventory">Inventory</option>
                                    <option value="marketing">Marketing</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Account Settings -->
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3"><i class="fas fa-cog me-2"></i>Account Settings</h6>
                            <div class="mb-3">
                                <label for="staffUsername" class="form-label">Username *</label>
                                <input type="text" class="form-control" id="staffUsername" name="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="staffPassword" class="form-label">Password *</label>
                                <input type="password" class="form-control" id="staffPassword" name="password" required>
                                <div class="form-text">Must be at least 8 characters long</div>
                            </div>
                            <div class="mb-3">
                                <label for="staffPasswordConfirm" class="form-label">Confirm Password *</label>
                                <input type="password" class="form-control" id="staffPasswordConfirm" name="password_confirm" required>
                            </div>
                            <div class="mb-3">
                                <label for="staffRole" class="form-label">Role *</label>
                                <select class="form-select" id="staffRole" name="role" required>
                                    <option value="">Select Role</option>
                                    <option value="super_admin">Super Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="content_manager">Content Manager</option>
                                    <option value="customer_support">Customer Support</option>
                                    <option value="inventory_manager">Inventory Manager</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="staffActive" name="is_active" checked>
                                    <label class="form-check-label" for="staffActive">Active Account</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="staffEmailNotifications" name="email_notifications" checked>
                                    <label class="form-check-label" for="staffEmailNotifications">Email Notifications</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Permissions -->
                    <div class="mt-4">
                        <h6 class="text-primary mb-3"><i class="fas fa-shield-alt me-2"></i>Dashboard Access Permissions</h6>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="dashboardGroup" data-group="dashboard">
                                            <label class="form-check-label fw-bold" for="dashboardGroup">
                                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_dashboard_view" name="permissions[]" value="dashboard_view" data-group="dashboard">
                                            <label class="form-check-label" for="perm_dashboard_view">View Dashboard</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_dashboard_analytics" name="permissions[]" value="dashboard_analytics" data-group="dashboard">
                                            <label class="form-check-label" for="perm_dashboard_analytics">Analytics</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="productsGroup" data-group="products">
                                            <label class="form-check-label fw-bold" for="productsGroup">
                                                <i class="fas fa-box me-2"></i>Products
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_products_view" name="permissions[]" value="products_view" data-group="products">
                                            <label class="form-check-label" for="perm_products_view">View Products</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_products_add" name="permissions[]" value="products_add" data-group="products">
                                            <label class="form-check-label" for="perm_products_add">Add Products</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_products_edit" name="permissions[]" value="products_edit" data-group="products">
                                            <label class="form-check-label" for="perm_products_edit">Edit Products</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_products_delete" name="permissions[]" value="products_delete" data-group="products">
                                            <label class="form-check-label" for="perm_products_delete">Delete Products</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="categoriesGroup" data-group="categories">
                                            <label class="form-check-label fw-bold" for="categoriesGroup">
                                                <i class="fas fa-folder me-2"></i>Categories
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_categories_view" name="permissions[]" value="categories_view" data-group="categories">
                                            <label class="form-check-label" for="perm_categories_view">View Categories</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_categories_manage" name="permissions[]" value="categories_manage" data-group="categories">
                                            <label class="form-check-label" for="perm_categories_manage">Manage Categories</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="mediaGroup" data-group="media">
                                            <label class="form-check-label fw-bold" for="mediaGroup">
                                                <i class="fas fa-images me-2"></i>Media
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_media_view" name="permissions[]" value="media_view" data-group="media">
                                            <label class="form-check-label" for="perm_media_view">View Media</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_media_upload" name="permissions[]" value="media_upload" data-group="media">
                                            <label class="form-check-label" for="perm_media_upload">Upload Media</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_media_delete" name="permissions[]" value="media_delete" data-group="media">
                                            <label class="form-check-label" for="perm_media_delete">Delete Media</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="stockGroup" data-group="stock">
                                            <label class="form-check-label fw-bold" for="stockGroup">
                                                <i class="fas fa-warehouse me-2"></i>Stock
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_stock_view" name="permissions[]" value="stock_view" data-group="stock">
                                            <label class="form-check-label" for="perm_stock_view">View Stock</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_stock_manage" name="permissions[]" value="stock_manage" data-group="stock">
                                            <label class="form-check-label" for="perm_stock_manage">Manage Stock</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="ordersGroup" data-group="orders">
                                            <label class="form-check-label fw-bold" for="ordersGroup">
                                                <i class="fas fa-shopping-cart me-2"></i>Orders
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_orders_view" name="permissions[]" value="orders_view" data-group="orders">
                                            <label class="form-check-label" for="perm_orders_view">View Orders</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_orders_edit" name="permissions[]" value="orders_edit" data-group="orders">
                                            <label class="form-check-label" for="perm_orders_edit">Edit Orders</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_orders_delete" name="permissions[]" value="orders_delete" data-group="orders">
                                            <label class="form-check-label" for="perm_orders_delete">Delete Orders</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="incompleteOrdersGroup" data-group="incomplete_orders">
                                            <label class="form-check-label fw-bold" for="incompleteOrdersGroup">
                                                <i class="fas fa-clock me-2"></i>Incomplete Orders
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_incomplete_orders_view" name="permissions[]" value="incomplete_orders_view" data-group="incomplete_orders">
                                            <label class="form-check-label" for="perm_incomplete_orders_view">View Incomplete Orders</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_incomplete_orders_manage" name="permissions[]" value="incomplete_orders_manage" data-group="incomplete_orders">
                                            <label class="form-check-label" for="perm_incomplete_orders_manage">Manage Incomplete Orders</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="reviewsGroup" data-group="reviews">
                                            <label class="form-check-label fw-bold" for="reviewsGroup">
                                                <i class="fas fa-star me-2"></i>Reviews
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_reviews_view" name="permissions[]" value="reviews_view" data-group="reviews">
                                            <label class="form-check-label" for="perm_reviews_view">View Reviews</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_reviews_moderate" name="permissions[]" value="reviews_moderate" data-group="reviews">
                                            <label class="form-check-label" for="perm_reviews_moderate">Moderate Reviews</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="contactsGroup" data-group="contacts">
                                            <label class="form-check-label fw-bold" for="contactsGroup">
                                                <i class="fas fa-envelope me-2"></i>Contacts
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_contacts_view" name="permissions[]" value="contacts_view" data-group="contacts">
                                            <label class="form-check-label" for="perm_contacts_view">View Contacts</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_contacts_respond" name="permissions[]" value="contacts_respond" data-group="contacts">
                                            <label class="form-check-label" for="perm_contacts_respond">Respond to Contacts</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="pagesGroup" data-group="pages">
                                            <label class="form-check-label fw-bold" for="pagesGroup">
                                                <i class="fas fa-file-alt me-2"></i>Pages
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_pages_view" name="permissions[]" value="pages_view" data-group="pages">
                                            <label class="form-check-label" for="perm_pages_view">View Pages</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_pages_edit" name="permissions[]" value="pages_edit" data-group="pages">
                                            <label class="form-check-label" for="perm_pages_edit">Edit Pages</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="blocklistGroup" data-group="blocklist">
                                            <label class="form-check-label fw-bold" for="blocklistGroup">
                                                <i class="fas fa-shield-alt me-2"></i>Block List
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_blocklist_view" name="permissions[]" value="blocklist_view" data-group="blocklist">
                                            <label class="form-check-label" for="perm_blocklist_view">View Block List</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_blocklist_manage" name="permissions[]" value="blocklist_manage" data-group="blocklist">
                                            <label class="form-check-label" for="perm_blocklist_manage">Manage Block List</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="usersGroup" data-group="users">
                                            <label class="form-check-label fw-bold" for="usersGroup">
                                                <i class="fas fa-users me-2"></i>Users
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_users_view" name="permissions[]" value="users_view" data-group="users">
                                            <label class="form-check-label" for="perm_users_view">View Users</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_users_edit" name="permissions[]" value="users_edit" data-group="users">
                                            <label class="form-check-label" for="perm_users_edit">Edit Users</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_users_ban" name="permissions[]" value="users_ban" data-group="users">
                                            <label class="form-check-label" for="perm_users_ban">Ban Users</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="expensesGroup" data-group="expenses">
                                            <label class="form-check-label fw-bold" for="expensesGroup">
                                                <i class="fas fa-money-bill-wave me-2"></i>Expenses
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_expenses_view" name="permissions[]" value="expenses_view" data-group="expenses">
                                            <label class="form-check-label" for="perm_expenses_view">View Expenses</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_expenses_manage" name="permissions[]" value="expenses_manage" data-group="expenses">
                                            <label class="form-check-label" for="perm_expenses_manage">Manage Expenses</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="statisticsGroup" data-group="statistics">
                                            <label class="form-check-label fw-bold" for="statisticsGroup">
                                                <i class="fas fa-chart-bar me-2"></i>Statistics
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_statistics_view" name="permissions[]" value="statistics_view" data-group="statistics">
                                            <label class="form-check-label" for="perm_statistics_view">View Statistics</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_statistics_export" name="permissions[]" value="statistics_export" data-group="statistics">
                                            <label class="form-check-label" for="perm_statistics_export">Export Statistics</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="emailSettingsGroup" data-group="email_settings">
                                            <label class="form-check-label fw-bold" for="emailSettingsGroup">
                                                <i class="fas fa-mail-bulk me-2"></i>Email Settings
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_email_settings_view" name="permissions[]" value="email_settings_view" data-group="email_settings">
                                            <label class="form-check-label" for="perm_email_settings_view">View Email Settings</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_email_settings_edit" name="permissions[]" value="email_settings_edit" data-group="email_settings">
                                            <label class="form-check-label" for="perm_email_settings_edit">Edit Email Settings</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="settingsGroup" data-group="settings">
                                            <label class="form-check-label fw-bold" for="settingsGroup">
                                                <i class="fas fa-cog me-2"></i>Settings
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_settings_view" name="permissions[]" value="settings_view" data-group="settings">
                                            <label class="form-check-label" for="perm_settings_view">View Settings</label>
                                        </div>
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_settings_edit" name="permissions[]" value="settings_edit" data-group="settings">
                                            <label class="form-check-label" for="perm_settings_edit">Edit Settings</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="permission-card card h-100">
                                    <div class="card-header">
                                        <div class="form-check">
                                            <input class="form-check-input permission-group" type="checkbox" id="apiDocsGroup" data-group="api_docs">
                                            <label class="form-check-label fw-bold" for="apiDocsGroup">
                                                <i class="fas fa-code me-2"></i>API Docs
                                            </label>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check permission-item">
                                            <input class="form-check-input permission-item-input" type="checkbox" id="perm_api_docs_view" name="permissions[]" value="api_docs_view" data-group="api_docs">
                                            <label class="form-check-label" for="perm_api_docs_view">View API Docs</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Permission Actions -->
                        <div class="mt-3">
                            <button type="button" class="btn btn-success btn-sm me-2" id="selectAllPermissions">
                                <i class="fas fa-check-double me-1"></i>Select All
                            </button>
                            <button type="button" class="btn btn-warning btn-sm me-2" id="clearAllPermissions">
                                <i class="fas fa-times me-1"></i>Clear All
                            </button>
                            <button type="button" class="btn btn-info btn-sm" id="loadPresetPermissions">
                                <i class="fas fa-magic me-1"></i>Load Role Preset
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="createStaffBtn">
                    <i class="fas fa-save me-2"></i>Create Staff Account
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Staff Permissions Modal -->
<div class="modal fade" id="editPermissionsModal" tabindex="-1" aria-labelledby="editPermissionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                <h5 class="modal-title" id="editPermissionsModalLabel">
                    <i class="fas fa-shield-alt me-2"></i>Edit Staff Permissions
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <h6 class="text-primary">Staff Member: <span id="editPermissionsStaffName">John Smith</span></h6>
                        <p class="text-muted mb-0">Role: <span id="editPermissionsStaffRole">Store Manager</span></p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button type="button" class="btn btn-success btn-sm me-2" id="selectAllEditPermissions">
                            <i class="fas fa-check-double me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-warning btn-sm" id="clearAllEditPermissions">
                            <i class="fas fa-times me-1"></i>Clear All
                        </button>
                    </div>
                </div>
                
                <div id="editPermissionsContainer">
                    <!-- Permissions will be loaded dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="savePermissionsBtn">
                    <i class="fas fa-save me-2"></i>Save Permissions
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Activity Log Modal -->
<div class="modal fade" id="activityLogModal" tabindex="-1" aria-labelledby="activityLogModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white;">
                <h5 class="modal-title" id="activityLogModalLabel">
                    <i class="fas fa-history me-2"></i>Activity Log
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6 class="text-primary">Staff Member: <span id="activityLogStaffName">John Smith</span></h6>
                </div>
                
                <div class="activity-timeline">
                    <div class="timeline-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Logged in to dashboard</h6>
                                <p class="text-muted mb-0">IP: 192.168.1.100 | Browser: Chrome</p>
                            </div>
                            <small class="text-muted">2 hours ago</small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Updated product inventory</h6>
                                <p class="text-muted mb-0">Modified stock levels for 5 products</p>
                            </div>
                            <small class="text-muted">4 hours ago</small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Processed customer order</h6>
                                <p class="text-muted mb-0">Order #12345 - Status changed to shipped</p>
                            </div>
                            <small class="text-muted">Yesterday</small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Added new product</h6>
                                <p class="text-muted mb-0">Created "Premium Wireless Headphones"</p>
                            </div>
                            <small class="text-muted">2 days ago</small>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Updated user permissions</h6>
                                <p class="text-muted mb-0">Modified access level for Sarah Johnson</p>
                            </div>
                            <small class="text-muted">3 days ago</small>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-outline-primary">Load More Activities</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Export Log</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteStaffModal" tabindex="-1" aria-labelledby="deleteStaffModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteStaffModalLabel">
                    <i class="fas fa-trash me-2"></i>Delete Staff Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                </div>
                <p class="text-center">Are you sure you want to delete the staff account for <strong id="deleteStaffName">John Smith</strong>?</p>
                <p class="text-center text-danger"><strong>This action cannot be undone!</strong></p>
                
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmDeleteCheckbox">
                    <label class="form-check-label" for="confirmDeleteCheckbox">
                        I understand that this action is permanent
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteStaffBtn" disabled>
                    <i class="fas fa-trash me-2"></i>Delete Account
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Initialize page functionality
    initializeSearch();
    initializeFilters();
    initializePermissions();
    initializeStaffActions();
    initializeModals();
    
    // Search functionality
    function initializeSearch() {
        const searchInput = document.getElementById('staffSearch');
        const searchBtn = document.getElementById('searchBtn');
        
        function performSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            const staffItems = document.querySelectorAll('.staff-item');
            
            staffItems.forEach(item => {
                const staffName = item.querySelector('h6').textContent.toLowerCase();
                const staffEmail = item.querySelector('p').textContent.toLowerCase();
                const staffRole = item.querySelector('.badge').textContent.toLowerCase();
                
                if (staffName.includes(searchTerm) || 
                    staffEmail.includes(searchTerm) || 
                    staffRole.includes(searchTerm)) {
                    item.style.display = 'block';
                    item.classList.add('animate__animated', 'animate__fadeIn');
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Real-time search
        searchInput.addEventListener('input', performSearch);
    }
    
    // Filter functionality
    function initializeFilters() {
        const filterTabs = document.querySelectorAll('.filter-tab');
        
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                filterTabs.forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                this.classList.add('active');
                
                const filter = this.getAttribute('data-filter');
                const staffItems = document.querySelectorAll('.staff-item');
                
                staffItems.forEach(item => {
                    const status = item.getAttribute('data-status');
                    
                    if (filter === 'all') {
                        item.style.display = 'block';
                    } else if (filter === status) {
                        item.style.display = 'block';
                    } else if (filter === 'online' && status === 'active') {
                        // Mock online status - in real app, check actual online status
                        item.style.display = Math.random() > 0.5 ? 'block' : 'none';
                    } else {
                        item.style.display = 'none';
                    }
                    
                    // Add animation
                    if (item.style.display === 'block') {
                        item.classList.add('animate__animated', 'animate__fadeIn');
                    }
                });
            });
        });
    }
    
    // Permission system
    function initializePermissions() {
        // Group checkbox handlers
        document.querySelectorAll('.permission-group').forEach(groupCheckbox => {
            groupCheckbox.addEventListener('change', function() {
                const group = this.getAttribute('data-group');
                const isChecked = this.checked;
                
                // Check/uncheck all items in the group
                document.querySelectorAll(`.permission-item-input[data-group="${group}"]`).forEach(item => {
                    item.checked = isChecked;
                    
                    // Add visual feedback
                    const permissionItem = item.closest('.permission-item');
                    if (isChecked) {
                        permissionItem.classList.add('selected');
                    } else {
                        permissionItem.classList.remove('selected');
                    }
                });
                
                // Update permission card appearance
                const card = this.closest('.permission-card');
                if (isChecked) {
                    card.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                } else {
                    card.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            });
        });
        
        // Individual permission handlers
        document.querySelectorAll('.permission-item-input').forEach(itemCheckbox => {
            itemCheckbox.addEventListener('change', function() {
                const group = this.getAttribute('data-group');
                const groupCheckbox = document.querySelector(`.permission-group[data-group="${group}"]`);
                const groupItems = document.querySelectorAll(`.permission-item-input[data-group="${group}"]`);
                
                // Check if all items in the group are checked
                const allChecked = Array.from(groupItems).every(item => item.checked);
                const anyChecked = Array.from(groupItems).some(item => item.checked);
                
                groupCheckbox.checked = allChecked;
                groupCheckbox.indeterminate = anyChecked && !allChecked;
                
                // Visual feedback
                const permissionItem = this.closest('.permission-item');
                if (this.checked) {
                    permissionItem.classList.add('selected');
                } else {
                    permissionItem.classList.remove('selected');
                }
                
                // Update card appearance based on any checked items
                const card = groupCheckbox.closest('.permission-card');
                if (anyChecked) {
                    card.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                } else {
                    card.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            });
        });
        
        // Permission action buttons
        document.getElementById('selectAllPermissions')?.addEventListener('click', function() {
            document.querySelectorAll('.permission-group').forEach(cb => {
                cb.checked = true;
                cb.dispatchEvent(new Event('change'));
            });
            showAlert('All permissions selected!', 'success');
        });
        
        document.getElementById('clearAllPermissions')?.addEventListener('click', function() {
            document.querySelectorAll('.permission-group').forEach(cb => {
                cb.checked = false;
                cb.dispatchEvent(new Event('change'));
            });
            showAlert('All permissions cleared!', 'warning');
        });
        
        document.getElementById('loadPresetPermissions')?.addEventListener('click', function() {
            const role = document.getElementById('staffRole').value;
            if (!role) {
                showAlert('Please select a role first!', 'warning');
                return;
            }
            
            // Clear all first
            document.getElementById('clearAllPermissions').click();
            
            // Load preset based on role
            const presets = {
                'super_admin': ['dashboard', 'products', 'categories', 'media', 'stock', 'orders', 'incomplete_orders', 'reviews', 'contacts', 'pages', 'blocklist', 'users', 'expenses', 'statistics', 'email_settings', 'settings', 'api_docs'],
                'manager': ['dashboard', 'products', 'categories', 'media', 'stock', 'orders', 'incomplete_orders', 'reviews', 'contacts', 'pages', 'users', 'expenses', 'statistics'],
                'content_manager': ['dashboard', 'products', 'categories', 'media', 'pages', 'reviews'],
                'customer_support': ['dashboard', 'orders', 'incomplete_orders', 'users', 'contacts', 'reviews'],
                'inventory_manager': ['dashboard', 'products', 'categories', 'stock', 'orders']
            };
            
            const rolePermissions = presets[role] || [];
            rolePermissions.forEach(group => {
                const groupCheckbox = document.querySelector(`.permission-group[data-group="${group}"]`);
                if (groupCheckbox) {
                    groupCheckbox.checked = true;
                    groupCheckbox.dispatchEvent(new Event('change'));
                }
            });
            
            showAlert(`Loaded ${role.replace('_', ' ')} permissions!`, 'info');
        });
    }
    
    // Staff actions
    function initializeStaffActions() {
        document.addEventListener('click', function(e) {
            const action = e.target.getAttribute('data-action') || e.target.closest('[data-action]')?.getAttribute('data-action');
            const staffId = e.target.getAttribute('data-id') || e.target.closest('[data-id]')?.getAttribute('data-id');
            
            if (!action || !staffId) return;
            
            switch(action) {
                case 'edit':
                    editStaff(staffId);
                    break;
                case 'permissions':
                    editPermissions(staffId);
                    break;
                case 'activity':
                    viewActivity(staffId);
                    break;
                case 'delete':
                    deleteStaff(staffId);
                    break;
            }
        });
    }
    
    function editStaff(staffId) {
        // Mock staff data - in real app, fetch from API
        const staffData = {
            '1': { name: 'John Smith', email: 'john.smith@company.com', role: 'Store Manager' },
            '2': { name: 'Sarah Johnson', email: 'sarah.johnson@company.com', role: 'Content Manager' },
            '3': { name: 'Mike Wilson', email: 'mike.wilson@company.com', role: 'Customer Support' }
        };
        
        const staff = staffData[staffId];
        if (staff) {
            // Open create modal in edit mode
            document.getElementById('createStaffModalLabel').textContent = 'Edit Staff Account';
            document.getElementById('staffFirstName').value = staff.name.split(' ')[0];
            document.getElementById('staffLastName').value = staff.name.split(' ')[1];
            document.getElementById('staffEmail').value = staff.email;
            
            const modal = new bootstrap.Modal(document.getElementById('createStaffModal'));
            modal.show();
        }
    }
    
    function editPermissions(staffId) {
        const staffData = {
            '1': { name: 'John Smith', role: 'Store Manager' },
            '2': { name: 'Sarah Johnson', role: 'Content Manager' },
            '3': { name: 'Mike Wilson', role: 'Customer Support' }
        };
        
        const staff = staffData[staffId];
        if (staff) {
            document.getElementById('editPermissionsStaffName').textContent = staff.name;
            document.getElementById('editPermissionsStaffRole').textContent = staff.role;
            
            // Clone permissions from create modal
            const originalContainer = document.querySelector('#createStaffModal .row:has(.permission-card)');
            const editContainer = document.getElementById('editPermissionsContainer');
            editContainer.innerHTML = '<div class="row">' + originalContainer.innerHTML + '</div>';
            
            // Initialize permissions for edit modal
            initializeEditPermissions();
            
            const modal = new bootstrap.Modal(document.getElementById('editPermissionsModal'));
            modal.show();
        }
    }
    
    function initializeEditPermissions() {
        // Re-initialize permission functionality for edit modal
        document.querySelectorAll('#editPermissionsModal .permission-group').forEach(groupCheckbox => {
            groupCheckbox.addEventListener('change', function() {
                const group = this.getAttribute('data-group');
                const isChecked = this.checked;
                
                document.querySelectorAll(`#editPermissionsModal .permission-item-input[data-group="${group}"]`).forEach(item => {
                    item.checked = isChecked;
                });
            });
        });
        
        document.getElementById('selectAllEditPermissions')?.addEventListener('click', function() {
            document.querySelectorAll('#editPermissionsModal .permission-group').forEach(cb => {
                cb.checked = true;
                cb.dispatchEvent(new Event('change'));
            });
        });
        
        document.getElementById('clearAllEditPermissions')?.addEventListener('click', function() {
            document.querySelectorAll('#editPermissionsModal .permission-group').forEach(cb => {
                cb.checked = false;
                cb.dispatchEvent(new Event('change'));
            });
        });
    }
    
    function viewActivity(staffId) {
        const staffData = {
            '1': { name: 'John Smith' },
            '2': { name: 'Sarah Johnson' },
            '3': { name: 'Mike Wilson' }
        };
        
        const staff = staffData[staffId];
        if (staff) {
            document.getElementById('activityLogStaffName').textContent = staff.name;
            
            const modal = new bootstrap.Modal(document.getElementById('activityLogModal'));
            modal.show();
        }
    }
    
    function deleteStaff(staffId) {
        const staffData = {
            '1': { name: 'John Smith' },
            '2': { name: 'Sarah Johnson' },
            '3': { name: 'Mike Wilson' }
        };
        
        const staff = staffData[staffId];
        if (staff) {
            document.getElementById('deleteStaffName').textContent = staff.name;
            document.getElementById('confirmDeleteStaffBtn').setAttribute('data-staff-id', staffId);
            
            const modal = new bootstrap.Modal(document.getElementById('deleteStaffModal'));
            modal.show();
        }
    }
    
    // Modal handlers
    function initializeModals() {
        // Create staff form submission
        document.getElementById('createStaffBtn')?.addEventListener('click', function() {
            const form = document.getElementById('createStaffForm');
            if (validateStaffForm(form)) {
                const formData = new FormData(form);
                const staffData = Object.fromEntries(formData.entries());
                
                // Get selected permissions
                staffData.permissions = Array.from(document.querySelectorAll('#createStaffModal input[name="permissions[]"]:checked'))
                    .map(input => input.value);
                
                console.log('Creating staff:', staffData);
                
                // Mock API call
                setTimeout(() => {
                    showAlert('Staff account created successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('createStaffModal')).hide();
                    form.reset();
                    
                    // Reset permissions
                    document.getElementById('clearAllPermissions').click();
                }, 1000);
            }
        });
        
        // Save permissions
        document.getElementById('savePermissionsBtn')?.addEventListener('click', function() {
            const selectedPermissions = Array.from(document.querySelectorAll('#editPermissionsModal input[name="permissions[]"]:checked'))
                .map(input => input.value);
            
            console.log('Saving permissions:', selectedPermissions);
            
            showAlert('Permissions updated successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('editPermissionsModal')).hide();
        });
        
        // Delete confirmation
        document.getElementById('confirmDeleteCheckbox')?.addEventListener('change', function() {
            document.getElementById('confirmDeleteStaffBtn').disabled = !this.checked;
        });
        
        document.getElementById('confirmDeleteStaffBtn')?.addEventListener('click', function() {
            const staffId = this.getAttribute('data-staff-id');
            
            console.log('Deleting staff:', staffId);
            
            showAlert('Staff account deleted successfully!', 'info');
            bootstrap.Modal.getInstance(document.getElementById('deleteStaffModal')).hide();
            
            // Remove staff card from UI
            document.querySelector(`[data-id="${staffId}"]`)?.closest('.staff-item').remove();
        });
        
        // Reset modal when hidden
        document.getElementById('createStaffModal')?.addEventListener('hidden.bs.modal', function() {
            document.getElementById('createStaffModalLabel').textContent = 'Create New Staff Account';
            document.getElementById('createStaffForm').reset();
            document.getElementById('clearAllPermissions')?.click();
        });
    }
    
    // Form validation
    function validateStaffForm(form) {
        const password = form.querySelector('#staffPassword').value;
        const confirmPassword = form.querySelector('#staffPasswordConfirm').value;
        
        if (password !== confirmPassword) {
            showAlert('Passwords do not match!', 'danger');
            return false;
        }
        
        if (password.length < 8) {
            showAlert('Password must be at least 8 characters long!', 'danger');
            return false;
        }
        
        const selectedPermissions = document.querySelectorAll('#createStaffModal input[name="permissions[]"]:checked');
        if (selectedPermissions.length === 0) {
            showAlert('Please select at least one permission!', 'warning');
            return false;
        }
        
        return form.checkValidity();
    }
    
    // Load more functionality
    document.getElementById('loadMoreBtn')?.addEventListener('click', function() {
        this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Loading...';
        
        // Mock loading more staff
        setTimeout(() => {
            this.innerHTML = '<i class="fas fa-plus-circle me-2"></i>Load More Staff';
            showAlert('No more staff to load', 'info');
        }, 2000);
    });
    
    // Auto-generate username from name
    document.getElementById('staffFirstName')?.addEventListener('input', generateUsername);
    document.getElementById('staffLastName')?.addEventListener('input', generateUsername);
    
    function generateUsername() {
        const firstName = document.getElementById('staffFirstName').value.toLowerCase();
        const lastName = document.getElementById('staffLastName').value.toLowerCase();
        
        if (firstName && lastName) {
            const username = firstName + '.' + lastName;
            document.getElementById('staffUsername').value = username;
        }
    }
    
    // Utility function for alerts
    function showAlert(message, type) {
        // Remove existing alerts
        document.querySelectorAll('.alert').forEach(alert => alert.remove());
        
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        document.body.appendChild(alertDiv);
        
        // Auto dismiss after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                const bsAlert = bootstrap.Alert.getOrCreateInstance(alertDiv);
                bsAlert.close();
            }
        }, 5000);
    }
    
    // Add smooth animations
    function addAnimations() {
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .animate__animated {
                animation-duration: 0.5s;
                animation-fill-mode: both;
            }
            
            .animate__fadeIn {
                animation-name: fadeIn;
            }
        `;
        document.head.appendChild(style);
    }
    
    addAnimations();
    
    // Initialize tooltips and popovers
    if (typeof bootstrap !== 'undefined') {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Initialize popovers
        const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
        });
    }
});
</script>
{% endblock %}