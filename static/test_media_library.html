<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Library Test</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .media-item {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
        }
        .media-item:hover {
            border-color: #930000;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .media-item.selected {
            border-color: #930000;
            background-color: rgba(147, 0, 0, 0.1);
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .preview-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        .file-name {
            font-size: 0.85em;
            padding: 8px;
            background: rgba(0,0,0,0.05);
            text-align: center;
        }
        .manual-path-container {
            background: rgba(248, 249, 250, 1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .popup-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideInRight 0.5s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Media Library Test</h2>
        
        <!-- Image Path Input with Media Library -->
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="siteLogoPath" class="form-label fw-medium">Site Logo Path</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="siteLogoPath" name="site_logo" placeholder="/media/images/logo.png">
                    <button class="btn btn-outline-secondary" type="button" onclick="openMediaLibrary('siteLogoPath')">
                        <i class="fas fa-folder-open"></i> Browse
                    </button>
                </div>
                <div id="siteLogoPreview" class="mt-2"></div>
            </div>
            <div class="col-md-6">
                <label for="siteFaviconPath" class="form-label fw-medium">Site Favicon Path</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="siteFaviconPath" name="site_favicon" placeholder="/media/images/favicon.ico">
                    <button class="btn btn-outline-secondary" type="button" onclick="openMediaLibrary('siteFaviconPath')">
                        <i class="fas fa-folder-open"></i> Browse
                    </button>
                </div>
                <div id="siteFaviconPreview" class="mt-2"></div>
            </div>
        </div>

        <!-- Test Save Button -->
        <button type="button" class="btn btn-primary" onclick="testSaveButton()">
            <i class="fas fa-save me-2"></i>Test Save Button
        </button>
    </div>

    <!-- Media Library Modal -->
    <div class="modal fade" id="mediaLibraryModal" tabindex="-1" aria-labelledby="mediaLibraryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #930000, #d32f2f);">
                    <h5 class="modal-title text-white" id="mediaLibraryModalLabel">
                        <i class="fas fa-images me-2"></i>Media Library
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Manual Path Entry -->
                    <div class="manual-path-container">
                        <h6 class="fw-bold mb-3"><i class="fas fa-edit me-2 text-primary"></i>Enter Path Manually</h6>
                        <div class="input-group">
                            <span class="input-group-text">/media/</span>
                            <input type="text" class="form-control" id="manualPath" placeholder="images/logo.png">
                            <button class="btn btn-outline-primary" type="button" onclick="useManualPath()">
                                <i class="fas fa-check me-1"></i>Use Path
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block">
                            <i class="fas fa-info-circle me-1"></i>
                            Enter the file path relative to the media folder (e.g., images/logo.png)
                        </small>
                    </div>

                    <!-- Media Grid -->
                    <h6 class="fw-bold mb-3"><i class="fas fa-folder me-2 text-warning"></i>Browse Files</h6>
                    <div class="media-grid" id="mediaGrid">
                        <!-- Sample media items -->
                        <div class="media-item" onclick="selectMedia('/media/images/logo.png', this)">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3ELogo%3C/text%3E%3C/svg%3E" alt="Logo" class="preview-image">
                            <div class="file-name">logo.png</div>
                        </div>
                        <div class="media-item" onclick="selectMedia('/media/images/favicon.ico', this)">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EFavicon%3C/text%3E%3C/svg%3E" alt="Favicon" class="preview-image">
                            <div class="file-name">favicon.ico</div>
                        </div>
                        <div class="media-item" onclick="selectMedia('/media/images/hero-banner.jpg', this)">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EBanner%3C/text%3E%3C/svg%3E" alt="Banner" class="preview-image">
                            <div class="file-name">hero-banner.jpg</div>
                        </div>
                        <div class="media-item" onclick="selectMedia('/media/images/footer-logo.png', this)">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='120' fill='%23f8f9fa'%3E%3Crect width='150' height='120' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236c757d'%3EFooter%3C/text%3E%3C/svg%3E" alt="Footer Logo" class="preview-image">
                            <div class="file-name">footer-logo.png</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="confirmSelection()" disabled id="confirmBtn">
                        <i class="fas fa-check me-1"></i>Select File
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentTargetInput = null;
        let selectedMediaPath = null;

        function openMediaLibrary(inputId) {
            currentTargetInput = inputId;
            selectedMediaPath = null;
            
            // Clear previous selections
            document.querySelectorAll('.media-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Clear manual path
            document.getElementById('manualPath').value = '';
            
            // Disable confirm button
            document.getElementById('confirmBtn').disabled = true;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('mediaLibraryModal'));
            modal.show();
        }

        function selectMedia(path, element) {
            // Remove previous selections
            document.querySelectorAll('.media-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Select current item
            element.classList.add('selected');
            selectedMediaPath = path;
            
            // Enable confirm button
            document.getElementById('confirmBtn').disabled = false;
        }

        function useManualPath() {
            const manualPath = document.getElementById('manualPath').value.trim();
            if (manualPath) {
                selectedMediaPath = '/media/' + manualPath.replace(/^\/+/, '');
                
                // Clear grid selections
                document.querySelectorAll('.media-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Enable confirm button
                document.getElementById('confirmBtn').disabled = false;
            }
        }

        function confirmSelection() {
            if (selectedMediaPath && currentTargetInput) {
                // Set the input value
                document.getElementById(currentTargetInput).value = selectedMediaPath;
                
                // Update preview
                updateImagePreview(currentTargetInput, selectedMediaPath);
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('mediaLibraryModal'));
                modal.hide();
                
                // Show success alert
                showAlert('File path selected successfully!', 'success');
            }
        }

        function updateImagePreview(inputId, imagePath) {
            const previewId = inputId + 'Preview';
            const previewContainer = document.getElementById(previewId);
            
            if (previewContainer && imagePath) {
                previewContainer.innerHTML = `
                    <div class="d-flex align-items-center p-2 bg-light rounded">
                        <img src="${imagePath}" alt="Preview" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;" 
                             onerror="this.style.display='none'">
                        <div class="ms-2 flex-grow-1">
                            <small class="text-muted">${imagePath}</small>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearImagePath('${inputId}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
        }

        function clearImagePath(inputId) {
            document.getElementById(inputId).value = '';
            const previewId = inputId + 'Preview';
            const previewContainer = document.getElementById(previewId);
            if (previewContainer) {
                previewContainer.innerHTML = '';
            }
        }

        function testSaveButton() {
            showAlert('Settings saved successfully!', 'success');
        }

        function showAlert(message, type = 'info') {
            const alertTypes = {
                'success': { icon: 'fas fa-check-circle', class: 'alert-success' },
                'error': { icon: 'fas fa-exclamation-circle', class: 'alert-danger' },
                'warning': { icon: 'fas fa-exclamation-triangle', class: 'alert-warning' },
                'info': { icon: 'fas fa-info-circle', class: 'alert-info' }
            };

            const alertConfig = alertTypes[type] || alertTypes['info'];
            
            const alertHtml = `
                <div class="alert ${alertConfig.class} alert-dismissible popup-alert" role="alert">
                    <i class="${alertConfig.icon} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" aria-label="Close"></button>
                </div>
            `;

            const alertElement = document.createElement('div');
            alertElement.innerHTML = alertHtml;
            const alert = alertElement.firstElementChild;
            
            document.body.appendChild(alert);

            // Auto-dismiss after 3 seconds
            setTimeout(() => {
                if (alert && alert.parentNode) {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (alert && alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 300);
                }
            }, 3000);

            // Manual dismiss
            const closeBtn = alert.querySelector('.btn-close');
            if (closeBtn) {
                closeBtn.onclick = () => {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (alert && alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 300);
                };
            }
        }

        // Auto-update preview when input changes
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['siteLogoPath', 'siteFaviconPath'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', function() {
                        const value = this.value.trim();
                        if (value) {
                            updateImagePreview(inputId, value);
                        } else {
                            clearImagePath(inputId);
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>