<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coupon Display Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-container { max-width: 600px; margin: 0 auto; }
        .order-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .order-table th, .order-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .order-table tfoot td { font-weight: bold; }
        .text-end { text-align: right; }
        .text-success { color: green; }
        .result { background: #f9f9f9; padding: 15px; margin: 20px 0; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Order Coupon Display Test</h1>
        
        <div class="result">
            <h3>Test Order: MB1051</h3>
            <p><strong>Expected:</strong> Coupon SAVE50 with ৳50 discount should be visible</p>
        </div>
        
        <table class="order-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Test Product</td>
                    <td>1</td>
                    <td class="text-end">৳850.00</td>
                    <td class="text-end">৳850.00</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" class="text-end">Subtotal:</td>
                    <td class="text-end" id="orderDetailSubtotal">৳0.00</td>
                </tr>
                <tr>
                    <td colspan="3" class="text-end">Shipping:</td>
                    <td class="text-end" id="orderDetailShipping">৳0.00</td>
                </tr>
                <tr id="orderDetailCouponRow" style="display: none;">
                    <td colspan="3" class="text-end text-success">Coupon Discount (<span id="orderDetailCouponCode"></span>):</td>
                    <td class="text-end text-success" id="orderDetailCouponDiscount">৳0.00</td>
                </tr>
                <tr>
                    <td colspan="3" class="text-end">Total:</td>
                    <td class="text-end" id="orderDetailGrandTotal">৳0.00</td>
                </tr>
            </tfoot>
        </table>
        
        <button onclick="testCouponDisplay()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px;">Test Coupon Display</button>
        
        <div id="testResult" class="result" style="display: none;">
            <h3>Test Result:</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // Mock order data (simulating what the API would return)
        const mockOrderData = {
            subtotal: "850.00",
            shipping_cost: "0",
            tax_amount: "0",
            coupon_code: "SAVE50",
            coupon_discount: "50.00",
            total_amount: "800.00"
        };
        
        // Store as global variable (simulating the dashboard behavior)
        window.currentOrderData = mockOrderData;
        
        function testCouponDisplay() {
            // Simulate the JavaScript logic from the dashboard
            const subtotal = 850.00; // This would come from item calculations
            const currentOrder = window.currentOrderData;
            
            console.log('Current order for totals:', currentOrder);
            
            // Set shipping, tax, coupon discount, and grand total using order data
            const shipping = currentOrder && currentOrder.shipping_cost ? Number(currentOrder.shipping_cost) : 0;
            const tax = currentOrder && currentOrder.tax_amount ? Number(currentOrder.tax_amount) : 0;
            const couponDiscount = currentOrder && currentOrder.coupon_discount ? Number(currentOrder.coupon_discount) : 0;
            
            console.log(`Shipping: ৳${shipping}, Tax: ৳${tax}, Subtotal: ৳${subtotal}, Coupon Discount: ৳${couponDiscount}`);
            
            // Update the display
            document.getElementById('orderDetailSubtotal').textContent = `৳${subtotal.toFixed(2)}`;
            document.getElementById('orderDetailShipping').textContent = `৳${shipping.toFixed(2)}`;
            
            // Handle coupon discount display
            const couponRow = document.getElementById('orderDetailCouponRow');
            const couponCodeElement = document.getElementById('orderDetailCouponCode');
            const couponDiscountElement = document.getElementById('orderDetailCouponDiscount');
            
            if (couponDiscount > 0 && currentOrder.coupon_code) {
                couponRow.style.display = 'table-row';
                couponCodeElement.textContent = currentOrder.coupon_code;
                couponDiscountElement.textContent = `-৳${couponDiscount.toFixed(2)}`;
            } else {
                couponRow.style.display = 'none';
            }
            
            // Calculate and display grand total (subtotal + shipping + tax - coupon_discount)
            const grandTotal = subtotal + shipping + tax - couponDiscount;
            document.getElementById('orderDetailGrandTotal').textContent = `৳${grandTotal.toFixed(2)}`;
            
            // Show test result
            const resultDiv = document.getElementById('testResult');
            const resultContent = document.getElementById('resultContent');
            
            let result = '<ul>';
            result += `<li>Subtotal: ${document.getElementById('orderDetailSubtotal').textContent}</li>`;
            result += `<li>Shipping: ${document.getElementById('orderDetailShipping').textContent}</li>`;
            result += `<li>Coupon Row Visible: ${couponRow.style.display === 'table-row' ? 'Yes' : 'No'}</li>`;
            result += `<li>Coupon Code: ${couponCodeElement.textContent}</li>`;
            result += `<li>Coupon Discount: ${couponDiscountElement.textContent}</li>`;
            result += `<li>Grand Total: ${document.getElementById('orderDetailGrandTotal').textContent}</li>`;
            result += `<li>Expected Total: ৳800.00</li>`;
            result += `<li>Match: ${document.getElementById('orderDetailGrandTotal').textContent === '৳800.00' ? '✓' : '✗'}</li>`;
            result += '</ul>';
            
            resultContent.innerHTML = result;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>