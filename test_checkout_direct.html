<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional eCommerce platform with modern design and features">
    <title>Checkout - Professional eCommerce</title>
    
    <!-- Load static files -->
    
    
    <!-- CSS -->
    <link rel="stylesheet" href="/static/frontend/css/style.css">
    <link rel="stylesheet" href="/static/frontend/css/navbar.css">
    <link rel="stylesheet" href="/static/frontend/css/wishlist.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/frontend/images/favicon.ico">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSRF Token for AJAX requests -->
    <meta name="csrf-token" content="oW2InglbOdSvRttQBqR1Fx4941H5Tq9iczuoL31cXQtaztVhoxwbmNAW1TAdAdoP">
    
    
<style>
    /* Dynamic Customization Variables */
    :root {
        --checkout-primary-color: #930000;
        --checkout-button-color: #930000;
        --checkout-background-color: #f8fafc;
    }

    /* Page Layout */
    .checkout-page {
        padding: 2rem 0;
        min-height: 80vh;
        background: linear-gradient(135deg, var(--checkout-background-color) 0%, #e2e8f0 100%);
    }

    .page-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 3rem;
        font-weight: 300;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(147, 0, 0, 0.1);
    }

    .page-subtitle {
        color: var(--secondary-color);
        font-size: 1.2rem;
        font-weight: 500;
    }

    /* Breadcrumb */
    .breadcrumb {
        margin-bottom: 2rem;
        padding: 1rem 0;
    }

    .breadcrumb a {
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
    }

    .breadcrumb a:hover {
        color: var(--primary-color);
    }

    .breadcrumb .current {
        color: var(--primary-color);
        font-weight: 600;
    }

    .breadcrumb-separator {
        color: var(--secondary-color);
        margin: 0 0.5rem;
    }

    /* Checkout Grid */
    .checkout-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 3rem;
        align-items: start;
    }

    /* Form Section */
    .checkout-form-section {
        background: var(--white);
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(147, 0, 0, 0.1);
        padding: 2.5rem;
        border: 1px solid rgba(147, 0, 0, 0.1);
    }

    .form-section {
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 2px solid #e2e8f0;
    }

    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
    }

    .section-title i {
        color: var(--primary-color);
        font-size: 1.25rem;
        padding: 0.5rem;
        background: rgba(147, 0, 0, 0.1);
        border-radius: 8px;
    }

    /* Form Elements */
    .form-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .form-group {
        flex: 1;
        position: relative;
    }

    .form-group.half {
        flex: 0.5;
    }

    .form-group.quarter {
        flex: 0.25;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--secondary-color);
        font-size: 0.95rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 0.875rem;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
        background: var(--white);
        color: var(--dark-color);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(147, 0, 0, 0.1);
    }

    .form-group textarea {
        resize: vertical;
        font-family: inherit;
    }

    .help-text {
        color: var(--secondary-color);
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: block;
    }

    .field-error {
        color: var(--danger-color);
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
    }

    /* Shipping Options */
    .shipping-options {
        display: grid;
        gap: 1rem;
    }

    /* Location Options */
    .location-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 0.5rem;
    }

    .location-option {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        transition: all 0.3s ease;
        text-align: center;
        background: #ffffff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .location-option:hover {
        border-color: #930000;
        box-shadow: 0 4px 12px rgba(147, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .location-option input[type="radio"] {
        display: none;
    }

    .location-option input[type="radio"]:checked + label {
        background: linear-gradient(135deg, #930000, #b91c1c);
        color: #ffffff;
        border-color: #930000;
    }

    .location-option input[type="radio"]:checked ~ .location-option {
        box-shadow: 0 6px 20px rgba(147, 0, 0, 0.25);
    }

    .location-option label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        padding: 1.25rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        border-radius: 10px;
        color: #334155;
        position: relative;
        overflow: hidden;
    }

    .location-option input[type="radio"]:checked + label {
        color: #ffffff;
    }

    .location-option label::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }

    .location-option:hover label::before {
        left: 100%;
    }

    .location-option label i {
        font-size: 2rem;
        margin-bottom: 0.25rem;
        transition: all 0.3s ease;
    }

    .location-option input[type="radio"]:checked + label i {
        color: #ffffff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .location-option label span {
        font-size: 0.95rem;
        font-weight: 600;
        letter-spacing: 0.025em;
    }

    .shipping-option {
        border: 2px solid var(--border-color);
        border-radius: 12px;
        transition: var(--transition);
        overflow: hidden;
        background: var(--white);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .shipping-option:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(147, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .shipping-option input[type="radio"] {
        display: none;
    }

    .shipping-option input[type="radio"]:checked + label {
        background: linear-gradient(135deg, rgba(147, 0, 0, 0.1), rgba(147, 0, 0, 0.05));
        border-left: 4px solid var(--primary-color);
    }

    .shipping-option label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.25rem;
        cursor: pointer;
        transition: var(--transition);
    }

    .shipping-info .shipping-name {
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 0.25rem;
        font-size: 1rem;
    }

    .shipping-info .shipping-description {
        color: var(--secondary-color);
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .shipping-price {
        font-weight: bold;
        color: var(--primary-color);
        font-size: 1.1rem;
    }
    
    .shipping-loading {
        text-align: center;
        padding: 2rem;
        color: var(--secondary-color);
    }
    
    .shipping-loading i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        display: block;
        color: var(--primary-color);
    }

    /* Payment Options */
    .payment-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .payment-option {
        border: 2px solid var(--border-color);
        border-radius: 12px;
        transition: var(--transition);
        text-align: center;
        background: var(--white);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .payment-option:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(147, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .payment-option input[type="radio"] {
        display: none;
    }

    .payment-option input[type="radio"]:checked + label {
        background: linear-gradient(135deg, var(--primary-color), #b91c1c);
        color: var(--white);
    }

    .payment-option label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        padding: 1.25rem;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        color: var(--secondary-color);
        border-radius: 10px;
    }

    .payment-option input[type="radio"]:checked + label {
        color: var(--white);
    }

    .payment-option label i {
        font-size: 1.5rem;
        transition: var(--transition);
    }

    /* Credit Card Form */
    .credit-card-form,
    .payment-form {
        margin-top: 2rem;
        padding: 2rem;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-radius: 12px;
        border: 1px solid rgba(147, 0, 0, 0.1);
    }

    .payment-method-info {
        margin-bottom: 1.5rem;
    }

    .info-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .info-header i {
        font-size: 1.5rem;
        color: var(--primary-color);
        padding: 0.5rem;
        background: rgba(147, 0, 0, 0.1);
        border-radius: 8px;
    }

    .info-header h4 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin: 0;
    }

    .payment-instructions {
        background: var(--white);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        border-left: 4px solid var(--primary-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .payment-instructions p {
        margin-bottom: 1rem;
        color: var(--secondary-color);
        font-weight: 500;
    }

    .payment-instructions ol,
    .payment-instructions ul {
        margin: 0;
        padding-left: 1.5rem;
    }

    .payment-instructions li {
        margin-bottom: 0.5rem;
        color: var(--secondary-color);
        line-height: 1.5;
    }

    .payment-instructions strong {
        color: var(--primary-color);
    }

    .cod-total {
        margin-top: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, var(--primary-color), #b91c1c);
        color: var(--white);
        border-radius: var(--border-radius);
        text-align: center;
        font-size: 1.1rem;
        box-shadow: 0 4px 12px rgba(147, 0, 0, 0.3);
    }

    .card-types {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        gap: 0.25rem;
    }

    .card-types i {
        font-size: 1.25rem;
        color: var(--secondary-color);
        opacity: 0.6;
    }

    .cvv-help {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--secondary-color);
        cursor: help;
    }

    /* Order Summary */
    .order-summary-section {
        position: sticky;
        top: 2rem;
    }

    .order-summary {
        background: var(--white);
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(147, 0, 0, 0.1);
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(147, 0, 0, 0.1);
    }

    .order-summary h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        text-align: center;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(147, 0, 0, 0.1);
    }

    .summary-loading {
        text-align: center;
        padding: 2rem;
        color: var(--secondary-color);
    }

    .summary-loading i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        display: block;
        color: var(--primary-color);
    }

    /* Order Items */
    .order-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(147, 0, 0, 0.1);
        transition: var(--transition);
    }

    .order-item:hover {
        background: rgba(147, 0, 0, 0.02);
        border-radius: 8px;
        padding: 1rem;
        margin: 0 -1rem;
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .item-thumbnail {
        width: 60px;
        height: 60px;
        border-radius: var(--border-radius);
        overflow: hidden;
        background: var(--light-color);
        flex-shrink: 0;
        border: 2px solid rgba(147, 0, 0, 0.1);
    }

    .item-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .item-info {
        flex: 1;
    }

    .item-name {
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 0.25rem;
        font-size: 0.9rem;
    }

    .item-variant {
        color: var(--secondary-color);
        font-size: 0.8rem;
        opacity: 0.8;
    }

    .item-quantity {
        background: linear-gradient(135deg, rgba(147, 0, 0, 0.1), rgba(147, 0, 0, 0.05));
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--primary-color);
        border: 1px solid rgba(147, 0, 0, 0.2);
    }

    .item-price {
        font-weight: bold;
        color: var(--primary-color);
        font-size: 1rem;
    }

    /* Order Totals */
    .order-totals {
        margin-top: 1.5rem;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid rgba(147, 0, 0, 0.1);
    }

    .total-line {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        font-size: 1rem;
        color: var(--secondary-color);
    }

    .total-line.grand-total {
        font-size: 1.3rem;
        font-weight: bold;
        color: var(--primary-color);
        padding-top: 1rem;
        border-top: 2px solid rgba(147, 0, 0, 0.2);
        margin-top: 1rem;
    }

    .total-divider {
        height: 2px;
        background: rgba(147, 0, 0, 0.2);
        margin: 1rem 0;
        border-radius: 1px;
    }

    /* Checkout Actions */
    .checkout-actions {
        margin-top: 2rem;
    }

    .place-order-btn {
        width: 100%;
        background: linear-gradient(135deg, var(--primary-color), #b91c1c);
        color: var(--white);
        border: none;
        padding: 1.25rem 2rem;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 6px 20px rgba(147, 0, 0, 0.3);
    }

    .place-order-btn:hover {
        background: linear-gradient(135deg, #b91c1c, var(--primary-color));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(147, 0, 0, 0.4);
    }

    .place-order-btn:disabled {
        background: var(--secondary-color);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .security-badges {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .security-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--secondary-color);
        font-size: 0.9rem;
    }

    .security-badge i {
        color: var(--success-color);
    }

    /* Trust Badges */
    .trust-badges {
        background: var(--white);
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(147, 0, 0, 0.1);
        padding: 1.5rem;
        border: 1px solid rgba(147, 0, 0, 0.1);
    }

    .trust-badges h4 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1rem;
        text-align: center;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(147, 0, 0, 0.1);
    }

    .trust-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        transition: var(--transition);
    }

    .trust-item:hover {
        background: rgba(147, 0, 0, 0.05);
    }

    .trust-item:last-child {
        margin-bottom: 0;
    }

    .trust-item i {
        font-size: 1.5rem;
        color: var(--primary-color);
        width: 30px;
        text-align: center;
        padding: 0.5rem;
        background: rgba(147, 0, 0, 0.1);
        border-radius: 8px;
    }

    .trust-item strong {
        display: block;
        color: var(--secondary-color);
        margin-bottom: 0.25rem;
        font-weight: 600;
    }

    .trust-item p {
        color: var(--secondary-color);
        font-size: 0.9rem;
        margin: 0;
        opacity: 0.8;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .checkout-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .order-summary-section {
            position: static;
        }

        .form-row {
            flex-direction: column;
        }

        .form-group.half,
        .form-group.quarter {
            flex: 1;
        }

        .payment-options {
            grid-template-columns: repeat(2, 1fr);
        }

        .location-options {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .location-option label {
            padding: 1rem;
        }

        .location-option label i {
            font-size: 1.75rem;
        }
    }

    @media (max-width: 768px) {
        .page-title {
            font-size: 2rem;
        }

        .checkout-form-section,
        .order-summary {
            padding: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
        }

        .shipping-option label {
            flex-direction: column;
            text-align: center;
            gap: 0.5rem;
        }

        .payment-options {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .checkout-form-section,
        .order-summary,
        .trust-badges {
            padding: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
        }

        .place-order-btn {
            padding: 1rem;
            font-size: 1.1rem;
        }

        .security-badges {
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .order-totals {
            padding: 1rem;
        }
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    /* Additional animations and effects */
    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }
    
    .location-option:hover,
    .payment-option:hover,
    .shipping-option:hover {
        animation: pulse 0.3s ease-in-out;
    }
</style>

    
</head>
<body class="">
    <style>
          /* Custom Color Variables */
    :root {
        --primary-color: #930000;
        --secondary-color: #334155;
        --dark-color: #1e293b;
        --light-color: #f8fafc;
        --white: #ffffff;
        --border-color: #e2e8f0;
        --success-color: #059669;
        --danger-color: #dc2626;
        --warning-color: #d97706;
        --info-color: #0284c7;
        --border-radius: 8px;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
        --transition: all 0.3s ease;
    }

    .main-content {
        padding-top: 240px;
    }  

    @media screen and (max-width: 768px) {
        .main-content {
            padding-top: 80px;
        }
    }


    
    </style>
    <!-- Header -->
    

<!-- Professional Navbar -->
<header class="navbar-wrapper">
    <!-- Top Bar -->
    <div class="navbar-top">
        <div class="container">
            <div class="top-bar-content">
                <div class="top-bar-left">
                    <span class="contact-info">
                        <i class="fas fa-phone"></i> +1 (555) 123-4567
                    </span>
                    <span class="contact-info">
                        <i class="fas fa-envelope"></i> support@ecommerce.com
                    </span>
                </div>
                <div class="top-bar-right">
                    <div class="language-selector">
                        <i class="fas fa-globe"></i>
                        <select>
                            <option>English</option>
                            <option>Spanish</option>
                            <option>French</option>
                        </select>
                    </div>
                    <div class="currency-selector">
                        <i class="fas fa-dollar-sign"></i>
                        <select>
                            <option>USD</option>
                            <option>EUR</option>
                            <option>GBP</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav class="navbar-main">
        <div class="container">
            <div class="navbar-content">
                <!-- Logo -->
                <div class="navbar-brand">
                    <a href="/" class="brand-logo">
                        <div class="logo-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="logo-text">
                            <span class="brand-name">eCommerce</span>
                            <span class="brand-tagline">Professional Store</span>
                        </div>
                    </a>
                </div>

                <!-- Search Bar -->
                <div class="navbar-search">
                    <form class="search-form" method="get" action="/search/">
                        <div class="search-input-wrapper">
                            <div class="search-category">
                                <select name="category" class="category-select">
                                    <option value="">All Categories</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="books">Books</option>
                                    <option value="home">Home & Garden</option>
                                </select>
                            </div>
                            <div class="search-divider"></div>
                            <input type="text" name="q" class="search-input" placeholder="Search for products..." value="">
                            <button type="submit" class="search-button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- User Actions -->
                <div class="navbar-actions">
                    <!-- User Account -->
                    <div class="action-item user-account">
                        
                            <div class="auth-buttons">
                                <a href="/login/" class="auth-btn login-btn">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Login</span>
                                </a>
                                <a href="/register/" class="auth-btn register-btn">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Register</span>
                                </a>
                            </div>
                        
                    </div>

                    <!-- Wishlist -->
                    <div class="action-item wishlist">
                        <a href="/wishlist/" class="action-link">
                            <div class="action-icon">
                                <i class="fas fa-heart"></i>
                                <span class="action-badge wishlist-count" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">0</span>
                            </div>
                            <div class="action-text">
                                <span class="action-label">Wishlist</span>
                                <span class="action-count wishlist-items">0 items</span>
                            </div>
                        </a>
                    </div>

                    <!-- Shopping Cart -->
                    <div class="action-item cart">
                        <a href="/cart/" class="action-link cart-link">
                            <div class="action-icon">
                                <i class="fas fa-shopping-cart"></i>
                                <span style="display: flex !important; visibility: visible !important; opacity: 1 !important;" class="action-badge cart-count">0</span>
                            </div>
                            <div class="action-text">
                                <span class="action-label">Cart</span>
                                <span class="action-count cart-total">$0.00</span>
                            </div>
                        </a>
                        
                        <!-- Cart Dropdown -->
                        <div class="cart-dropdown">
                            <div class="cart-dropdown-header">
                                <h4>Shopping Cart</h4>
                                <span class="cart-items-count">0 items</span>
                            </div>
                            <div class="cart-dropdown-body">
                                <div class="empty-cart">
                                    <i class="fas fa-shopping-cart"></i>
                                    <p>Your cart is empty</p>
                                    <a href="/products/" class="btn-shop-now">Shop Now</a>
                                </div>
                                <!-- Cart items will be loaded here via JavaScript -->
                            </div>
                            <div class="cart-dropdown-footer">
                                <div class="cart-total-display">
                                    <span>Total: <strong class="total-amount">$0.00</strong></span>
                                </div>
                                <div class="cart-actions">
                                    <a href="/cart/" class="btn btn-outline">View Cart</a>
                                    <a href="/checkout/" class="btn btn-primary">Checkout</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Menu Toggle -->
                    <div class="mobile-menu-toggle">
                        <button class="menu-toggle-btn">
                            <span class="hamburger"></span>
                            <span class="hamburger"></span>
                            <span class="hamburger"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation Menu -->
    <div class="navbar-menu">
        <div class="container">
            <div class="menu-content">
                <!-- Category Menu -->
                <div class="category-menu">
                    <button class="category-trigger">
                        <i class="fas fa-bars"></i>
                        <span>All Categories</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="category-dropdown">
                        <div class="category-list">
                            <a href="/category/electronics/" class="category-item">
                                <i class="fas fa-laptop"></i>
                                <span>Electronics</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <a href="/category/clothing/" class="category-item">
                                <i class="fas fa-tshirt"></i>
                                <span>Clothing</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <a href="/category/books/" class="category-item">
                                <i class="fas fa-book"></i>
                                <span>Books</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <a href="/category/home/" class="category-item">
                                <i class="fas fa-home"></i>
                                <span>Home & Garden</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <a href="/category/sports/" class="category-item">
                                <i class="fas fa-dumbbell"></i>
                                <span>Sports</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Main Navigation Links -->
                <nav class="main-nav">
                    <ul class="nav-links">
                        <li class="nav-item">
                            <a href="/" class="nav-link ">
                                Home
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a href="/products/" class="nav-link ">
                                Products
                                <i class="fas fa-chevron-down"></i>
                            </a>
                            <div class="dropdown-menu">
                                <div class="dropdown-content">
                                    <div class="dropdown-section">
                                        <h5>Featured</h5>
                                        <a href="/products/?featured=true">Featured Products</a>
                                        <a href="/products/?new=true">New Arrivals</a>
                                        <a href="/products/?sale=true">Sale Items</a>
                                    </div>
                                    <div class="dropdown-section">
                                        <h5>Categories</h5>
                                        <a href="/category/electronics/">Electronics</a>
                                        <a href="/category/clothing/">Clothing</a>
                                        <a href="/category/books/">Books</a>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a href="/categories/" class="nav-link ">
                                Categories
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                Deals
                                <span class="nav-badge">HOT</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/about/" class="nav-link ">
                                About
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/contact/" class="nav-link ">
                                Contact
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Promotional Banner -->
                <div class="promo-banner">
                    <div class="promo-content">
                        <i class="fas fa-shipping-fast"></i>
                        <span>FREE SHIPPING on orders over $50</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay">
        <div class="mobile-menu">
            <div class="mobile-menu-header">
                <div class="brand-logo">
                    <div class="logo-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="logo-text">
                        <span class="brand-name">StyleHub</span>
                        <span class="brand-tagline">Fashion Forward</span>
                    </div>
                </div>
                <button class="mobile-menu-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mobile-menu-body">
                <!-- Mobile Search -->
                <form class="search-form" method="get" action="/search/">
                    <div class="search-input-wrapper">
                        <input type="text" class="search-input" name="q" placeholder="Search products..." value="">
                        <button type="submit" class="search-button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
                
                <!-- Mobile Navigation -->
                <nav class="mobile-nav">
                    <a href="/" class="mobile-nav-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="/products/" class="mobile-nav-link">
                        <i class="fas fa-shopping-bag"></i> Products
                    </a>
                    <a href="/categories/" class="mobile-nav-link">
                        <i class="fas fa-th-large"></i> Categories
                    </a>
                    <a href="#" class="mobile-nav-link">
                        <i class="fas fa-fire"></i> Deals
                    </a>
                    <a href="/about/" class="mobile-nav-link">
                        <i class="fas fa-info-circle"></i> About
                    </a>
                    <a href="/contact/" class="mobile-nav-link">
                        <i class="fas fa-envelope"></i> Contact
                    </a>
                    
                    
                        <div class="menu-divider"></div>
                        <a href="/login/" class="mobile-nav-link">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                        <a href="/register/" class="mobile-nav-link">
                            <i class="fas fa-user-plus"></i> Register
                        </a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


    <!-- Main Content -->
    <main class="main-content">
        
    <div class="container">
        <!-- Breadcrumb -->
        
        <nav class="breadcrumb">
            <a href="/">Home</a>
            <span class="breadcrumb-separator">/</span>
            <a href="/cart/">Cart</a>
            <span class="breadcrumb-separator">/</span>
            <span class="current">Checkout</span>
        </nav>
        

        <div class="checkout-page">
            <div class="page-header">
                <h1 class="page-title">Checkout</h1>
                <p class="page-subtitle">Complete your order</p>
            </div>

            <form class="checkout-form" id="checkout-form">
                <div class="checkout-grid">
                    <!-- Checkout Form Section -->
                    <div class="checkout-form-section">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h2 class="section-title">
                                <i class="fas fa-user"></i>
                                Customer Information
                            </h2>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="full_name">Full Name</label>
                                    <input type="text" id="full_name" name="full_name" 
                                           placeholder="Enter your full name"
                                           value="">
                                    <div class="field-error" id="full_name_error"></div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="email">Email Address *</label>
                                    <input type="email" id="email" name="email"
                                           placeholder="Enter your email address"
                                           value="">
                                    <div class="field-error" id="email_error"></div>
                                </div>
                                <div class="form-group half">
                                    <label for="phone_number">Phone Number *</label>
                                    <input type="tel" id="phone_number" name="phone_number" required
                                           placeholder="Enter your phone number"
                                           value=""> 
                                    <div class="field-error" id="phone_number_error"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Information -->
                        <div class="form-section">
                            <h2 class="section-title">
                                <i class="fas fa-shipping-fast"></i>
                                Shipping Address
                            </h2>
                            
                            
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="address">Street Address</label>
                                    <textarea id="address" name="address" rows="3" 
                                              placeholder="Enter your complete address">গ্রামঃ 
থানাঃ 
জেলাঃ</textarea>
                                    <div class="field-error" id="address_error"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Instructions -->
                        <div class="form-section">
                            <h2 class="section-title">
                                <i class="fas fa-clipboard-list"></i>
                                Order Instructions
                            </h2>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="order_instruction">Special Instructions (Optional)</label>
                                    <textarea id="order_instruction" name="order_instruction" rows="4" 
                                              placeholder="Any special delivery instructions, gift messages, or notes for your order..."></textarea>
                                    <small class="help-text">Maximum 500 characters</small>
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Method -->
                        <div class="form-section">
                            <h2 class="section-title">
                                <i class="fas fa-truck"></i>
                                Shipping Method
                            </h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Delivery Location *</label>
                                    <div class="location-options">
                                        <div class="location-option">
                                            <input type="radio" id="location_dhaka" name="location" value="dhaka" checked required>
                                            <label for="location_dhaka">
                                                <i class="fas fa-city"></i>
                                                <span>Dhaka City</span>
                                            </label>
                                        </div>
                                        <div class="location-option">
                                            <input type="radio" id="location_outside" name="location" value="outside" required>
                                            <label for="location_outside">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <span>Outside Dhaka</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-error" id="location_error"></div>
                                </div>
                            </div>
                            <div class="shipping-options" id="shipping-options">
                                <!-- Shipping options will be loaded dynamically -->
                                <div class="shipping-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Loading shipping options...
                                </div>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h2 class="section-title">
                                <i class="fas fa-credit-card"></i>
                                Payment Method
                            </h2>
                            
                            <div class="payment-options">
                                <div class="payment-option">
                                    <input type="radio" id="cod" name="payment_method" value="cod" checked>
                                    <label for="cod">
                                        <i class="fas fa-money-bill-wave"></i>
                                        Cash on Delivery
                                    </label>
                                </div>
                                
                                <div class="payment-option">
                                    <input type="radio" id="bkash" name="payment_method" value="bkash">
                                    <label for="bkash">
                                        <i class="fas fa-mobile-alt"></i>
                                        bKash
                                    </label>
                                </div>
                                
                                <div class="payment-option">
                                    <input type="radio" id="nagad" name="payment_method" value="nagad">
                                    <label for="nagad">
                                        <i class="fas fa-wallet"></i>
                                        Nagad
                                    </label>
                                </div>
                            </div>

                            <!-- bKash Form -->
                            <div class="payment-form" id="bkash-form" style="display: none;">
                                <div class="payment-method-info">
                                    <div class="info-header">
                                        <i class="fas fa-mobile-alt"></i>
                                        <h4>bKash Payment</h4>
                                    </div>
                                    <div class="payment-instructions">
                                        <p><strong>Follow these steps:</strong></p>
                                        <ol>
                                            <li>Go to your bKash Mobile Menu by dialing *247#</li>
                                            <li>Choose "Send Money"</li>
                                            <li>Enter Merchant bKash Account Number: <strong>01XXXXXXXXX</strong></li>
                                            <li>Enter the total amount: <strong id="bkash-amount">$0.00</strong></li>
                                            <li>Enter a reference: Your phone number</li>
                                            <li>Now enter your bKash Mobile Menu PIN and confirm</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="bkash_transaction_id">bKash Transaction ID *</label>
                                        <input type="text" id="bkash_transaction_id" name="bkash_transaction_id" 
                                               placeholder="Enter transaction ID after payment">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="bkash_sender_number">Sender Mobile Number *</label>
                                        <input type="tel" id="bkash_sender_number" name="bkash_sender_number" 
                                               placeholder="01XXXXXXXXX">
                                    </div>
                                </div>
                            </div>

                            <!-- Nagad Form -->
                            <div class="payment-form" id="nagad-form" style="display: none;">
                                <div class="payment-method-info">
                                    <div class="info-header">
                                        <i class="fas fa-wallet"></i>
                                        <h4>Nagad Payment</h4>
                                    </div>
                                    <div class="payment-instructions">
                                        <p><strong>Follow these steps:</strong></p>
                                        <ol>
                                            <li>Go to your Nagad Mobile Menu by dialing *167#</li>
                                            <li>Choose "Send Money"</li>
                                            <li>Enter Merchant Nagad Account Number: <strong>01XXXXXXXXX</strong></li>
                                            <li>Enter the total amount: <strong id="nagad-amount">$0.00</strong></li>
                                            <li>Enter a reference: Your phone number</li>
                                            <li>Now enter your Nagad PIN and confirm</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nagad_transaction_id">Nagad Transaction ID *</label>
                                        <input type="text" id="nagad_transaction_id" name="nagad_transaction_id" 
                                               placeholder="Enter transaction ID after payment">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nagad_sender_number">Sender Mobile Number *</label>
                                        <input type="tel" id="nagad_sender_number" name="nagad_sender_number" 
                                               placeholder="01XXXXXXXXX">
                                    </div>
                                </div>
                            </div>

                            <!-- COD Form -->
                            <div class="payment-form" id="cod-form">
                                <div class="payment-method-info">
                                    <div class="info-header">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <h4>Cash on Delivery</h4>
                                    </div>
                                    <div class="payment-instructions">
                                        <p><strong>Payment Information:</strong></p>
                                        Payment Information:
• Pay cash when you receive your order
• Make sure to have exact amount ready
• Our delivery person will collect the payment
• You can inspect the product before payment
                                        <div class="cod-total">
                                            <strong>Total Amount to Pay: <span id="cod-amount">$0.00</span></strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Summary Section -->
                    
                    <div class="order-summary-section">
                        <div class="order-summary">
                            <h3>Order Summary</h3>
                            
                            <div class="order-items" id="order-items">
                                <!-- Items will be populated here -->
                                <div class="summary-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Loading order items...
                                </div>
                            </div>
                            
                            <div class="order-totals">
                                <div class="total-line">
                                    <span>Subtotal:</span>
                                    <span id="order-subtotal">$0.00</span>
                                </div>
                                
                                <div class="total-line">
                                    <span>Shipping:</span>
                                    <span id="order-shipping">$0.00</span>
                                </div>
                                
                                <div class="total-line">
                                    <span>Tax:</span>
                                    <span id="order-tax">$0.00</span>
                                </div>
                                
                                <div class="total-divider"></div>
                                
                                <div class="total-line grand-total">
                                    <span>Total:</span>
                                    <span id="order-total">$0.00</span>
                                </div>
                            </div>
                            
                            <div class="checkout-actions">
                                <button type="submit" class="place-order-btn" id="place-order-btn">
                                    <i class="fas fa-lock"></i>
                                    Place Order
                                </button>
                                
                                
                                <div class="security-badges">
                                    <div class="security-badge">
                                        <i class="fas fa-shield-alt"></i>
                                        <span>SSL Secured</span>
                                    </div>
                                    <div class="security-badge">
                                        <i class="fas fa-lock"></i>
                                        <span>Safe Checkout</span>
                                    </div>
                                </div>
                                
                            </div>
                        </div>

                        <!-- Trust Badges -->
                        
                        <div class="trust-badges">
                            <h4>Why shop with us?</h4>
                            <div class="trust-item">
                                <i class="fas fa-shipping-fast"></i>
                                <div>
                                    <strong>Fast Shipping</strong>
                                    <p>Free shipping on orders over $50</p>
                                </div>
                            </div>
                            <div class="trust-item">
                                <i class="fas fa-undo"></i>
                                <div>
                                    <strong>Easy Returns</strong>
                                    <p>30-day return policy</p>
                                </div>
                            </div>
                            <div class="trust-item">
                                <i class="fas fa-headset"></i>
                                <div>
                                    <strong>24/7 Support</strong>
                                    <p>Customer service available</p>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                </div>
            </form>
        </div>
    </div>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- Company Info -->
                <div class="footer-section">
                    <h3>eCommerce</h3>
                    <p>Your trusted online shopping destination with quality products and excellent service.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/products/">Products</a></li>
                        <li><a href="/categories/">Categories</a></li>
                        <li><a href="/about/">About Us</a></li>
                        <li><a href="/contact/">Contact</a></li>
                    </ul>
                </div>
                
                <!-- Customer Service -->
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="/order-tracking/">Track Order</a></li>
                        <li><a href="#">Return Policy</a></li>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="/fraud-checker/">Fraud Checker</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                
                <!-- Contact Info -->
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                        <p><i class="fas fa-envelope"></i> support@ecommerce.com</p>
                        <p><i class="fas fa-map-marker-alt"></i> 123 Business St, City, State 12345</p>
                    </div>
                </div>
            </div>
            
            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <p>&copy; 2025 eCommerce Platform. All rights reserved. | 
                   <a href="#">Privacy Policy</a> | 
                   <a href="#">Terms of Service</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <!-- Load cart.js first as others depend on it -->
    <script src="/static/frontend/js/cart.js?v=1.4"></script>
    <script src="/static/frontend/js/app.js?v=1.4"></script>
    <script src="/static/frontend/js/navbar.js?v=1.4"></script>
    <script src="/static/frontend/js/wishlist.js?v=1.4"></script>
    
<script>
    // Checkout customization data for JavaScript
    window.checkoutCustomization = {
        loadingCartMessage: 'Loading order items...',
        loadingShippingMessage: 'Loading shipping options...',
        processingOrderMessage: 'Processing...',
        orderSuccessMessage: 'Order placed successfully!',
        orderErrorMessage: 'Error processing order. Please try again.',
        validationErrorMessage: 'Please check your information and try again.',
        bkashMerchantNumber: '01XXXXXXXXX',
        nagadMerchantNumber: '01XXXXXXXXX'
    };

    document.addEventListener('DOMContentLoaded', function() {
        loadOrderSummary();
        setupFormValidation();
        setupPaymentMethodToggle();
        setupLocationChangeListener();
        
        // Setup location change listener
        function setupLocationChangeListener() {
            const locationRadios = document.querySelectorAll('input[name="location"]');
            locationRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        const selectedLocation = this.value;
                        console.log('Location changed to:', selectedLocation);
                        loadShippingOptions(selectedLocation);
                    }
                });
            });
        }
        
        // Load order summary
        function loadOrderSummary() {
            const locationRadio = document.querySelector('input[name="location"]:checked');
            const location = locationRadio ? locationRadio.value : 'dhaka';
            
            fetch(`/api/v1/cart/?location=${location}`, {
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(response => response.json())
            .then(cartData => {
                displayOrderItems(cartData.items || []);
                updateOrderTotals(cartData);
                loadShippingOptions(location);
            })
            .catch(error => {
                console.error('Error loading cart:', error);
                document.getElementById('order-items').innerHTML = `
                    <div style="text-align: center; color: var(--danger-color); padding: 2rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading cart items</p>
                    </div>
                `;
            });
        }
        
        // Load shipping options based on location
        function loadShippingOptions(location = 'dhaka') {
            fetch(`/api/v1/cart/shipping-options/?location=${location}`, {
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.available_options) {
                    updateShippingOptions({ available_options: data.available_options });
                } else {
                    console.error('No shipping options received:', data);
                    showDefaultShippingOptions(location);
                }
            })
            .catch(error => {
                console.error('Error loading shipping options:', error);
                showDefaultShippingOptions(location);
            });
        }
        
        // Show default shipping options if API fails
        function showDefaultShippingOptions(location) {
            const shippingContainer = document.getElementById('shipping-options');
            let optionsHtml = '';
            
            if (location === 'dhaka') {
                optionsHtml = `
                    <div class="shipping-option">
                        <input type="radio" id="standard_dhaka" name="shipping_method" value="standard" data-cost="70" checked>
                        <label for="standard_dhaka">
                            <div class="shipping-info">
                                <div class="shipping-name">Standard Shipping (Dhaka City)</div>
                                <div class="shipping-description">1-2 days</div>
                            </div>
                            <div class="shipping-price">70৳</div>
                        </label>
                    </div>
                    <div class="shipping-option">
                        <input type="radio" id="express_dhaka" name="shipping_method" value="express" data-cost="150">
                        <label for="express_dhaka">
                            <div class="shipping-info">
                                <div class="shipping-name">Express Shipping (Same Day)</div>
                                <div class="shipping-description">Same day delivery</div>
                            </div>
                            <div class="shipping-price">150৳</div>
                        </label>
                    </div>
                `;
            } else {
                optionsHtml = `
                    <div class="shipping-option">
                        <input type="radio" id="standard_outside" name="shipping_method" value="standard" data-cost="120" checked>
                        <label for="standard_outside">
                            <div class="shipping-info">
                                <div class="shipping-name">Standard Shipping (Outside Dhaka)</div>
                                <div class="shipping-description">2-4 days</div>
                            </div>
                            <div class="shipping-price">120৳</div>
                        </label>
                    </div>
                `;
            }
            
            shippingContainer.innerHTML = optionsHtml;
            setupShippingMethodListeners();
            updateShippingCost();
        }
        
        function displayOrderItems(items) {
            const orderItemsContainer = document.getElementById('order-items');
            
            if (items.length === 0) {
                orderItemsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--secondary-color); padding: 2rem;">
                        <p>No items in cart</p>
                        <a href="/" style="color: var(--primary-color);">Continue Shopping</a>
                    </div>
                `;
                return;
            }
            
            orderItemsContainer.innerHTML = items.map(item => {
                // Use flattened fields first, fall back to nested structure
                const productName = item.product_name || (item.product ? item.product.name : 'Unknown Product');
                const productImage = item.product_image || (item.product ? item.product.primary_image : null) || '/media/default.webp';
                
                // Extract variant information - use flattened fields first
                const variantName = item.variant_name || (item.variant ? item.variant.name : null);
                const variantColor = item.variant_color || (item.variant ? item.variant.color : null);
                const variantSize = item.variant_size || (item.variant ? item.variant.size : null);
                
                // Build variant display string
                let variantDisplay = '';
                if (variantName) {
                    variantDisplay = variantName;
                } else if (variantColor || variantSize) {
                    const parts = [];
                    if (variantColor) parts.push(variantColor);
                    if (variantSize) parts.push(variantSize);
                    variantDisplay = parts.join(', ');
                }
                
                return `
                    <div class="order-item">
                        <div class="item-thumbnail">
                            <img src="${productImage}" alt="${productName}" onerror="this.src='/media/default.webp'">
                        </div>
                        <div class="item-info">
                            <div class="item-name">${productName}</div>
                            ${variantDisplay ? `<div class="item-variant">${variantDisplay}</div>` : ''}
                        </div>
                        <div class="item-quantity">×${item.quantity}</div>
                        <div class="item-price">$${item.total_price}</div>
                    </div>
                `;
            }).join('');
        }
        
        function updateOrderTotals(cartData) {
            const subtotal = parseFloat(cartData.subtotal || 0);
            const shippingMethod = document.querySelector('input[name="shipping_method"]:checked');
            let shipping = 0;
            
            if (shippingMethod && shippingMethod.dataset.cost) {
                shipping = parseFloat(shippingMethod.dataset.cost);
            }
            
            const tax = parseFloat(cartData.tax || 0);
            const total = subtotal + shipping + tax;
            
            document.getElementById('order-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('order-shipping').textContent = shipping === 0 ? 'FREE' : `${shipping}৳`;
            document.getElementById('order-tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('order-total').textContent = `$${total.toFixed(2)}`;
            
            // Update payment amounts
            updatePaymentAmount();
        }
        
        function updateShippingOptions(shippingSummary) {
            if (!shippingSummary || !shippingSummary.available_options) {
                return;
            }
            
            const shippingContainer = document.getElementById('shipping-options');
            if (!shippingContainer) return;
            
            // Clear existing options
            shippingContainer.innerHTML = '';
            
            // Add available shipping options
            shippingSummary.available_options.forEach((option, index) => {
                const isChecked = index === 0 ? 'checked' : '';
                const cost = option.cost == 0 ? 'FREE' : `${option.cost}৳`;
                
                const optionHtml = `
                    <div class="shipping-option">
                        <input type="radio" id="shipping_${option.type}_${index}" name="shipping_method" 
                               value="${option.type}" data-cost="${option.cost}" ${isChecked}>
                        <label for="shipping_${option.type}_${index}">
                            <div class="shipping-info">
                                <div class="shipping-name">${option.name}</div>
                                <div class="shipping-description">${option.estimated_days}</div>
                            </div>
                            <div class="shipping-price">${cost}</div>
                        </label>
                    </div>
                `;
                
                shippingContainer.insertAdjacentHTML('beforeend', optionHtml);
            });
            
            // Re-attach event listeners for new shipping options
            setupShippingMethodListeners();
            updateShippingCost();
        }
        
        function setupShippingMethodListeners() {
            document.querySelectorAll('input[name="shipping_method"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    updateShippingCost();
                });
            });
        }
        
        function updateShippingCost() {
            const subtotalElement = document.getElementById('order-subtotal');
            const subtotal = parseFloat(subtotalElement.textContent.replace('$', '')) || 0;
            
            const shippingMethod = document.querySelector('input[name="shipping_method"]:checked');
            let shipping = 0;
            
            if (shippingMethod && shippingMethod.dataset.cost) {
                shipping = parseFloat(shippingMethod.dataset.cost);
            }
            
            const tax = 0; // You can add tax calculation here
            const total = subtotal + shipping + tax;
            
            document.getElementById('order-shipping').textContent = shipping === 0 ? 'FREE' : `${shipping}৳`;
            document.getElementById('order-total').textContent = `$${total.toFixed(2)}`;
            
            updatePaymentAmount();
        }
        
        // Setup initial shipping method listeners (will be replaced when options load)
        setupShippingMethodListeners();
        
        // Payment method toggle
        function setupPaymentMethodToggle() {
            const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
            const bkashForm = document.getElementById('bkash-form');
            const nagadForm = document.getElementById('nagad-form');
            const codForm = document.getElementById('cod-form');
            
            paymentMethods.forEach(method => {
                method.addEventListener('change', function() {
                    // Hide all payment forms
                    bkashForm.style.display = 'none';
                    nagadForm.style.display = 'none';
                    codForm.style.display = 'none';
                    
                    // Show the selected payment form
                    switch(this.value) {
                        case 'bkash':
                            bkashForm.style.display = 'block';
                            updatePaymentAmount();
                            break;
                        case 'nagad':
                            nagadForm.style.display = 'block';
                            updatePaymentAmount();
                            break;
                        case 'cod':
                            codForm.style.display = 'block';
                            updatePaymentAmount();
                            break;
                    }
                });
            });
        }
        
        // Update payment amount in forms
        function updatePaymentAmount() {
            const totalElement = document.getElementById('order-total');
            const total = totalElement ? totalElement.textContent : '$0.00';
            
            const bkashAmount = document.getElementById('bkash-amount');
            const nagadAmount = document.getElementById('nagad-amount');
            const codAmount = document.getElementById('cod-amount');
            
            if (bkashAmount) bkashAmount.textContent = total;
            if (nagadAmount) nagadAmount.textContent = total;
            if (codAmount) codAmount.textContent = total;
        }
        
        // Form validation
        function setupFormValidation() {
            const form = document.getElementById('checkout-form');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    processOrder();
                }
            });
        }
        
        function validateForm() {
            let isValid = true;
            
            // Required fields
            const requiredFields = [
                'email',
                'phone_number'
            ];
            
            requiredFields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                const errorElement = document.getElementById(fieldName + '_error');
                
                if (field && !field.value.trim()) {
                    showFieldError(field, errorElement, 'This field is required');
                    isValid = false;
                } else if (field && errorElement) {
                    hideFieldError(field, errorElement);
                }
            });
            
            // Email validation
            const emailField = document.getElementById('email');
            const emailError = document.getElementById('email_error');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (emailField && emailField.value && !emailPattern.test(emailField.value)) {
                showFieldError(emailField, emailError, 'Please enter a valid email address');
                isValid = false;
            }
            
            // Payment method validation
            const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
            if (paymentMethod) {
                switch(paymentMethod.value) {
                    case 'bkash':
                        const bkashFields = ['bkash_transaction_id', 'bkash_sender_number'];
                        
                        bkashFields.forEach(fieldName => {
                            const field = document.getElementById(fieldName);
                            if (field && !field.value.trim()) {
                                field.style.borderColor = 'var(--danger-color)';
                                isValid = false;
                            } else if (field) {
                                field.style.borderColor = 'var(--border-color)';
                            }
                        });
                        break;
                        
                    case 'nagad':
                        const nagadFields = ['nagad_transaction_id', 'nagad_sender_number'];
                        
                        nagadFields.forEach(fieldName => {
                            const field = document.getElementById(fieldName);
                            if (field && !field.value.trim()) {
                                field.style.borderColor = 'var(--danger-color)';
                                isValid = false;
                            } else if (field) {
                                field.style.borderColor = 'var(--border-color)';
                            }
                        });
                        break;
                        
                    case 'cod':
                        // No additional validation needed for COD
                        break;
                }
            }
            
            return isValid;
        }
        
        function showFieldError(field, errorElement, message) {
            if (field) field.style.borderColor = 'var(--danger-color)';
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }
        
        function hideFieldError(field, errorElement) {
            if (field) field.style.borderColor = 'var(--border-color)';
            if (errorElement) errorElement.style.display = 'none';
        }
        
        function processOrder() {
            const placeOrderBtn = document.getElementById('place-order-btn');
            const originalText = placeOrderBtn.innerHTML;
            placeOrderBtn.disabled = true;
            placeOrderBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + window.checkoutCustomization.processingOrderMessage;
            
            // Collect form data
            const formData = new FormData(document.getElementById('checkout-form'));
            
            // Get selected shipping option
            const selectedShippingMethod = document.querySelector('input[name="shipping_method"]:checked');
            const selectedLocationRadio = document.querySelector('input[name="location"]:checked');
            const selectedLocation = selectedLocationRadio ? selectedLocationRadio.value : 'dhaka';
            
            // Prepare order data in the expected format for CreateOrderSerializer
            const orderData = {
                shipping_address: {
                    first_name: formData.get('full_name') ? formData.get('full_name').split(' ')[0] || 'Customer' : 'Customer',
                    last_name: formData.get('full_name') ? formData.get('full_name').split(' ').slice(1).join(' ') || '' : '',
                    company: '',
                    address_line_1: formData.get('address') || 'Address not provided',
                    address_line_2: '',
                    city: 'Dhaka',
                    state: 'Dhaka',
                    postal_code: '1000',
                    country: 'Bangladesh',
                    phone: formData.get('phone_number') || '',
                    email: formData.get('email') || '',
                    delivery_instructions: formData.get('order_instruction') || ''
                },
                customer_notes: formData.get('order_instruction') || '',
                coupon_code: '',
                shipping_option: selectedShippingMethod ? selectedShippingMethod.value : '',
                shipping_location: selectedLocation || 'dhaka',
                // Include guest order fields
                guest_email: formData.get('email') || '',
                guest_phone: formData.get('phone_number') || ''
            };
            
            console.log('Order data being sent:', orderData);
            
            // Create order via API
            fetch('/api/v1/orders/create/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify(orderData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Order creation response:', data);
                
                if (data.error || data.errors) {
                    let errorMessage = data.error || data.detail || 'Please check your information and try again.';
                    
                    // If there are detailed validation errors, show them
                    if (data.errors) {
                        console.log('Validation errors:', data.errors);
                        if (typeof data.errors === 'object') {
                            const errorDetails = [];
                            for (const [field, errors] of Object.entries(data.errors)) {
                                if (Array.isArray(errors)) {
                                    errorDetails.push(`${field}: ${errors.join(', ')}`);
                                } else {
                                    errorDetails.push(`${field}: ${errors}`);
                                }
                            }
                            errorMessage += '<br>' + errorDetails.join('<br>');
                        }
                    }
                    
                    // Check if it's an authentication error
                    if (errorMessage.includes('Authentication required') || errorMessage.includes('unauthorized')) {
                        // For guest orders, we don't redirect to login
                        console.log('Guest order attempted, proceeding without authentication requirement');
                    }
                    
                    showNotification('Order failed: ' + errorMessage, 'error');
                    console.error('Order errors:', data);
                } else if (data.order && data.order.order_number) {
                    console.log('Order created successfully:', data.order.order_number);
                    // Success - clear cart and redirect to order confirmation
                    showNotification(window.checkoutCustomization.orderSuccessMessage, 'success');
                    
                    // Clear the cart
                    fetch('/api/v1/cart/clear/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken')
                        }
                    }).then(() => {
                        setTimeout(() => {
                            window.location.href = `/orders/${data.order.order_number}/`;
                        }, 1500);
                    });
                } else {
                    console.log('Unexpected response structure:', data);
                    showNotification('Order created but confirmation failed. Please check your orders.', 'warning');
                    setTimeout(() => {
                        window.location.href = '/orders/';
                    }, 2000);
                }
            })
            .catch(error => {
                console.error('Error processing order:', error);
                showNotification(window.checkoutCustomization.orderErrorMessage, 'error');
            })
            .finally(() => {
                placeOrderBtn.disabled = false;
                placeOrderBtn.innerHTML = originalText;
            });
        }
        
        // Utility functions
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <div>${message}</div>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                display: flex;
                align-items: flex-start;
                gap: 10px;
                font-weight: 600;
                animation: slideIn 0.3s ease;
                max-width: 400px;
                word-wrap: break-word;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000); // Show for 5 seconds for error messages
        }
        
        // ====== CHECKOUT ABANDONMENT TRACKING ======
        
        let checkoutDataCache = {};
        let saveTimeout = null;
        let isFormSubmitting = false;
        
        // Function to get current form data
        function getCheckoutData() {
            return {
                full_name: document.getElementById('full_name')?.value || '',
                email: document.getElementById('email')?.value || '',
                phone_number: document.getElementById('phone_number')?.value || '',
                address: document.getElementById('address')?.value || '',
                order_instruction: document.getElementById('order_instruction')?.value || '',
                timestamp: new Date().toISOString()
            };
        }
        
        // Function to save checkout data to session
        function saveCheckoutData() {
            if (isFormSubmitting) return; // Don't save if form is being submitted
            
            const currentData = getCheckoutData();
            
            // Only save if data has changed or is significant
            if (JSON.stringify(currentData) === JSON.stringify(checkoutDataCache)) {
                return; // No changes
            }
            
            // Check if we have at least email or name filled
            if (!currentData.email && !currentData.full_name) {
                return; // Not enough data to be worth saving
            }
            
            checkoutDataCache = currentData;
            
            fetch('/api/incomplete-orders/save-checkout-data/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: JSON.stringify(currentData)
            }).catch(error => {
                console.log('Could not save checkout data:', error);
            });
        }
        
        // Function to track abandonment
        function trackAbandonmentIfNeeded() {
            if (isFormSubmitting) return; // Don't track if form is being submitted
            
            const currentData = getCheckoutData();
            
            // Only track if we have meaningful data
            if (!currentData.email && !currentData.full_name) {
                return;
            }
            
            fetch('/api/incomplete-orders/track-abandonment/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                }
            }).catch(error => {
                console.log('Could not track abandonment:', error);
            });
        }
        
        // Add event listeners to form fields for real-time saving
        const formFields = ['full_name', 'email', 'phone_number', 'address', 'order_instruction'];
        
        formFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                // Save data when user stops typing (debounced)
                field.addEventListener('input', function() {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(saveCheckoutData, 1000); // Save after 1 second of no typing
                });
                
                // Save immediately when field loses focus
                field.addEventListener('blur', saveCheckoutData);
            }
        });
        
        // Track when form is being submitted to prevent false abandonment tracking
        const checkoutForm = document.getElementById('checkout-form');
        if (checkoutForm) {
            checkoutForm.addEventListener('submit', function() {
                isFormSubmitting = true;
            });
        }
        
        // Track abandonment on page unload events
        window.addEventListener('beforeunload', function(e) {
            if (!isFormSubmitting) {
                trackAbandonmentIfNeeded();
            }
        });
        
        // Track abandonment when page becomes hidden (mobile browsers)
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden' && !isFormSubmitting) {
                trackAbandonmentIfNeeded();
            }
        });
        
        // Track abandonment when user navigates away (modern browsers)
        window.addEventListener('pagehide', function(e) {
            if (!isFormSubmitting) {
                trackAbandonmentIfNeeded();
            }
        });
        
        // For older browsers, also track on window unload
        window.addEventListener('unload', function(e) {
            if (!isFormSubmitting) {
                trackAbandonmentIfNeeded();
            }
        });
        
        console.log('✅ Checkout abandonment tracking initialized');
        
    });
</script>

    
    <!-- CSRF Token for AJAX requests -->
    <script>
        window.csrfToken = 'oW2InglbOdSvRttQBqR1Fx4941H5Tq9iczuoL31cXQtaztVhoxwbmNAW1TAdAdoP';
    </script>
    
    <!-- Initialize cart functionality and handle logout -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure cartManager is initialized
            if (window.cartManager) {
                console.log('Cart manager ready');
                setTimeout(() => window.cartManager.updateCartDisplay(), 200);
            } else {
                console.warn('Cart manager not available!');
            }
            
            // Handle logout forms - clear local storage before submitting
            const logoutForms = document.querySelectorAll('#mobile-logout-form, #dropdown-logout-form');
            logoutForms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    // Clear auth tokens and cart data
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('refreshToken');
                    localStorage.removeItem('cart');
                    
                    // Show notification (will be brief as page redirects)
                    if (window.showNotification) {
                        window.showNotification('Logging out...', 'info');
                    }
                    
                    // Continue with form submission
                    return true;
                });
            });
        });
    </script>
</body>
</html>
